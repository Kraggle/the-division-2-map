function pageLoad(){"true"==K.urlParam("noIcon")&&Cookies.set("hideIcon",!0,K.expires),"true"==K.urlParam("clean")&&Cookies.set("cleanMenu",!0,K.expires),Cookies.get("hideIcon")||$("#survival-logo").fadeIn(500),Cookies.get("cleanMenu")&&($(".side-menu-toggle.login").hide(0),$(".side-menu-toggle.filters").hide(0),$(".side-menu-toggle.full").hide(0),$(".side-menu-toggle.changes").hide(0),$(".side-menu-toggle.todo").hide(0),$(".side-menu-toggle.gear").hide(0),$(".side-menu-toggle.language").hide(0),$(".side-menu-toggle.shorts").hide(0),$(".leaflet-control-attribution.leaflet-control").hide(0),$("#logo").hide(0)),"true"==K.urlParam("overwolf")&&($(".side-menu-toggle.full").hide(0),$(".side-menu-toggle.changes").hide(0),$(".side-menu-toggle.todo").hide(0),$(".side-menu-toggle.language").hide(0),$(".side-menu-toggle.shorts").hide(0),$(".leaflet-control-attribution.leaflet-control").hide(0),$("#alert").hide(0),$("#logo").hide(0),$("#side-bar .side-menu-toggle.gear").css("top","170px")),$.ajax({url:"includes/get_markers.php"}).done(function(data){K.settings.main.iconUrl.count=$.parseJSON(data)}),K.checkLogin(()=>{!K.user.donate&&!K.urlParam("overwolf")&&$("#alert").show(),K.user.donate&&$("#alert").hide(),$("#message").removeClass("master");var shorts=$("#side-bar .shorts .side-content");if(shorts.html(""),$(".side-menu-toggle.shorts").hide(),$.each(K.bar.b,function(i,v){empty(v)}),empty(K.drawControl),$("document").off("keypress"),$("#side-bar a.login").removeClass("out"),K.user.type){$("#side-bar a.login").addClass("out"),$("#message").addClass("master"),!K.urlParam("overwolf")&&$(".side-menu-toggle.shorts").show();var key=function(k,t){return`<div class="item">\n                    <div>${k}</div>\n                    <div class="grey">-</div>\n                    <span>${t.replace(" Survival","")}</span>\n                </div>`};shorts.append('<span class="title">Shortcuts</span>'),$.each(K.shortcuts,function(sub,a){shorts.append(`<span class="title sub">${sub.space()}</span>`),$.each(a,function(k,t){shorts.append(key(k,t.space()))})}),shorts.append(K.credits),K.bar.b.power=L.control.button({text:"",container:"power",title:"Enable/disable tools",css:"power",clickFn:function(){K.bar.b.power._click()}}).addTo(K.myMap),K.bar.b.power=$.extend(K.bar.b.power,{enabled:function(){return!$(this._button).hasClass("enabled")},_click:function(){var el=$(this._button),buttons=$(".leaflet-top.leaflet-left").children().not(".power").find("a");this.enabled()||K.check.doOnce?(el.addClass("enabled"),$.each(K.bar.draw,function(i,type){type.disabler()}),$("#marker-tools, .group-switch, #settings-menu").remove(),K.bar.b.group.disable(),K.bar.b.tools.disable(),switchLayerGroups(!0),$(buttons.get().reverse()).each(function(index,btn){setTimeout(function(){$(btn).css("transform","translateX(-50px)")},40*index)})):(buttons.each(function(index,btn){setTimeout(function(){$(btn).css("transform","translateX(0px)")},40*index)}),el.removeClass("enabled"),$.each(K.bar.draw,function(i,type){type.enabler()}),K.bar.b.group.enable(),K.bar.b.tools.enable(),switchLayerGroups()),Cookies.set("powered",this.enabled(),K.expires),K.check.doOnce=!1}}),K.bar.b.save=L.control.button().addTo(K.myMap).disable(),K.bar.b.group=L.control.button({text:"",title:"Switch editable layers",css:"group",clickFn:function(){if($(".group-switch").length)$(".group-switch").remove();else{$("body").append('<div class="leaflet-menu group-switch"></div>');var div=document.getElementsByClassName("group-switch")[0];L.DomEvent.disableClickPropagation(div),L.DomEvent.on(div,"mousewheel",L.DomEvent.stopPropagation);var list=$.merge(K.map.mode[K.mode.get],K.map.mode.all).sort();$.unique(list),$.each(list,function(i,t){$(".leaflet-menu").append(`<a class="leaflet-menu-item switch-active-group \n                            ${K.map.active[t]?" active":""}" type="${t}">${t.space()}</a>`)}),$(".switch-active-group").on("click",function(e){var t=$(this).attr("type");$(this).toggleClass("active"),K.map.active[t]=!K.map.active[t],Cookies.set("activeMap",$.extend({},K.map.active),K.expires),switchLayerGroups()})}}}).addTo(K.myMap),K.bar.b.grid=L.control.button({text:"",title:"Grid modifier tools",css:"grid",clickFn:function(){var el=arguments[0]._button;if($("#slider-box").length)$("#slider-box").remove();else{var gridTools=["rotate","x-pos","y-pos"];$(el).after('<div id="slider-box"></div>'),$.each(gridTools,function(i,type){$("#slider-box").append(`<div class="leaflet-menu-slider">\n                            <div id="slider-${type}" class="slider-class ${type}">\n                                <div class="handle-${type} ui-slider-handle"></div>\n                            </div>\n                        </div>`),$("#slider-"+type).slider({min:"rotate"==type?-45:-100,max:"rotate"==type?45:100,step:"rotate"==type?.5:1,value:Cookies.get(`grid-${type}`)||0,create:function(){var val=$(this).slider("value");$(".handle-"+type).text("rotate"==type?val+" deg":"x-pos"==type?"X: "+val:"Y: "+val)},slide:function(e,ui){$(".handle-"+type).text("rotate"==type?ui.value+" deg":"x-pos"==type?"X: "+ui.value:"Y: "+ui.value),Cookies.set("grid-"+type,ui.value,K.expires),setGridRotate()},change:function(e,ui){$(".handle-"+type).text("rotate"==type?ui.value+" deg":"x-pos"==type?"X: "+ui.value:"Y: "+ui.value),Cookies.set("grid-"+type,ui.value,K.expires),setGridRotate()}})}),$("#slider-box").append('<div class="slider-resets"></div>'),$.each(gridTools,function(i,type){$(".slider-resets").append(`<a class="slider-button reset-${type}">Reset ${type.firstToUpper()}</a>`),$(".slider-button.reset-"+type).on("click",function(){$("#slider-"+type).slider("value",0)})}),$(".slider-resets").append('<a class="slider-button reset-all">Reset All</a>'),$(".slider-button.reset-all").on("click",function(){$(".slider-class").slider("value",0)});var div=L.DomUtil.get("slider-box");L.DomEvent.disableClickPropagation(div),L.DomEvent.on(div,"mousewheel",L.DomEvent.stopPropagation)}}}).addTo(K.myMap).disable(),K.bar.b.tools=L.control.button({text:"",title:"Toggle marker tool panel",css:"tools",clickFn:K.tool.marker.show}).addTo(K.myMap),K.updateMarker(),K.myMap.addControl(K.drawControl).on("draw:created",drawEventCreated),K.bar.draw.Polygon=K.drawControl._toolbars.draw._modes.polygon.handler,K.bar.draw.Polyline=K.drawControl._toolbars.draw._modes.polyline.handler,K.bar.draw.Rectangle=K.drawControl._toolbars.draw._modes.rectangle.handler,K.bar.draw.Marker=K.drawControl._toolbars.draw._modes.marker.handler,$(K.drawControl._toolbars.draw._modes.circlemarker.button).remove(),delete K.drawControl._toolbars.draw._modes.circlemarker,K.bar.edit.Edit=K.drawControl._toolbars.edit._modes.edit.handler,K.bar.edit.Remove=K.drawControl._toolbars.edit._modes.remove.handler,$(document).off("keypress"),$(document).on("keypress",keypressEvent),drawButtons=$(".leaflet-draw-section"),K.myMap.on("draw:editstart",function(e){polyHoverAnimation(!0),$("#settings-menu, .group-switch, #marker-tools").remove(),K.bar.b.power.disable(),K.bar.b.group.disable(),K.bar.b.save.disable(),K.bar.b.tools.disable(),K.myMap.addLayer(K.group.draw).addLayer(K.grid.overlay),K.bar.b.grid.enable(),setGridRotate(),K.bar.edit.Remove.disabler(),$.each(K.bar.draw,function(i,type){type.disabler()}),K.check.editing=!0,editIconMessage()}),K.myMap.on("draw:edited",function(e){e.layers.eachLayer(function(l){l.saved(!1)})}),K.myMap.on("draw:editstop",function(e){K.bar.b.power.enable(),K.bar.b.group.enable(),K.bar.b.tools.enable(),K.save.check(),K.myMap.removeLayer(K.grid.overlay),K.bar.b.grid.disable(),$("#slider-box").remove(),K.bar.edit.Remove.enabler(),$.each(K.bar.draw,function(i,type){type.enabler()}),K.check.editing=!1,polyHoverAnimation(),onZoomEnd(!0)}),K.myMap.on("draw:deletestart",function(e){K.check.deleting=!0,$.each(K.bar.b,function(i,type){type.disable()}),K.bar.edit.Edit.disabler(),$.each(K.bar.draw,function(i,type){type.disabler()}),K.myMap.addLayer(K.group.draw).addLayer(K.grid.overlay),setGridRotate()}),K.myMap.on("draw:deleted",function(e){K.group.draw.eachLayer(function(l){var i=l._leaflet_id;K.group.draw.removeLayer(i),K.save.delete(l)})}),K.myMap.on("draw:deletestop",function(e){K.check.deleting=!1,K.bar.b.power.enable(),K.bar.b.group.enable(),K.save.check(),K.bar.edit.Edit.enabler(),$.each(K.bar.draw,function(i,type){type.enabler()}),onZoomEnd(!0)}),K.myMap.on("draw:drawstop",function(e){K.msg.show({msg:"Remember, you may have to zoom in to see the layers you create!",time:2500})})}K.user.type&&K.check.doOnce&&K.bar.b.power._onClick();var btn="#side-bar a.mode",b1=K.mode.not("survival","normal"),b2=K.mode.not("last stand","normal");$.each(K.modes.get,function(i,mode){$(btn).removeClass(mode),$("#logo").removeClass(mode)}),$(btn+".one").text(b1.titleCase()+" Map").addClass(b1),$(btn+".two").text(b2.titleCase()+" Map").addClass(b2),$("#logo").addClass(K.mode.get);var populateMap=function(e){var newLayer,properties=e.properties,geometry=e.geometry;if(properties){if(properties.type||(properties.type=""),properties.type&&!K.isInArray(properties.type,K.map.group[properties.group])&&K.map.group[properties.group].push(properties.type),properties.type&&properties.mode&&properties.shape){var filter=!1;if(K.user.type<1?properties.type.contains("Complete")||"Error"==properties.type||(filter=!0):K.user.type<=3?properties.type.contains(K.user.name)?filter=!0:properties.type.contains("Complete")||"Error"==properties.type||(filter=!0):K.user.type>=4&&(filter=!0),filter){var val=properties.fillColor;"marker"==properties.shape&&(val=properties.icon.options.iconUrl),"polyline"==properties.shape&&(val=properties.color),K.map.type.counts[properties.type]?K.map.type.counts[properties.type]++:K.map.type.counts[properties.type]=1,$.each(K.modes.get,function(i,mode){var category=properties.category||"Default",object=K.map.type[mode];object[category]||(object[category]={}),(properties.mode.bMatch(mode)||"all"==properties.mode)&&(object[category][properties.type]||(object[category][properties.type]=[]),K.isInArray(val,object[category][properties.type])||(object[category][properties.type].push(val),"polygon"==properties.shape&&object[category][properties.type].push(properties.color)))})}}for(setting in properties.mode in K.map.mode||(K.map.mode[properties.mode]=[]),properties.mode&&properties.type&&!K.isInArray(properties.type,K.map.mode[properties.mode])&&K.map.mode[properties.mode].push(properties.type),properties)properties[setting]=toCorrectType(setting,properties[setting]),setting in K.settings.main&&"count"in K.settings.main[setting]&&addSet(K.settings.main[setting].count,properties[setting]);var pCn="popup"in e&&"options"in e.popup?e.popup.options.className:"";if("marker"==properties.shape&&properties.type){properties.icon.options.className+=` ${properties.group} ${pCn}`;var obj=$.extend(!0,{},e,{properties:{icon:{options:{className:(properties.icon.options.className||"").replace(/\w+ground/g,"").trim()}}}});$.each(K.modes.get,function(i,mode){var tool=K.tool.marker.layers[mode];(properties.mode.contains(mode)||"all"==properties.mode)&&(properties.category in tool||(tool[properties.category]={}),properties.type in tool[properties.category]||(tool[properties.category][properties.type]=obj))})}if("Polyline"==geometry.type)newLayer=L.polyline(geometry.coordinates,properties);else if("Polygon"==geometry.type||"Rectangle"==geometry.type){var obj=$.extend(properties,{pane:properties.pane||("poly-hover"==properties.className?"zonePane":"overlayPane")});newLayer="Rectangle"==geometry.type?L.rectangle(geometry.coordinates,obj):L.polygon(geometry.coordinates,obj)}else if("Point"==geometry.type)for(setting in properties.icon.options.className+=` ${properties.group}  ${pCn}`,newLayer=createMarker($.extend(properties,properties.icon.options,{latlng:geometry.coordinates})),properties.icon.options)properties.icon.options[setting]=toCorrectType(setting,properties.icon.options[setting]),setting in K.settings.main&&"count"in K.settings.main[setting]&&addSet(K.settings.main[setting].count,properties.icon.options[setting]);if("popup"in e&&("content"in e.popup||"options"in e.popup&&"list"in e.popup.options&&e.popup.options.list.title)){var o=e.popup;o.options.className||(o.options.className=""),newLayer.bindPopup(o.content,{className:o.options.className,list:o.options.list||{}}),K.user.type&&addSet(K.settings.popup.className.count,e.popup.options.className)}K.user.type&&(K.user.type>=4||properties.creator.toLowerCase()==K.user.name.toLowerCase())&&newLayer.on("click",K.tool.layer.show),properties.complete&&"marker"===properties.shape&&newLayer.on("contextmenu",function(){this.toggleCompleted(!0)});var add=!1;K.user.type<1?properties.type.contains("Complete")||"Error"==properties.type||(add=!0):K.user.type<=3?properties.type.contains(K.user.name)?add=!0:properties.type.contains("Complete")||"Error"==properties.type||(add=!0):K.user.type>=4&&(add=!0),add&&addToFeatureGroups(newLayer),newLayer.markComplete()}},populateMenus=function(){onZoomEnd(),K.user.type&&switchLayerGroups(),K.completeHidden=Cookies.get("completeHidden")||!1;var sb="#side-bar .filters .side-content";$(sb).html(""),$(sb).append(`<a class="hide-all" title="Show/Hide all!"></a>\n                <span class="title">${K.mode.get.titleCase()} Filters</span>\n                <a class="hide-complete${K.completeHidden?' hidden">Show':'">Hide'} Complete</a>`);var list=K.map.type[K.mode.get];if(list=sortObjByKeys(list),K.filters=Cookies.get("filters")||{},$.each(list,function(category,types){Object.keys(types).length&&(types=sortObjByKeys(types),$(sb).append(`<div class="sub title buttons">\n                            <a class="collapse">\n                                <span class="text">${category.firstToUpper()}</span>\n                                <span class="control icon" title="Collapse/Expand ${category}"></span>\n                            </a>\n                            <a class="control hide-some" category="${category}" title="Show/Hide all ${category}"></a>\n                        </div>`),$.each(types,function(type,i){var active=K.filters[type]||!1,el=$("<a />",{class:"side-bar-button "+(active?"inactive":""),set:category,label:type,html:$("<span />",{html:type.space().replace(/Dz/,"DZ").replace(/ (Survival|Complete)/,"").replace(" Of "," of ")})}).appendTo(sb);$("<span />",{html:"[ x"+K.map.type.counts[type]+" ]",class:"quantity"}).appendTo(el),i[0].contains(".svg")?$("<img />",{src:i[Math.floor(Math.random()*i.length)]}).prependTo(el):"polyline"==category?$("<div />",{class:"polyline"}).css({backgroundColor:i[0]}).prependTo(el):$("<div />",{class:"polygon"}).css({borderColor:i[1],backgroundColor:i[0]}).prependTo(el),active&&showHideLayers(category,type,!0)}))}),$("#side-bar .side-bar-button").off("click").on("click",function(){$(this).toggleClass("inactive"),toggleHideIcons();var t=$(this).attr("label"),ia=$(this).hasClass("inactive");K.filters=Cookies.get("filters")||{},K.filters[t]=ia,Cookies.set("filters",K.filters,K.expires),showHideLayers($(this).attr("set"),t,ia)}),$("#side-bar .hide-all").off("click").on("click",function(){showHideAllLayers(!$(this).hasClass("hidden")),toggleHideIcons()}),$("#side-bar .hide-some").off("click").on("click",function(){showHideCategory($(this).attr("category"),!$(this).hasClass("hidden")),toggleHideIcons()}),$("#side-bar .hide-complete").off("click").on("click",function(){K.completeHidden?($(this).removeClass("hidden").text("Hide Complete"),K.completeHidden=!1):($(this).addClass("hidden").text("Show Complete"),K.completeHidden=!0),Cookies.set("completeHidden",K.completeHidden),K.complete.showHide()}),K.complete.showHide(),toggleHideIcons(),$("#side-bar .collapse").off("click").on("click",function(){var icon=$(".icon",this),list=$(this).parent().nextUntil(".sub.title");icon.hasClass("hidden")?(list.each(function(i,el){$(this).show(400)}),icon.removeClass("hidden")):(list.each(function(i,el){$(this).hide(400)}),icon.addClass("hidden"))}),$(sb).append(K.credits),Cookies.get("sideBar")&&!Cookies.get("cleanMenu")){var a=Cookies.get("sideMenu");$("#side-bar, #side-bar ."+a).addClass("active "+a)}polyHoverAnimation(),$('[title!=""]').qtip({position:{viewport:$("#mapid"),my:"left center",at:"right center"},style:{classes:"tooltip-style"},show:{delay:250,solo:!0},hide:{event:"click mouseleave"}}),$(document).on("mouseover",'[title!=""]',function(e){$(this).attr("title")&&($(this).removeAttr("oldtitle"),$(this).qtip("destroy",!0),$(this).qtip({position:{viewport:$("#mapid"),my:"left center",at:"right center"},style:{classes:"tooltip-style"},show:{delay:250,solo:!0},hide:{event:"click mouseleave"}}),$(this).qtip("toggle",!0))}),setTimeout(function(){$("#survival-logo").fadeOut(1e3)},1e3),$(".paypalBtn").off("click").on("click",function(){$("#side-bar .filters .paypalBtn").closest("form").submit()})};$.ajax({type:"POST",url:"includes/file_exists.php",data:{data:K.user.name}}).done(function(a){a=$.parseJSON(a),K.userPath=a?"data/"+K.user.name+"/geoJSON.json":"data/empty.json",$.ajax({type:"POST",url:"includes/file_date.php",data:{path:K.userPath}}).done(function(data){data=$.parseJSON(data),$.getJSON(`${K.userPath}?v=${data.date}`,function(userJSON){$.ajax({type:"POST",url:"includes/file_date.php",data:{path:"data/geoJSON.json"}}).done(function(data){data=$.parseJSON(data),$.getJSON(`data/geoJSON.json?v=${data.date}`,function(geoJSON){$.each(K.group.feature,function(i,mode){$.each(mode,function(j,group){group.clearLayers(),K.myMap.removeLayer(group)})}),K.map.type.counts={},K.complete.layers=[],K.timed.layers=[],userJSON.features&&$.extend(geoJSON.features,userJSON.features),$.each(geoJSON.features,function(i,e){populateMap(e)})}).done(function(){populateMenus()})})})})})})}function doDonator(){$.ajax({type:"POST",url:"includes/process_donator.php",data:{email:$("#donator").val()}}).done(function(a){(a=$.parseJSON(a)).success?($("#side-bar .login .success").html(a.success),$("#side-bar .login .error").html(""),$("#donator").val("")):($("#side-bar .login .error").html(a.error),$("#side-bar .login .success").html(""))})}function doLogin(){_this=document.getElementById("login"),formhash(_this,_this.password),$.ajax({type:"POST",url:"includes/process_login.php",data:{email:_this.username.value,p:_this.p.value}}).done(function(a){Cookies.get("username")&&(K.user.name=Cookies.get("username"),K.user.type=Cookies.get("usertype"),K.user.getData()),Cookies.get("donate")?$("#alert").hide():$("#alert").show(),a&&($("#side-bar .login .side-content").html(a),K.check.doOnce=!0,pageLoad())})}function doRegister(){_this=document.getElementById("regform"),regformhash(_this,_this.username,_this.email,_this.password,_this.confirmpwd)?$.ajax({type:"POST",url:"includes/process_register.php",data:{username:_this.username.value,email:_this.email.value,p:_this.p.value}}).done(function(a){a=a.bMatch(/^(\{|\[])".*(\}|\])$/)?$.parseJSON(a):a,"object"==$.type(a)&&a.error?$("#side-bar .login .error").html(a.error):$("#side-bar .login .side-content").html(a)}):$("#side-bar .login .error").html(K.user.error)}function doReset(){_this=document.getElementById("reset"),resetformhash(_this,_this.password,_this.confirmpwd)?$.ajax({type:"POST",url:"includes/process_reset.php",data:{token:K.urlParam("token"),p:_this.p.value}}).done(function(a){a=a.bMatch(/^(\{|\[])".*(\}|\])$/)?$.parseJSON(a):a,"object"==$.type(a)&&a.error?$("#side-bar .login .error").html(a.error):window.location.href=window.location.href.split("?")[0]}):$("#side-bar .login .error").html(K.user.error)}function doForgot(){_this=document.getElementById("forgot"),$.ajax({type:"POST",url:"includes/process_forgot.php",data:{email:_this.email.value}}).done(function(a){var result=a.bMatch(/^(\{|\[])".*(\}|\])$/)?$.parseJSON(a):a;$.ajax({url:"includes/login.php"}).done(function(b){b&&$("#side-bar .login .side-content").html(b),"object"==$.type(result)&&(result.error&&$("#side-bar .login .error").html(result.error),result.success&&$("#side-bar .login .success").html(result.success))})})}function randomInt(min,max){return min=Math.ceil(min),max=Math.floor(max),Math.floor(Math.random()*(max-min))+min}function keypressEvent(e){if(K.user.type&&!K.tool.layer.isOpen()&&K.bar.b.power.enabled()){109==e.which?(e.preventDefault(),K.bar.draw.Marker.toggle()):114==e.which?(e.preventDefault(),K.bar.draw.Rectangle.toggle()):112==e.which?(e.preventDefault(),K.bar.draw.Polygon.toggle()):108==e.which&&(e.preventDefault(),K.bar.draw.Polyline.toggle());var quickAction=function(type){K.tool.marker.show(!0),$('#marker-tools a[type="'+type+'"]').trigger("click")},key=K.shortcuts.QuickMarker;115==e.which?(e.preventDefault(),quickAction(key.S)):49==e.which?(e.preventDefault(),quickAction(key[1])):50==e.which?(e.preventDefault(),quickAction(key[2])):51==e.which?(e.preventDefault(),quickAction(key[3])):52==e.which?(e.preventDefault(),quickAction(key[4])):53==e.which?(e.preventDefault(),quickAction(key[5])):101==e.which?(e.preventDefault(),quickAction(key.E)):97==e.which?(e.preventDefault(),quickAction(key.A)):102==e.which?(e.preventDefault(),quickAction(key.F)):100==e.which?(e.preventDefault(),quickAction(key.D)):113==e.which?(e.preventDefault(),quickAction(key.Q)):119==e.which?(e.preventDefault(),quickAction(key.W)):122==e.which?(e.preventDefault(),$('#marker-tools input[value=""]').prop("checked",!0),$("#marker-tools a").removeClass("underground overground")):120==e.which?(e.preventDefault(),$('#marker-tools input[value="underground"]').prop("checked",!0),$("#marker-tools a").removeClass("underground overground").addClass("underground")):99==e.which&&(e.preventDefault(),$('#marker-tools input[value="overground"]').prop("checked",!0),$("#marker-tools a").removeClass("underground overground").addClass("overground"))}}function drawEventCreated(e){var layer=e.layer,type=e.layerType,popup=!1,copy=Cookies.get("copy")||{},obj,obj;if("marker"==type){var selected=$("#marker-tools a.enabled");if(K.tool.marker.enabled()&&selected.length){var lvl=$('input[name="radio"]:checked').val(),cat=selected.attr("category"),typ=selected.attr("type"),j=K.tool.marker.layers[K.mode.get][cat][typ],p=j.properties;lvl=lvl?" "+lvl:"",layer=createMarker($.extend({},p,p.icon.options,{id:ID(),latlng:layer._latlng,className:p.icon.options.className+lvl})),popup=j.popup}else icon="object"==$.type(mark=copy.marker)?mark:K.map.defaults.marker,layer=createMarker($.extend({},icon,{id:ID(),latlng:layer._latlng}));layer.markComplete()}if(("polygon"==type||"rectangle"==type)&&((obj=copy.polygon||K.map.defaults.polygon)&&"object"==$.type(obj))){var ll=layer._latlngs[0].removeDupes();$.extend(obj,{id:ID(),pane:"poly-hover"==obj.className?"zonePane":"overlayPane",mode:obj.mode||K.mode.get}),layer="rectangle"==type?L.rectangle(ll,obj):L.polygon(ll,obj)}"polyline"==type&&((obj=copy.polyline||K.map.defaults.polyline)&&"object"==$.type(obj)&&(layer=L.polyline(layer._latlngs.removeDupes(),$.extend(obj,{id:ID(),mode:obj.mode||K.mode.get}))));o=popup||copy[type+"Popup"]||{},(o.content||o.options&&o.options.list&&o.options.list.title)&&layer.bindPopup(o.content,$.extend(!0,{},o.options)),layer.options.creator=K.user.name,layer.options.group=layer.options.group||"group08",K.group.mode[layer.options.group].addLayer(layer),layer.on("click",K.tool.layer.show),layer.options.complete&&"marker"===layer.options.shape&&layer.on("contextmenu",function(){this.toggleCompleted(!0)}),layer.saved(!1),switchLayerGroups(),polyHoverAnimation()}function setCollectionData(){$("#side-bar .img-check").removeClass("checked"),$.ajax({type:"POST",url:"includes/collection_data_get.php"}).done(function(a){if(Cookies.json=!0,setData=!!a.bMatch(/(\{|\[])".*(\}|\])/)&&$.parseJSON(a),!setData){var setData1=Cookies.getJSON("setData1"),setData2=Cookies.getJSON("setData2");"object"===$.type(setData1)&&"object"===$.type(setData2)&&(setData=$.extend({},setData1,setData2))}setData&&$.each(setData,function(index,val){val&&$(`#side-bar .img-check[name="${index}"]`).addClass("checked")}),updateSetCounter()})}function updateSetCounter(){$(".set-piece").each(function(index,el){var count=$(this).find(".img-check.checked").length;$(this).find(".counter").html(count||""),$(this).find(".set-bonus").removeClass("active");for(var i=count;i>0;i--)$(this).find(".set-bonus."+i).addClass("active")});var checks="#side-bar .img-check",total,got,left=$(checks).length-$(checks+".checked").length,counters=$("#side-bar .counter"),totalSets=counters.length,sets=0,m;counters.each(function(index,el){6==$(this).text()&&sets++});var setData={};if($(checks).each(function(index,el){setData[$(this).attr("name")]=$(this).hasClass("checked")}),$("#side-bar .warning").html(""),K.user.type)$.ajax({type:"POST",url:"includes/collection_data_set.php",data:{setData:JSON.stringify(setData)}}).done(function(a){Cookies.remove("setData")});else{$("#side-bar .warning").html("This data is stored as a cookie, if you would            like it to be persistant, please create an account or sign in.");for(var setData1={},setData2=setData;Object.keys(setData1).length<Object.keys(setData2).length;){var key=Object.keys(setData2)[0];setData1[key]=setData2[key],delete setData2[key]}Cookies.set("setData1",setData1,K.expires),Cookies.set("setData2",setData2,K.expires)}translator()}function empty(obj){"boolean"!=$.type(obj)&&(obj.remove(),obj=!1)}function removeEmpty(obj){var typ="array"==$.type(obj);return $.each(obj,function(i,v){K.isInArray($.type(v),["object","array"])&&(obj[i]=removeEmpty(v));var t=$.type(v);("string"==t&&!v||"object"==t&&!Object.keys(v).length||"array"==t&&!v.length||"function"==t)&&(typ?obj.splice(i,1):delete obj[i])}),obj}function sortObjByKeys(object){var keys=Object.keys(object),rObj={};return keys.sort(naturalCompare),$.each(keys,function(i,v){rObj[v]=object[v]}),rObj}function addToFeatureGroups(layer){var m=layer.options.mode,g=layer.options.group;layer.currentGroup=g,$.each(K.modes.get,function(i,mode){(m.contains(mode)||"all"==m)&&K.group.feature[mode][g].addLayer(layer)&&K.group.feature[mode].everyLayer.addLayer(layer)})}function polyHoverAnimation(stop){var polys=$('path.leaflet-interactive:not(.poly-hover):not([fill="none"])');polys.off("mouseover mouseout"),stop||polys.on("mouseover",function(){var _this=$(this),cls=_this.attr("class").split(" ");$.each(cls,function(i,c){c.contains("phg")&&(_this=$("path."+c))}),_this.addClass("hover")}).on("mouseout",function(){var _this=$(this),cls=_this.attr("class").split(" ");$.each(cls,function(i,c){c.contains("phg")&&(_this=$("path."+c))}),_this.removeClass("hover")})}function editIconMessage(){var editIcon=$(".leaflet-editing-icon"),elMessage=$("#message"),elWarning;elMessage.children(".message").length||elMessage.append('<div class="message"></div>'),elWarning=elMessage.children(".message"),editIcon.length>1e3&&elWarning.text("There are "+editIcon.length+" editing icons, \t\tyou may want to switch groups to speed things up!"),elWarning.text(""),K.check.editing&&setTimeout(editIconMessage,2e3)}function setGridRotate(reset){var grid=$(".leaflet-overlay-pane").children().last();if("images/grid.svg"==grid.attr("src")){var gridM=grid.css("transform").split(",");K.grid.x=!K.grid.x||reset?gridM[4]:K.grid.x,K.grid.y=!K.grid.y||reset?gridM[5].replace(")",""):K.grid.y,K.grid.r=Cookies.get("grid-rotate")||0;var gridXAlt=Cookies.get("grid-x-pos")||0,gridYAlt=Cookies.get("grid-y-pos")||0;Number(K.grid.x),Number(K.grid.y),Number(K.grid.r),Number(gridXAlt),Number(gridYAlt);var css=`translate3d(${K.grid.x*(gridXAlt/1e5+1)}px, \n        ${K.grid.y*(gridYAlt/1e5+1)}px, 0px) rotate(${K.grid.r}deg)`;grid.css({transformOrigin:"center",transform:css})}}function toggleHideIcons(){$("#side-bar .side-bar-button:not(.inactive)").length?$("#side-bar .hide-all").removeClass("hidden"):$("#side-bar .hide-all").addClass("hidden"),$("#side-bar .filters .side-content").children("").each(function(){if($(this).hasClass("sub")){var group=$(this).nextUntil(".sub, div"),count=0;group.each(function(){$(this).hasClass("inactive")&&count++}),$(".hide-some",this).removeClass("hidden"),count==group.length&&$(".hide-some",this).addClass("hidden")}})}function createMarker(p){return p.html=p.iconUrl?"":p.html,L.marker(p.latlng,{icon:createIcon({url:p.iconUrl,size:p.iconSize,html:p.html,className:p.className}),creator:p.creator,category:p.category||"default",id:p.id,opacity:p.opacity||"",group:p.group||"",complete:p.complete||!1,time:p.time||"",link:p.link||"",type:p.type||getType(p.iconUrl,p.group,p.iconUrl?"marker":"html"),shape:p.shape||"marker",riseOnHover:!0,zIndexOffset:K.isInArray(p.type,K.map.zIndex)?1e3:0,mode:p.mode||getMode(p.type)})}function createIcon(options){var o={url:"",size:"",html:"",className:"",done:!1,time:!1};return $.extend(o,options),L.divIcon({iconUrl:o.url,iconSize:o.size,html:o.html||`${o.className.contains("anim-icon")?'<img class="halo" src="images/_a.svg">':""} \n                <img src="${o.url||""}" class="icon">\n                ${o.done&&!o.time?'<img src="images/complete.svg" class="done">':""}\n                ${o.done&&o.time?`<span class="time">${o.time}</span>`:""}\n                ${K.svg.dot}`,className:o.className.filter()})}function showHideAllLayers(show){$.each(K.map.type[K.mode.get],function(category,array){$.each(array,function(type,i){var btn=$(`[set="${category}"][label="${type}"]`);btn.removeClass("inactive"),show&&btn.addClass("inactive"),K.filters=Cookies.get("filters")||{},K.filters[type]=show,Cookies.set("filters",K.filters,K.expires),showHideLayers(category,type,show)})})}function showHideCategory(category,show){$.each(K.map.type[K.mode.get][category],function(type){var btn=$(`[set="${category}"][label="${type}"]`);btn.removeClass("inactive"),show&&btn.addClass("inactive"),K.filters=Cookies.get("filters")||{},K.filters[type]=show,Cookies.set("filters",K.filters,K.expires),showHideLayers(category,type,show)})}function showHideLayers(category,type,h){var g,show,hide,group;switchLayerGroups(!0),$.each(K.map.group,function(grp,a){K.isInArray(type,a)&&(g=K.group.mode[grp],show=h?K.group.mode.groupHidden:g,hide=h?g:K.group.mode.groupHidden,group=h?"groupHidden":grp,show&&hide&&hide.eachLayer(function(l){var i=l._leaflet_id;l.options.type==type&&l.options.category==category&&(show.addLayer(hide.getLayer(i)),hide.removeLayer(i),l.currentGroup=group)}))}),switchLayerGroups(),polyHoverAnimation()}function toCorrectType(setting,value){if(!K.settings.main[setting])return value;var type=K.settings.main[setting].type;return"number"==type?Number(value):"boolean"==type?!!value:value}function addSet(i,v,n){"array"==$.type(v)&&(v=v.join(",")),v&&!K.isInArray(v,i)&&i.push(v)}function offset(latlng,oLat,oLng){return oLat&&(latlng.lat+=oLat),oLng&&(latlng.lng+=oLng),latlng}function textColor(hex){var hex=hex.substring(1),rgb=parseInt(hex,16),r,g,b,luma;return.2126*(rgb>>16&255)+.7152*(rgb>>8&255)+.0722*(rgb>>0&255)<40?"#ffffff":"#000000"}function removeLayer(layer,group,del){var grp=group||layer.options.group,id=layer._leaflet_id;del&&K.save.delete(layer),K.group.draw.removeLayer(id),$.each(K.modes.get,function(i,mode){K.group.feature[mode][grp].removeLayer(id)})}function createPoint(e,f){return $.isArray(e)?L.point(e[0],e[1]):L.point(e,f)}function switchLayerGroups(d){$.each(K.group.draw._layers,function(i,l){l.editing.currentGroup=l.options.group,K.group.mode[l.options.group].addLayer(K.group.draw.getLayer(i)),K.group.draw.removeLayer(i)}),!d&&$.each(K.group.mode,function(j,g){g.eachLayer(function(l){(K.map.active[l.options.type]&&(l.options.creator==K.user.name||K.user.type>3)||l.editing.edit)&&(l.editing.currentGroup="drawLayer",K.group.draw.addLayer(K.group.mode[l.options.group].getLayer(l._leaflet_id)),K.group.mode[l.options.group].removeLayer(l._leaflet_id))})}),K.myMap.removeLayer(K.group.draw).addLayer(K.group.draw).addLayer(K.group.mode.groupAll),onZoomEnd(!0)}function createGeoJSON(){$("#settings-menu").remove(),K.backup=K.user.name,K.checkLogin(()=>{if(K.backup==K.user.name){K.msg.show({msg:"SAVING...",dots:!0});var feature,geoData={features:{},deleted:K.save.deleted};switchLayerGroups(!0),K.save.unsaved.eachLayer(function(layer){if(layer.removeClass(K.classRemoval),"_latlng"in layer){feature={properties:{icon:{options:{}}},geometry:{type:"Point",coordinates:layer._latlng}};var iO=layer.options.icon.options;"array"===$.type(iO.html)&&(iO.html=iO.html.join("")),$.each(layer.options,function(k,z){feature.properties[k]=fix(z)}),$.each(feature.properties,function(i,v){!K.isInArray(i,K.map.property.marker)&&delete feature.properties[i],!v&&delete feature.properties[i]}),iO.iconUrl&&delete feature.properties.icon.options.html,$.each(feature.properties.icon.options,function(i,v){!v&&delete feature.properties[i]}),delete feature.properties.icon._initHooksCalled}else"_latlngs"in layer&&"lat"in layer._latlngs[0]?(feature={properties:{},geometry:{type:"Polyline",coordinates:layer._latlngs}},$.each(layer.options,function(k,z){feature.properties[k]=fix(z)}),$.each(feature.properties,function(i,v){!K.isInArray(i,K.map.property.polyline)&&delete feature.properties[i],!v&&delete feature.properties[i]})):"_latlngs"in layer&&(feature={properties:{},geometry:{type:polyType(layer._latlngs),coordinates:layer._latlngs}},$.each(layer.options,function(k,z){feature.properties[k]=fix(z)}),$.each(feature.properties,function(i,v){!K.isInArray(i,K.map.property.polygon)&&delete feature.properties[i],!v&&delete feature.properties[i]}));"_popup"in layer&&layer._popup&&layer._popup._content&&(feature.popup={content:layer._popup._content,options:{className:layer._popup.options.className,list:layer._popup.options.list}},$.each(K.popupContent,function(k,s){layer._popup._content==s&&(feature.popup.content=k)}),feature.popup.options.list.title&&delete feature.popup.content),feature.properties.mode=layer.options.mode||getMode(layer.options.type),feature.properties.id=layer.options.id||ID(),geoData.features[feature.properties.id]=feature}),$.ajax({type:"POST",url:"includes/write.php",data:{data:JSON.stringify(geoData)}}).done(function(a){a=a.bMatch(/^(\{|\[])".*(\}|\])$/)?$.parseJSON(a):a,"object"==$.type(a)&&a.message?alert(a.message):(K.bar.b.save.disable(),K.save.unsaved.clearLayers(),K.save.deleted=[],polyHoverAnimation(),K.msg.hide(),pageLoad())})}else alert("I'm sorry but your account information is incorrect, you cannot save your changes! Please log in and try again!")})}function toggleFullScreen(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOWKEYBOARD_INPUT)}function fix(s){return Number(s)?Number(s):s}function polyType(l){return 1==l.length&&4==l[0].length&&l[0][0].lat==l[0][3].lat&&l[0][0].lng==l[0][1].lng?"Rectangle":l[0].lat?"Polyline":"Polygon"}function getType(o,g,a){if(!K.isInArray(a,["marker","polyline","polygon"]))return"";var type="";return o=o.replace("images/",""),$.each(K.map.type,function(h,tg){$.each(tg[a],function(i,v){K.isInArray(o,v)&&(type=i)})}),type}function getMode(type){return fMode="all",$.each(K.map.mode,function(mode,array){K.isInArray(type,array)&&(fMode=mode)}),fMode}function setAllLayerClick(){var layers;K.group.feature[K.mode.get].everyLayer.eachLayer(function(l){l.off("click"),K.check.grabbing?l.on("click",function(){return this.options.id}):K.user.type&&(K.user.type>=4||l.options.creator.toLowerCase()==K.user.name.toLowerCase())&&l.on("click",K.tool.layer.show)})}function onZoomEnd(){setGridRotate(!0),zoom=K.myMap.getZoom();let classes="";for(let i=7;i<12;i++)classes+=` z${i}`;$("#mapid").removeClass(classes),$("#mapid").addClass(`z${Math.floor(zoom)}`),$.each(K.group.mode,function(g,n){var a=g.replace("group","");"number"==typeof(a=a.contains("_")?a.split("_"):a.bMatch(/\d+/)?Number(a):!K.isInArray(a,["Hidden","Complete","everyLayer"])&&0)&&zoom>=a-1||"object"==typeof a&&zoom>=a[0]-1&&zoom<=a[1]+1?("groupDZ"==g&&K.myMap.removeLayer(K.group.mode[g]),K.myMap.addLayer(K.group.mode[g])):K.myMap.removeLayer(K.group.mode[g])})}function urlExists(url,callback){$.ajax({type:"HEAD",url:url,success:function(){callback(!0)},error:function(){callback(!1)}})}function setSelectionRange(input,selectionStart,selectionEnd){if(input.setSelectionRange)input.focus(),input.setSelectionRange(selectionStart,selectionEnd);else if(input.createTextRange){var range=input.createTextRange();range.collapse(!0),range.moveEnd("character",selectionEnd),range.moveStart("character",selectionStart),range.select()}}function setCaretToPos(input,posA,posB){setSelectionRange(input,posA,posB||posA)}K.currentUpdate="15/05/2019",L.Draw.Feature.include({enable:function(){this._disabled||this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DRAWSTART,{layerType:this.type}))},toggle:function(){this._enabled?(L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DRAWSTOP,{layerType:this.type}),this.fire("disabled",{handler:this.type})):(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DRAWSTART,{layerType:this.type}))},disabler:function(){return this._disabled=!0,this.disable(),this._updateDisabled(),this},enabler:function(){return this._disabled=!1,this._updateDisabled(),this},_updateDisabled:function(){var className="leaflet-disabled";this._button||(this._button=document.getElementsByClassName("leaflet-draw-draw-"+this.type)[0]),L.DomUtil.removeClass(this._button,className),this._disabled&&L.DomUtil.addClass(this._button,className)}}),L.EditToolbar.include({getActions:function(){return[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}]}}),L.EditToolbar.Delete.include({enable:function(){this._disabled||!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DELETESTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disabler:function(){return this._disabled=!0,this.disable(),this._updateDisabled(),this},enabler:function(){return this._disabled=!1,this._updateDisabled(),this},_updateDisabled:function(){var className="leaflet-disabled";this._button||(this._button=document.getElementsByClassName(`leaflet-draw-edit-${this.type}`)[0]),L.DomUtil.removeClass(this._button,className),this._disabled&&L.DomUtil.addClass(this._button,className)}}),L.EditToolbar.Edit.include({enable:function(){this._disabled||!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.EDITSTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this))},disabler:function(){return this._disabled=!0,this.disable(),this._updateDisabled(),this},enabler:function(){return this._disabled=!1,this._updateDisabled(),this},_updateDisabled:function(){var className="leaflet-disabled";this._button||(this._button=document.getElementsByClassName(`leaflet-draw-edit-${this.type}`)[0]),L.DomUtil.removeClass(this._button,className),this._disabled&&L.DomUtil.addClass(this._button,className)}}),L.Layer.include({openPopup:function(layer,latlng){if(layer instanceof L.Layer||(latlng=layer,layer=this),layer instanceof L.FeatureGroup)for(var id in this._layers){layer=this._layers[id];break}return this._popup._content?(this._popup.setContent(this._popup._content),latlng||(latlng=layer.getCenter?layer.getCenter():layer.getLatLng()),this._popup._content?(this._popup&&this._map&&(this._popup._source=layer,this._popup.update(),this._map.openPopup(this._popup,latlng)),this):this):this},bindPopup:function(content,options){if(options=$.extend({className:"",pane:(options.className||"").contains("poly-info")?"messagePane":"popupPane",list:{},offset:L.point(-24,42),closeButton:!1,autoPan:!1,minWidth:15,maxWidth:300},options),!content&&options.list.title&&(content=this.convertContent(options)),content instanceof L.Popup)L.setOptions(content,options),this._popup=content,content._source=this;else{if("object"==$.type(content)&&"_content"in content&&!content._content)return this;content=(content||"").bMatch(/^\$/)?K.popupContent[content]:content,this._popup&&!options||(this._popup=new L.Popup(options,this)),this._popup.setContent(content)}return this._popupHandlersAdded||(this.on({click:this._openPopup,remove:this.closePopup,move:this._movePopup}),this.on("mouseover click focus",this._openPopup).on("mouseout blur",this.closePopup),this._popupHandlersAdded=!0),this},convertContent:function(options){var list=options.list,html="",img,mark;return list.title&&(html+=list.title),$.each(list.subs,function(i,v){v.value&&(html+=`<p class="${v.color?"desc":""} ${v.note?"note":""}">${v.value}</p>${v.line?"<hr>":""}`)}),list.list&&list.list[0]&&list.list[0].item&&(list.list.sort(function(a,b){return a.item<b.item?-1:a.item>b.item?1:0}),html+="<ul>",$.each(list.list,function(i,v){if(!v)return!0;var n=(v.item||"").replace(/ /g,"");$.each(K.tool.marker.layers,function(j,w){w[n]&&(mark=w[n])}),img=`<img${mark?` src="${mark.properties.icon.options.iconUrl}"`:""}>`,html+=`<li>${img}<span>${v.item}</span><span class="qty">'${v.qty>1?"(x"+v.qty+")":""}</span></li>`}),html+="</ul>"),html},closePopup:function(){return this._popup&&this._popup._content&&this._popup._close(),this},toggleCompleted:function(){this.options.complete&&(K.complete.toggle(this),this.markComplete())},setCompleted:function(done){this.options.complete&&(K.complete.set(done,this),this.markComplete())},markComplete:function(){if(this.options.complete){var done=this.complete=K.complete.is(this);if(this.init||done){var time;if(this.init=!0,this.options.time&&done&&(K.complete.time(this)?K.timed.add(this):(K.complete.set(!1,this),K.timed.remove(this.options.id),done=this.complete=K.complete.is(this))),"marker"===this.options.shape){var i=this.options.icon.options;this.setIcon(createIcon({url:i.iconUrl,size:i.iconSize,html:i.iconUrl?"":i.html,className:i.className,done:K.complete.is(this),time:K.complete.time(this)}))}this.options.link&&$.each(this.getLinked(),function(){this.complete!=done&&this.setCompleted(done)}),done?K.complete.add(this):K.complete.remove(this.options.id),K.complete.showHide()}else this.init=!0}},getLinked:function(){var links=this.options.link;if(!links)return[];var layers=[];return K.group.feature[K.mode.get].everyLayer.eachLayer(function(l){K.isInArray(l.options.id,links)&&layers.push(l)}),layers},addClass:function(value){var classes=classesToArray(value),cur,curValue,clazz,j,finalValue,className="marker"===this.options.shape?this.options.icon.options.className:this.options.className;if(classes.length&&(cur=` ${stripAndCollapse(curValue=className||"")} `)){for(j=0;clazz=classes[j++];)cur.indexOf(` ${clazz} `)<0&&(cur+=clazz+" ");curValue!==(finalValue=stripAndCollapse(cur))&&this.applySetting("className",finalValue,!0)}return this},removeClass:function(value){var classes=classesToArray(value),cur,curValue,clazz,j,finalValue,className="marker"===this.options.shape?this.options.icon.options.className:this.options.className;if(classes.length&&(cur=` ${stripAndCollapse(curValue=className||"")} `)){for(j=0;clazz=classes[j++];)for(;cur.indexOf(` ${clazz} `)>-1;)cur=cur.replace(` ${clazz} `," ");curValue!==(finalValue=stripAndCollapse(cur))&&this.applySetting("className",finalValue,!0)}return this}}),L.DivOverlay.include({_updateContent:function(){if(this instanceof L.Popup&&this.options.list&&this.options.list.title&&(this._content=this.convertContent(this.options)),this._content){var node=this._contentNode,content="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof content)node.innerHTML=content;else{for(;node.hasChildNodes();)node.removeChild(node.firstChild);node.appendChild(content)}this.fire("contentupdate")}}}),L.Popup.include({_updateLayout:function(){var container=this._contentNode,style=container.style,width=container.offsetWidth,height=container.offsetHeight;if($.trim(this._content).split(/ /).length>1)for(let i=width;i>1;i--)if(style.width=i+"px",container.offsetHeight>height){style.width=i+1+"px";break}style.whiteSpace="",style.height="";var maxHeight=this.options.maxHeight,scrolledClass="leaflet-popup-scrolled";maxHeight&&height>maxHeight?(style.height=maxHeight+"px",L.DomUtil.addClass(container,scrolledClass)):L.DomUtil.removeClass(container,scrolledClass),this._containerWidth=this._container.offsetWidth}}),L.Icon.include({_setIconStyles:function(img,name){var options=this.options,sizeOption=options[name+"Size"];"number"==typeof sizeOption&&(sizeOption=[sizeOption,sizeOption]);var size=L.point(sizeOption),anchor=L.point("shadow"===name&&options.shadowAnchor||options.iconAnchor||size&&size.divideBy(2,!0));img.className="leaflet-marker-"+name+" "+(options.className||""),anchor&&(img.style.marginLeft=-anchor.x+"px",img.style.marginTop=-anchor.y+"px",(options.className||"").contains("overground")?img.style.marginTop=-size.y+"px":(options.className||"").contains("underground")&&(img.style.marginTop=0)),size&&(img.style.width=size.x+"px",img.style.height=size.y+"px")}}),L.Control.Button=L.Control.extend({options:{position:"topleft",container:"map",text:"",title:"Save to JSON",css:"save",clickFn:createGeoJSON},onAdd:function(map){var control="leaflet-control",options=this.options,el=control+" "+options.container+" leaflet-bar",container=document.getElementsByClassName(el)[0]||L.DomUtil.create("div",el);return this._button=this._createButton(options.text,options.title,control+"-"+options.css,container,this._onClick),container},onRemove:function(map){},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_onClick:function(e){this._disabled||this.options.clickFn(this)},_createButton:function(html,title,className,container,fn){var link=L.DomUtil.create("a",className,container);return link.innerHTML=html,link.href="#",link.title=title,link.setAttribute("role","button"),link.setAttribute("aria-label",title),L.DomEvent.on(link,"mousedown dblclick",L.DomEvent.stopPropagation).on(link,"click",L.DomEvent.stop).on(link,"click",fn,this),link},_updateDisabled:function(){var className="leaflet-disabled";L.DomUtil.removeClass(this._button,className),this._disabled&&L.DomUtil.addClass(this._button,className)}}),L.control.button=function(options){return new L.Control.Button(options)},Cookies.json=!0,K.extend({lastCheck:!1,checkLogin:function(callback){var end=new Date(K.lastCheck||"").getTime(),now,gap=(new Date).getTime()-end;!K.lastCheck||gap>6e4?$.ajax({url:"includes/check_login.php"}).done(function(a){a=$.parseJSON(a),K.user.name=a.username||!1,K.user.type=a.usertype||0,K.user.donate=a.donate||0,K.user.data=!1,K.user.name&&K.user.getData(),callback&&callback(),K.lastCheck=new Date}):callback&&callback()},complete:{layers:[],add:function(layer){var add=!0;$.each(K.complete.layers,function(i,l){layer.options.id===l.options.id&&(add=!1)}),add&&K.complete.layers.push(layer),K.timed.interval||K.timed.action()},remove:function(id){var index=!1;for(let i=0;i<K.complete.layers.length;i++){const v=K.complete.layers[i];if(id===v.options.id){index=i;break}}"number"===$.type(index)&&K.complete.layers.splice(index,1)},is:function(layer){var uD=K.user.data,id=layer.options.id;return uD||"complete"in localStorage||K.local("complete",{}),uD?id in uD:id in K.local("complete")},time:function(layer){if(!K.complete.is(layer))return!1;var uD=K.user.data,id=layer.options.id,time=uD?uD[id]:K.local("complete")[id];if("string"===$.type(time)){var end,now,gap=new Date(time).getTime()-(new Date).getTime(),hrs=Math.ceil(gap%864e5/36e5),min=Math.ceil(gap%36e5/6e4);gap<0?(K.complete.set(!1,layer),time=!1):hrs?time=hrs+"h":min&&(time=min+"m")}else time=!1;return time},toggle:function(layer){return K.complete.set(!layer.complete,layer)},set:function(done,layer){var uD=K.user.data,id=layer.options.id,time=layer.options.time;uD||"complete"in localStorage||K.local("complete",{});var obj=uD||K.local("complete");return done?(obj[id]=!time||(new Date).addHours(time).toString(),K.complete.add(layer)):(delete obj[id],K.complete.remove(layer.options.id)),layer.complete=done,!uD&&K.local("complete",obj),uD&&(K.complete.timeout&&clearTimeout(K.complete.timeout),K.complete.timeout=setTimeout(()=>{$.ajax({type:"POST",url:"includes/write_complete.php",data:{data:JSON.stringify(K.user.data)}}).done(()=>{})},1e3)),layer.complete},timeout:!1,showHide:function(){switchLayerGroups(!0);var h=K.completeHidden,layers=K.complete.layers,gC=K.group.mode.groupComplete,g,show,hide,i,hidden;K.filters=Cookies.get("filters")||{},$.each(layers,function(x,layer){hidden=K.filters[layer.options.type],g=K.group.mode[hidden?"groupHidden":layer.options.group],i=layer._leaflet_id,show=h?gC:g,(hide=h?g:gC).getLayer(i)&&(show.addLayer(hide.getLayer(i)),hide.removeLayer(i))}),switchLayerGroups(),polyHoverAnimation()}},timed:{layers:[],interval:!1,add:function(layer){var add=!0;$.each(K.timed.layers,function(i,l){layer.options.id===l.options.id&&(add=!1)}),add&&K.timed.layers.push(layer)},action:function(){K.timed.interval=setInterval(()=>{if(!K.timed.layers.length)return clearInterval(K.timed.interval),void(K.timed.interval=!1);$.each(K.timed.layers,function(i,layer){layer.markComplete()}),K.complete.showHide()},6e4)},remove:function(id){var index=!1;for(let i=0;i<K.timed.layers.length;i++){const v=K.timed.layers[i];if(id===v.options.id){index=i;break}}"number"===$.type(index)&&K.timed.layers.splice(index,1)}},bar:{b:{save:!1,group:!1,grid:!1,tools:!1},draw:{},edit:{}},check:{editing:!1,deleting:!1,disabled:!1,doOnce:!0,grabbing:!1},drawControl:!1,group:{save:new L.FeatureGroup,draw:new L.FeatureGroup([],{makeBoundsAware:!1}),feature:{}},grid:{overlay:L.imageOverlay("images/grid.svg",[[-19.05,-19.05],[19.05,19.05]]),x:0,y:0,r:0},save:{unsaved:new L.FeatureGroup,deleted:[],add:function(layer){this.unsaved.addLayer(layer),this.check()},remove:function(layer){this.unsaved.removeLayer(layer._leaflet_id),this.check()},delete:function(layer){this.remove(layer),this.deleted.push(layer.options.id),this.check()},check:function(){return(r=Object.keys(this.unsaved._layers).length+this.deleted.length)?K.bar.b.save.enable():K.bar.b.save.disable(),r}},lng:"en",map:{active:Cookies.get("activeMap")||[],group:{everyLayer:["n/a"],groupAll:[],groupDZ:["n/a"],groupHidden:["n/a"],groupComplete:["n/a"],group08:[],group09:[],group10:[],group11:[],group12:[]},type:{counts:{}},mode:{},property:{polygon:["category","color","weight","opacity","fillColor","fill","fillOpacity","stroke","group","shape","type","className","id","mode","creator","complete"],polyline:["category","color","weight","opacity","stroke","complete","group","shape","type","className","id","mode","creator"],marker:["category","icon","group","type","shape","time","opacity","id","mode","creator","complete","link"],popup:["className"]},defaults:{marker:{category:"default",className:"anim-icon",group:"group08",iconSize:[22,22],iconUrl:"images/marker-poi-contaminated.svg",mode:"all",shape:"marker",type:"Contaminated"},polygon:{category:"default",className:"",color:"#c22e2e",fill:1,fillColor:"#672f2f",fillOpacity:.05,group:"group08",mode:"all",opacity:.4,pane:"overlayPane",shape:"polygon",smoothFactor:1,stroke:1,type:"ContaminatedZone",weight:1},polyline:{category:"default",color:"#207e70",group:"groupAll",mode:"all",opacity:1,pane:"overlayPane",shape:"polyline",smoothFactor:1,stroke:1,type:"",weight:5}},zIndex:["PointOfInterest","Hideout","Contaminated","Landmark","CrashSite"]},settings:{main:{category:{count:[],description:"Categories are used to organize the filter menu.",for:["marker","polygon","polyline"],type:"string"},type:{count:[],description:"Type is used for both the filter menu and to make it easier to change settings in bulk.",for:["marker","polygon","polyline"],type:"string"},mode:{count:[],description:"Mode is used to suggest what map mode the layers are for, 'All' is an option. As the modes are created they will be added to the list bellow.",for:["marker","polygon","polyline"],type:"string"},group:{count:[],description:"Group is used to set what zoom level of the map the layer will appear on.\nThere are set options from Group08 to Group12 with a GroupAll to never hide the layer.",for:["marker","polygon","polyline"],type:"string"},className:{count:[],description:"Class Name is the element class added to the layer, this is used for the marker level (overground/underground) and the hover effect.",for:["marker","polygon","polyline"],type:"string"},fill:{count:[!0,!1],description:"Fill is used to say if a shape has a fill color.",for:["polygon"],type:"boolean"},fillColor:{count:[],description:"Fill Color is used to set the color of the filled shape.",for:["polygon"],type:"string"},fillOpacity:{count:[],description:"Fill Opacity is used to set the opacity of the filled shape.",for:["polygon"],type:"number"},iconUrl:{count:[],description:"Icon URL is to set the URL of the required icon, although you can use external icons, it is recommended to use one from the list bellow.",for:["marker"],type:"string"},iconSize:{count:[],description:"Icon Size is used to set the icon size, it should always be two of the same number, e.g. '26, 26'.",for:["marker"],type:"array"},html:{description:"HTML shouldn't be used unless you know what you are doing, this is used to create the layers that show the street names.",for:["marker"],type:"string"},stroke:{count:[!0,!1],description:"Stroke is used to set if the shape has a stroke or not.",for:["polygon"],type:"boolean"},color:{count:[],description:"Color is the stroke color for the shape.",for:["polygon","polyline"],type:"string"},opacity:{count:[],description:"Opacity is used to set the opacity of the Stroke.",for:["marker","polygon","polyline"],type:"number"},weight:{count:[],description:"Weight is used to set the thickness of the Stroke.",for:["polygon","polyline"],type:"number"},complete:{count:[!0,!1],description:"Complete is used to show that a layer can be marked by the user as completed.",for:["marker","polygon","polyline"],type:"boolean"},time:{count:[1,24],description:"Time is used in conjunction with Complete to only set a layer as complete for this length of time. This is helpful for things that can be collected again at a later date. For this to work Complete must be 'True'.",for:["marker"],type:"number"},link:{description:"Link is used in conjunction with Complete to also hide the linked layer(s) after the this layer has been completed. The ID of the layers are required to link them. The list should be comma separated.",for:["marker"],type:"array"},id:{description:"The ID is set automatically and should never be changed. It is used to identify the layer in the data file to update it with changes.",for:["marker","polygon","polyline"],type:"string"}},popup:{className:{count:[],description:"Class Name is used to set the color of the title in the Popup and it also sets the popup to be in the top left corner with the poly-hover class.",for:["marker","polygon","polyline"],type:"string"},content:{description:"Content can be used for the Popups Content, it is preferred to use the List for this though as that uses less storage space and automatically creates the HTML content for the Popup. Any HTML can be used here.",for:["marker","polygon","polyline"],type:"string"},list:{description:"This is an alternative to content, with this it will automatically arrange the content to display correctly in the html tags with images included. Filling this out will remove whatever is in content.",for:["marker","polygon","polyline"],type:"object"}}},mode:{get:Cookies.get("mode")||"normal",not:function(mode=!1,other){return mode?this.get==mode?other:mode:"normal"==this.get?["survival","last stand","survival last stand"]:["normal","survival","normal survival"]}},msg:{note:$(".notification"),show:function(options){$.proxy(K.msg._show(options),K.msg)},_show:function(options){options=$.extend({msg:"",time:0,dots:!1},options);var dot='<div class="dot"></div>';this.note.length||($("body").append('<div class="notification"></div>'),this.note=$(".notification")),options.msg&&(this.timeout&&clearTimeout(this.timeout),this.note.removeClass("dots"),options.dots&&this.note.addClass("dots"),this.note.html(options.msg+(options.dots?'<div class="dot-box">'+dot+dot+dot+dot+dot+"</div>":"")),this.note.fadeIn(500),options.time&&(this.timeout=setTimeout(this.hide,options.time)))},hide:function(){$.proxy(K.msg._hide(),K.msg)},_hide:function(){this.note.fadeOut(500),this.timeout=!1},timeout:!1},myMap:L.map("mapid",{center:Cookies.get("pan")||[0,0],zoom:Cookies.get("zoom")||7,minZoom:7,maxZoom:15,maxBounds:[[8.3,-14.9],[-8.3,14.9]],zoomSnap:.25,zoomDelta:.5,wheelPxPerZoomLevel:100,zoomControl:!1,attributionControl:!0}),pane:{},popupContent:{$rucksack:"<span class='title'>Rucksack</span><p>Could contain...</p><ul><li><img src='images/crate-clothing.svg'><span>Clothing</span><span class='qty'></span></li><li><img src='images/crate-food.svg'><span>Food</span><span class='qty'></span></li><li><img src='images/crate-drink.svg'><span>Drink</span><span class='qty'></span></li></ul>",$crateElite:"<span class='title'>Elite Crate</span><p>Contains a combination of...</p><ul><li><img src='images/crate-gear.svg'><span>Gear</span><span class='qty'></span></li><li><img src='images/crate-weapons.svg'><span>Weapon</span><span class='qty'></span></li><li><img src='images/crate-clothing.svg'><span>Clothing</span><span class='qty'></span></li><li><img src='images/crate-medication.svg'><span>Medication</span><span class='qty'></span></li><li><img src='images/crate-medkit.svg'><span>Medkit</span><span class='qty'></span></li><li><img src='images/crate-food.svg'><span>Food</span><span class='qty'></span></li><li><img src='images/crate-drink.svg'><span>Drink</span><span class='qty'></span></li></ul>"},shortcuts:{Draw:{M:"Marker",P:"Polygon",R:"Rectangle",L:"Polyline"},QuickMarker:{1:"Airdrop",2:"ComponentZone",3:"FoodZone",4:"WaterZone",5:"Artifact",E:"Comms",A:"Echo",F:"Food",D:"Water",S:"Component",W:"Weapon",Q:"Gear",Z:"GroundLevel",X:"Underground",C:"Overground"}},tool:{},user:{name:!1,type:0,error:!1,data:!1,getData:function(){K.user.name&&$.ajax({url:"includes/data_exists.php"}).done(function(data){$.parseJSON(data)?$.getJSON(`data/${K.user.name}/complete.json`,function(data){K.local("complete")&&($.extend(data,K.local("complete")),localStorage.removeItem("complete"),$.ajax({type:"POST",url:"includes/write_complete.php",data:{data:JSON.stringify(data)}})),K.user.data=data}):K.user.data={}})}},modes:{get:["normal","survival","last stand"],create:function(){$.each(this.get,function(index,mode){K.group.feature[mode]={},K.map.type[mode]={}})}},updateMarker:function(icon){var mark,o="icon"in(icon=icon||(Cookies.get("copy")&&"object"==$.type(mark=Cookies.get("copy").marker)?mark:{}))?icon.icon.options:{},url="images/marker-poi-contaminated.svg",options={iconSize:o.iconSize||[22,22],iconUrl:o.iconUrl||url,html:o.html||`<img class='halo' src='images/_a.svg'><img src='${o.iconUrl||url}' class='icon'>`,className:o.className||"anim-icon"};if(K.drawIcon)$.extend(K.drawIcon.options,options);else{var createIcon=L.Icon.extend({options:options});K.drawControl=new L.Control.Draw({draw:{marker:{icon:new createIcon},circle:!1},edit:{featureGroup:K.group.draw,selectedPathOptions:{maintainColor:!0,moveMarkers:!0}}}),K.drawIcon=K.drawControl.options.draw.marker.icon}},expires:{expires:28},svg:{dot:'<svg version="1.1" class="bg-dot" x="0px" y="0px" \n            viewBox="0 0 64 64" style="enable-background:new 0 0 64 64;" xml:space="preserve">\n            <path class="dot-color" d="M32,3.1C16.039,3.1,3.1,16.039,3.1,32c0,15.961,12.939,28.9,28.9,28.9c15.961,0,28.9-12.939,28.9-28.9\n            C60.9,16.039,47.961,3.1,32,3.1z M32,48.5c-9.113,0-16.5-7.387-16.5-16.5S22.887,15.5,32,15.5S48.5,22.887,48.5,32\n            S41.113,48.5,32,48.5z"/>\n        </svg>'},classRemoval:"chambray red purple orange astral blue-bell laurel hokey-pokey medium-purple silver pirate-gold orange-roughy well-read bird-flower woodland elm group08 group09 group10 group11 group12"}),K.modes.create(),$.each(K.group.feature,function(i,m){$.each(K.map.group,function(g,a){m[g]=new L.FeatureGroup})}),K.myMap.createPane("messagePane",L.DomUtil.get("message")),K.myMap.createPane("mapPane"),K.myMap.createPane("zonePane"),K.group.mode=K.group.feature[K.mode.get],K.tool.marker={full:!1,layers:{},fill:function(){var _this=K.tool.marker;!_this.full&&$.each(K.modes.get,function(i,mode){_this.layers[mode]={}}),_this.full=!0},enabled:function(){return!!$("#marker-tools").length},show:function(){var skip="boolean"==$.type(arguments[0])&&arguments[0];K.tool.marker._show.call(K.tool.marker,skip)},_show:function(skip){if(this.enabled()){if(skip)return;$("#marker-tools").remove()}else{$("body").append('<div id="marker-tools"></div>'),tools=$("#marker-tools"),tools.append('<div class="outer inputs">\t\t\t<div>\t\t\t<input id="_1" type="radio" name="radio" value="" checked><label for="_1">Z - Ground</label></br>\t\t\t<input id="_2" type="radio" name="radio" value="underground"><label for="_2">X - Subway</label></br>\t\t\t<input id="_3" type="radio" name="radio" value="overground"><label for="_3">C - Roof</label></br>\t\t\t</div>\t\t\t</div>\t\t\t<div class="outer icons"></div>'),tools.draggable({containment:"#mapid",start:function(){$(this).css({transform:"translateX(0)",bottom:"initial"})},stop:function(){this.position=$.extend({},$(this).position(),{transform:"translateX(0)",bottom:"initial",width:$(this).width(),height:$(this).height()}),Cookies.set("toolPos",this.position,K.expires)}}).resizable({containment:"#mapid",minHeight:92,minWidth:250,resize:function(){iconSize.call($(".outer.icons"))},stop:function(){this.position=$.extend({},$(this).position(),{transform:"translateX(0)",bottom:"initial",width:$(this).width(),height:$(this).height()}),Cookies.set("toolPos",this.position,K.expires)}}),this.position=Cookies.get("toolPos")||!1,this.position&&tools.css(this.position);var iconSize=function(){var n=$("a",this).length,a=$(this).width(),b=$(this).height(),i,x,y,m,k,o,oX,oY,w,oK,oM;for(i=1;i<n+1&&(x=a/(m=Math.round(i)),y=b/(k=Math.ceil(n/i)),!(Math.abs(x-y)>o));i++)oX=x,oY=y,oK=k,oM=m,o=Math.abs(x-y);for(w=Math.min(oX,oY)-16,$("a",this).width(w).height(w),$("div.spacer").remove(),i=0;i<oK*oM-n;i++)$('<div class="spacer" />').width(w+16).height(0).appendTo(this)};$('input[name="radio"]').on("change",function(){$("a",tools).removeClass("underground overground").addClass($(this).val())}),$.each(sortObjByKeys(this.layers[K.mode.get]),function(category,layers){$.each(sortObjByKeys(layers),function(i,layer){var p=layer.properties,active=p.type==(Cookies.get("markerToolIcon")||"Contaminated")?"enabled":"",key=!1;$.each(K.shortcuts.QuickMarker,function(k,t){p.type!=t||"Underground"==p.type||(key=k)}),(p.mode.contains(K.mode.get)||"all"==p.mode)&&$("<a />",{class:active,title:category+"<br>"+p.type.replace("Survival","").space(),category:category,type:p.type,html:`<img src="${p.icon.options.iconUrl}">${key?'<span class="key">'+key+"</span>":""}`}).data("properties",p).appendTo(".outer.icons")})}),$("#marker-tools a").on("click",function(){var typ=$(this).attr("type");$(this).siblings("a").removeClass("enabled"),$(this).addClass("enabled"),Cookies.set("markerToolIcon",typ,K.expires),K.updateMarker($(this).data("properties")),K.bar.draw.Marker.enable()}),iconSize.call($(".outer.icons")),$(window).off("resize").on("resize",function(){iconSize.call($(".outer.icons"))}),$('.outer.icons [title!=""]').qtip({position:{viewport:$("#mapid"),my:"top center",at:"bottom center"},style:{classes:"tooltip-style"},show:{delay:250,solo:!0},hide:{event:"click mouseleave"}})}}},K.tool.layer={group:"",icon:{},id:0,join:!1,layer:{},new:{},pop:{},shape:"",isOpen:function(){return!!$("#settings-menu").length},show:function(){K.tool.layer._show.call(K.tool.layer,this)},_show:function(layer){var _this=this;if(K.check.deleting||K.check.editing||!K.bar.b.power.enabled())return this;if(!this.tags){this.tags=[];var layers={};$.each(K.tool.marker.layers,function(i,mode){$.extend(layers,mode)}),layers=sortObjByKeys(layers),$.each(layers,function(v,i){_this.tags.push(v.space())})}if(this._hide(),this.layer=layer,this.shape=layer.options.shape,this.id=layer._leaflet_id,"saved"in layer.editing||(layer.editing.saved=!0),"options"in layer||(layer.options={}),"marker"==this.shape&&("icon"in layer.options||(layer.options.icon={}),"options"in layer.options.icon||(layer.options.icon.options={}),this.icon=layer.options.icon.options),"_popup"in layer||(layer._popup={}),"_content"in layer._popup||(layer._popup._content=""),"options"in layer._popup||(layer._popup.options={}),"list"in layer._popup.options||(layer._popup.options.list={}),this.group=layer.options.group,this.pop=layer.getPopup(),layer.makeBackup(),this.join){if(this.join._latlngs.push(layer._latlngs[0]),this.new=L.polygon(this.join._latlngs,$.extend({},this.join.options,{pane:"poly-hover"==this.join.options.className?"zonePane":"overlayPane"})),this.pop=this.join._popup,this.pop._content||this.pop.options.list.title){var o=this.pop;this.new.bindPopup(o._content,{className:o.options.className,list:o.options.list||{}})}return removeLayer(this.join),removeLayer(layer,this.group,!0),K.group.mode[this.new.options.group].addLayer(this.new),this.new.on("click",K.tool.layer.show),this.new.options.complete&&"marker"===this.new.options.shape&&this.new.on("contextmenu",function(){this.toggleCompleted(!0)}),this.new.saved(!1),this.join=!1,K.msg.hide(),this}if($(layer[K.isInArray(layer.options.shape,["polygon","polyline"])?"_path":"_icon"]).addClass("leaflet-layer-editing"),$("body").append('<div id="settings-menu" class="settings-divider"><div class="settings-side left"></div><div class="settings-side right"></div></div>'),$("#settings-menu").on("remove",function(){$(".leaflet-layer-editing").removeClass("leaflet-layer-editing")}).draggable({containment:"#mapid",start:function(){$(this).css({transform:"translate(0, 0)"})},stop:function(){this.position=$.extend({},$(this).position(),{transform:"translate(0, 0)"}),Cookies.set("menuPos",this.position,K.expires)}}),this.position=Cookies.get("menuPos")||!1,this.position){var w=$(window).width()-300,h=$(window).height()-515;this.position.left=w<this.position.left?w:this.position.left,this.position.top=h<this.position.top?h:this.position.top,$("#settings-menu").css(this.position)}$(".settings-side.left").append(`<div class="settings-tools marker">\n\t\t\t    <span class="settings-title">${layer.options.shape.toUpperCase()}</span>\n\t\t\t</div>\n\t\t\t<div class="settings-tools popup">\n\t\t\t    <span class="settings-title">POPUP</span>\n\t\t\t</div>\n\t\t\t<div class="settings-tools buttons"></div>\n\t\t\t<div class="settings-tools save">\n                <a class="settings-save button" aria-label="save">CONFIRM</a>\n                <a class="settings-cancel button" aria-label="cancel">CANCEL</a>\n\t\t\t</div>\n\t\t\t<div class="creator">${layer.options.creator}</div>\n            <div class="unsaved" ${layer.editing.saved?'style="display: none"':""}>Save me!</div>`);var btn=$('<a class="settings icon button" />'),box=".settings-tools.buttons",btns=[{cls:"copy",title:"Copy these settings"},{cls:"paste",title:"Paste copied settings",type:["polygon","polyline"]},{cls:"edit"+(layer.editing.edit?" end":""),title:"Add this to editable layer"},{cls:"move"+(layer.dragging.enabled()?" end":""),title:"Drag this layer"},{cls:"join",title:"Make another polygon a hole in this",type:["polygon"]},{cls:"split",title:"Split these polygons",type:["polygon"]},{cls:"dupe",title:"Duplicate this poly",type:["polygon"]},{cls:"delete",title:"Delete this layer"},{cls:"to-type",title:"Copy selected setting to all of Type"}];for(i in btns)b=btns[i],!b.cls||b.type&&!K.isInArray(this.shape,b.type)||btn.clone().attr({"aria-label":b.cls,title:b.title}).addClass(b.cls).appendTo(box);this.updateSaved();var shape=this.shape;$.each(K.settings.main,function(i,n){K.isInArray(shape,n.for)&&$("<a />",{class:"dnt settings-item button "+i,"aria-label":i,html:i.firstToUpper().space()}).appendTo(".settings-tools.marker")}),$.each(K.settings.popup,function(i,n){$("<a />",{class:"dnt settings-item button "+i,"aria-label":"popup-"+i,html:i.firstToUpper().space()}).appendTo(".settings-tools.popup")}),$(".settings-item").on("mousedown",this._settingClick).on("mouseover",this._settingOver).on("mouseleave",this._settingLeave),$(".settings-save").on("click",function(){_this._save.call(_this)}),$(".settings-cancel").on("click",function(){_this._cancel.call(_this)}),$(".settings.copy").on("click",function(){_this._copy.call(_this)}),$(".settings.paste").on("click",function(){_this._paste.call(_this)}).on("mouseover",function(){_this._pasteOver.call(_this,layer)}).on("mouseout",function(){_this._pasteOut.call(_this,layer)}),$(".settings.delete").on("click",function(){_this._delete.call(_this)}),$(".settings.dupe").on("click",function(){_this._dupe.call(_this)}),$(".settings.join").on("click",function(){_this._join.call(_this)}),$(".settings.to-type").on("click",function(){_this._toType.call(_this)}),$(".settings.move").on("click",this._move),$(".settings.edit").on("click",this._edit),"_latlngs"in layer&&1==layer._latlngs.length?$(".settings.split").hide():$(".settings.split").on("click",function(){_this._split.call(_this)}),layer.editing.window&&$(`[aria-label="${layer.editing.window}"]`).trigger("mousedown"),$('.settings.icon[title!=""]').qtip({position:{viewport:$("#mapid"),my:"bottom left",at:"top center"},style:{classes:"tooltip-style"},show:{delay:250,solo:!0},hide:{event:"click mouseleave"}});var div=L.DomUtil.get("settings-menu");return L.DomEvent.disableClickPropagation(div),L.DomEvent.on(div,"mousewheel",L.DomEvent.stopPropagation),this},_settingClick:function(){var fn=K.tool.layer,layer=fn.layer,setting=$(this).attr("aria-label"),isPopup=setting.bMatch("popup-"),object=isPopup?K.settings.popup:K.settings.main,values=[];layer.editing.window=setting,"count"in object[setting=setting.replace("popup-","")]&&(values=object[setting].count,$.unique(values).sort());var value=layer.options[setting];isPopup?value="content"==setting?fn.pop._content:fn.pop.options[setting]:"marker"==fn.shape&&K.isInArray(setting,["className","iconUrl","iconSize","html"])&&(value=fn.icon[setting]),$(".settings-side.right").html(`<div class="settings-tools right-bar" aria-label="' + setting + '">\n\t\t\t    <span class="settings-title">${isPopup?"POPUP ":""}${setting.space().toUpperCase()}</span>\n            </div>`),K.isInArray(setting,["id"])||($(".right .settings-title").after(`<a class="settings icon copy inline" title="Copy this setting" \n                setting="' + setting + '" which="${isPopup?"popup":"icon"}"></a>`),$(".right .settings-title").after(`<a class="settings icon paste inline" title="Paste this setting" \n                setting="' + setting + '" which="${isPopup?"popup":"icon"}"></a>`),$(".settings.copy.inline").on("click",fn._copySingle),$(".settings.paste.inline").on("click",fn._pasteSingle));var bx=$(".settings-tools.right-bar");if("list"===setting){"object"!=$.type(value)&&(fn.pop.options[setting]={},value={}),$(".settings-tools.right-bar").append(`<span class="help">${object[setting].description}</span>\n\t\t\t\t<div class="scroll-box">\n\t\t\t\t    <div class="section title">\n                        <span class="header">TITLE</span><br>\n                        <input type="text" class="settings-item input list" name="list-title" role="input" value="${value.title?value.title:""}" setting="list-title" which="popup" placeholder="Title">\n                    </div>\n                    <div class="section subs">\n                        <a class="add subs button" title="Add another paragraph">+</a>\n                        <span class="header">PARAGRAPH</span>\n                        <br>\n                    </div>\n                    <div class="section list">\n                        <a class="add list button" title="Add another item">+</a>\n                        <span class="header">LIST</span>\n                        <br>\n                    </div>\n\t\t\t\t</div>`),value.subs||(value.subs=[{value:"",color:!1,note:!1,line:!1}]);var box=$("<div />",{class:"setting-container"}),input=$("<input />",{type:"text",class:"settings-item input list",which:"popup"}),toggle=$('<label class="switch">\n                    <span class="label"></span>\n                    <span class="back"></span>\n                    <input type="checkbox" class="settings-item input list check">\n                    <span class="slider"></span>\n                </label>');$.each(value.subs,function(i,itm){var bx=box.clone().appendTo(".section.subs"),tg,inpt=input.clone().attr({name:"list-sub",value:itm.value,num:i,placeholder:"Paragraph"}).appendTo(bx);itm.color&&inpt.addClass("gray"),$("<br>").appendTo(bx),(tg=toggle.clone().appendTo(bx)).find("input").attr({name:"list-sub-class",cat:"color",num:i}).prop("checked",itm.color),tg.find(".label").text("Color:"),(tg=toggle.clone().appendTo(bx)).find("input").attr({name:"list-sub-class",cat:"line",num:i}).prop("checked",itm.line),tg.find(".label").text("Line:"),tg.find(".slider").addClass("note"),(tg=toggle.clone().appendTo(bx)).find("input").attr({name:"list-sub-class",cat:"note",num:i}).prop("checked",itm.note),tg.find(".label").text("Note:"),tg.find(".slider").addClass("note"),$("<br>").appendTo(".section.subs")}),value.list||(value.list=[{item:"",qty:""}]),$.each(value.list,function(i,itm){input.clone().attr({name:"list-item",value:itm.item,num:i,placeholder:"Item"}).autocomplete({source:fn.tags,autoFocus:!0,appendTo:"#settings-menu"}).appendTo(".section.list"),input.clone().attr({type:"number",min:1,name:"list-qty",value:itm.qty||1,num:i,placeholder:"Qty"}).appendTo(".section.list"),$("<br>").appendTo(".section.list")}),$("a.add").on("click",function(){var focus=!1,name,i,tg;if($(this).hasClass("subs")){name='input[name="list-sub"]',i=$(name).length;var bx=box.clone().appendTo(".section.subs");input.clone().attr({name:"list-sub",setting:"list-sub",num:i,placeholder:"Paragraph"}).appendTo(bx),$("<br>").appendTo(bx),(tg=toggle.clone().appendTo(bx)).find("input").attr({name:"list-sub-class",cat:"color",num:i}),tg.find(".label").text("Color:"),(tg=toggle.clone().appendTo(bx)).find("input").attr({name:"list-sub-class",cat:"line",num:i}),tg.find(".label").text("Line:"),tg.find(".slider").addClass("note"),(tg=toggle.clone().appendTo(bx)).find("input").attr({name:"list-sub-class",cat:"note",num:i}),tg.find(".label").text("Note:"),tg.find(".slider").addClass("note"),$("<br>").appendTo(".section.subs")}else name='input[name="list-item"]',i=$(name).length,input.clone().attr({name:"list-item",setting:"list-item",num:i,placeholder:"Item"}).autocomplete({source:fn.tags,autoFocus:!0,appendTo:"#settings-menu"}).appendTo(".section.list"),input.clone().attr({type:"number",min:1,name:"list-qty",setting:"list-qty",num:i,placeholder:"Qty"}).appendTo(".section.list"),$("<br>").appendTo(".section.list");$(name).each(function(i,el){$(el).val()||focus||($(el).focus(),focus=!0)}),inputRenew()})}else if("link"===setting){$(".settings-tools.right-bar").append(`<span class="help">${object[setting].description}</span>\n\t\t\t\t<div class="scroll-box">\n                    <div class="section links">\n                        <a class="add links button" title="Add another paragraph">+</a>\n                        <span class="header">LINKED IDS</span><br>\n                    </div>\n\t\t\t\t</div>`),value||(value=[""]);var box=$("<div />",{class:"setting-container links"}),input=$("<input />",{name:"list-link",type:"text",class:"settings-item input link",placeholder:"Layer ID"}),grab=$("<a />",{class:"settings-item link grab"}),trash=$("<a />",{class:"settings-item link trash"});$.each(value,function(i,v){var bx=box.clone().appendTo(".section.links");input.clone().attr({value:v,num:i}).appendTo(bx),grab.clone().attr({num:i}).appendTo(bx),trash.clone().attr({num:i}).appendTo(bx)}),$("a.add").on("click",function(){var focus=!1,name='input[name="list-link"]',i=$(name).length,bx=box.clone().appendTo(".section.links");input.clone().attr({num:i}).appendTo(bx),grab.clone().attr({num:i}).appendTo(bx),trash.clone().attr({num:i}).appendTo(bx),$(name).each(function(i,el){$(el).val()||focus||($(el).focus(),focus=!0)}),inputRenew()}),$(".section.links").on("click",".trash",function(){$(`.section.links [num=${$(this).attr("num")}]`).parent().remove(),$(".setting-container").each(function(i){$("[num]",this).attr("num",i)}),apply.call(this)}),$(".section.links").on("click",".grab",function(){K.check.grabbing=!0;var i=$(this).attr("num"),layers=K.group.feature[K.mode.get].everyLayer,_this=this;layers.eachLayer(function(l){l.off("click"),l.on("click",function(){$(`.section.links .input[num=${i}]`).val(this.options.id),apply.call(_this),K.check.grabbing=!1,layers.eachLayer(function(l){l.off("click"),K.user.type&&(K.user.type>=4||l.options.creator.toLowerCase()==K.user.name.toLowerCase())&&l.on("click",K.tool.layer.show)})}),K.msg.show({msg:"Select the layer you would like to link to this.",time:2e3})})})}else if(object[setting]&&object[setting].count){object[setting].description&&bx.append(`<span class="help">${object[setting].description}</span>`),bx.append(`<input type="text" class="settings-item input ${setting}" name="${setting}" \n                role="input" value="${value||""}" setting="${setting}" which="${isPopup?"popup":"icon"}">`);var img,col,num=1,retHtml='<div class="scroll-box">',colors=[];$.each(values,function(z,i){if(img="string"==$.type(i)&&i.contains(".svg"),col="string"==$.type(i)&&i.contains("#"))return colors.push(i),!0;var fst='<div class="settings-icons">',lst="</div>",trd=lst+fst;retHtml+=`${img&&1==num?fst:""}\n                    <a class="settings-item button selector${col?" color":img?" icon":""}" aria-label="${i}" role="button"\n                        ${value==i?` style="background-color: #2f474e; ${col?` color: ${i};`:""}"`:col?` style="color: ${i};"`:""}>\n                        ${img?`<img src="${i}" height="30" width="30">`:i} \n                    </a>\n                    ${img&&num==values.length?lst:img&&num%3==0?trd:""}`,num++}),retHtml=$(retHtml+"</div>"),img&&retHtml.addClass("has-icons"),bx.append(retHtml),$.unique(colors),colors.sort(),col&&new Huebee($(".settings-item.input")[0],{notation:"hex",hues:16,shades:8,saturations:5,customColors:colors,staticOpen:!0}).on("change",function(){$(".settings-item.input").trigger("click")})}else object[setting].description&&bx.append(`<span class="help">${object[setting].description}</span>`),bx.append(`<textarea  rows=2 cols=20 wrap="hard" class="settings-item input ${setting}" name="${setting}" setting="${setting}" which="${isPopup?"popup":"icon"}">${value||""}</textarea>`);var apply=function(){var $input=$(".settings-item.input"),setting=$input.attr("setting"),value=$input.val();$(this).hasClass("list")?(setting="list",(value={}).title=$('.input[name="list-title"]').val(),value.subs=[],$('.input[name="list-sub"]').each(function(){var t=$(this).val();if(!t)return!0;var p=$(this).parent(),c=p.find("[cat=color]").is(":checked"),l=p.find("[cat=line]").is(":checked"),n=p.find("[cat=note]").is(":checked"),r={value:t};c&&(r.color=c),l&&(r.line=l),n&&(r.note=n),value.subs.push(r)}),value.list=[],$('.input[name="list-item"]').each(function(){var no=$(this).attr("num"),t=$(this).val();if(!t)return!0;value.list.push({item:t,qty:$(`.input[name="list-qty"][num="${no}"]`).val()||1})}),removeEmpty(value)):$(this).hasClass("link")&&(setting="link",value=[],$("[name=list-link]").each(function(i,el){var v=$(this).val();v&&value.push(v)}),removeEmpty(value)),"popup"==$input.attr("which")?layer.updatePopup(setting,value):layer.applySetting(setting,value)};$(".settings-item.selector").on("click",function(){var $input=$(".settings-item.input");if($(this).hasClass("color")){var hex=$(this).attr("aria-label");$input.css({"background-color":hex,color:textColor(hex)})}$(".settings-side.right a:not(.settings-apply)").css("background-color","#24373d"),$(this).css("background-color","#2f474e"),$input.val($(this).attr("aria-label")),apply.call(this)});var inputRenew=function(){$(".input").each(function(){var el=$(this),binds="propertychange change click keyup input paste focus blur";el.data("oldVal",el.val()),el.unbind(binds),el.bind(binds,function(){var check=$(this).hasClass("check");if(check||el.data("oldVal")!=el.val()){!check&&el.data("oldVal",el.val()),apply.call(this);var title=$('input[name="list-title"]');if(title.removeClass("incorrect"),title.val()||title.addClass("incorrect"),check){var input=$(this).parent("label").prev("input");input.removeClass("gray"),$(this).is(":checked")&&input.addClass("gray")}}}),el.bind("blur",function(){el.data("oldVal")!=el.val()&&apply.call(this)})})};inputRenew(),$('.inline.icon[title!=""]').qtip({position:{viewport:$("#mapid"),my:"right center",at:"left center"},style:{classes:"tooltip-style"},show:{delay:250,solo:!0},hide:{event:"click mouseleave"}})},_settingOver:function(){var fn=K.tool.layer,layer=fn.layer,setting=$(this).attr("aria-label"),isPopup=setting.bMatch("popup-");setting=setting.replace("popup-","");var value=layer.options[setting]||"";isPopup?value="content"==setting?fn.pop._content:fn.pop.options[setting]:"marker"==fn.shape&&K.isInArray(setting,["className","iconUrl","iconSize","html"])&&(value=fn.icon[setting]),"object"==$.type(value)&&(value=JSON.stringify(value)),K.isInArray(setting,["content","html"])&&(value=safeTags(value)),"string"!=$.type(value)||value||(value=void 0);var cv="current-value";$("."+cv,this).length||null==value||$("<span />",{class:cv}).appendTo(this),$("."+cv,this).html(value).fadeIn(250)},_settingLeave:function(){$(".current-value").fadeOut(500)},_save:function(){var copy=Cookies.get("copy")||{},layer=this.layer;this._hide(),"marker"==this.shape?copy.marker=$.extend({},this.icon,K.curtail({},layer.options,["id"])):"polyline"==this.shape?copy.polyline=K.curtail({},layer.options,["id"]):"polygon"==this.shape&&(copy.polygon=K.curtail({},layer.options,["id"]));var p=this.pop,o=p.options;copy[this.shape+"Popup"]=p._content?{content:!p._content||o&&o.list&&o.list.title?"":p._content,options:{className:o&&o.className?o.className:"",list:o&&o.list?$.extend(!0,{},o.list):{}}}:{},Cookies.set("copy",copy,K.expires),delete layer.backup,layer.options.mode.contains(K.mode.get)||"all"==layer.options.mode||K.group.mode[layer.options.group].removeLayer(layer._leaflet_id)},_cancel:function(){this._hide();var layer=this.layer,o=layer.options,p=layer._popup,b=layer.backup;if($.extend(!0,o,b.options),b.popup&&($(p._container).removeClass(p.options.className).addClass(b.popup.options.className),$.extend(!0,p,b.popup)),"marker"==o.shape){layer.setLatLng(b.pos.latlng);var i=o.icon.options;layer.setIcon(createIcon({url:i.iconUrl,size:i.iconSize,className:i.className,done:K.complete.is(layer),time:K.complete.time(layer)})),layer.setOpacity(o.opacity),K.complete.is(layer)&&K.complete.add(layer)}else K.isInArray(o.shape,["polyline","polygon"])&&(layer.setLatLngs(b.pos.latlngs),layer.setStyle(o));layer.saved(!0)},_copy:function(){var copy=Cookies.get("copy")||{},layer=this.layer;"marker"==this.shape?copy.layerer=$.extend({},this.icon,K.curtail({},layer.options,["id"])):"polyline"==this.shape?copy.polyline=K.curtail({},layer.options,"id"):"polygon"==this.shape&&(copy.polygon=K.curtail({},layer.options,"id"));var p=this.pop,o=p.options;copy[this.shape+"Popup"]=p._content?{content:!p._content||o&&o.list&&o.list.title?"":p._content,options:{className:o&&o.className?o.className:"",list:o&&o.list?$.extend(!0,{},o.list):{}}}:{},Cookies.set("copy",copy,K.expires),K.msg.show({msg:"Settings copied!",time:2e3})},_copySingle:function(){var copy=Cookies.get("copy")||{},fn=K.tool.layer,pop="popup"==$(this).attr("which"),set=$(this).attr("setting"),val="list"==set?removeEmpty(fn.pop.options.list):$(".input").val();null==val||null==val||"string"==$.type(val)&&!val||"object"==$.type(val)&&!Object.keys(val).length?K.msg.show({msg:"Copy failed!",time:2e3}):("options"in copy||(copy.options={popup:{}}),pop?copy.options.popup[set]=val:copy.options[set]=val,Cookies.set("copy",copy,K.expires),K.msg.show({msg:"Setting copied!",time:2e3}))},_paste:function(){var layer=this.layer,copy,sets=(Cookies.get("copy")||{})[this.shape]||!1;sets?(sets=$.extend({},layer.options,sets,{pane:"poly-hover"==sets.className?"zonePane":"overlayPane"}),this.new="polyline"==this.shape?L.polyline(layer._latlngs,sets):"Rectangle"==polyType(layer._latlngs)?L.rectangle(layer._latlngs,sets):L.polygon(layer._latlngs,sets),removeLayer(layer,this.group),K.group.mode[layer.options.group].addLayer(this.new),this.new.on("click",this.show),this.new.saved(!1),switchLayerGroups(),polyHoverAnimation(),K.msg.show({msg:"Settings pasted!",time:2e3}),this._refresh()):K.msg.show({msg:"You need to copy something first!",time:2e3})},_pasteSingle:function(){var copy=Cookies.get("copy")||{},fn=K.tool.layer,pop="popup"==$(this).attr("which"),set=$(this).attr("setting");if("options"in copy&&(!pop||copy.options.popup[set])&&(pop||copy.options[set]))if("list"!=set)$(".input").val(pop?copy.options.popup[set]:copy.options[set]).trigger("blur");else{var list=copy.options.popup.list,input;$("input").val("");for(var j=0;j<2;j++){if(list.subs)for(var i=0;i<list.subs.length;i++)if(list.subs[i].value){(input=$(`[name="list-sub"][num="${i}"]`)).length||$("a.add.subs").trigger("click"),input.val(list.subs[i].value);var p=input.parent();p.find("[cat=color]").prop("checked",list.subs[i].color),p.find("[cat=line]").prop("checked",list.subs[i].line),p.find("[cat=note]").prop("checked",list.subs[i].note)}if(list.list)for(i=0;i<list.list.length;i++)list.list[i].item&&((input=$(`[name="list-item"][num="${i}"]`)).length||$("a.add.list").trigger("click"),input.val(list.list[i].item),$(`[name="list-qty"][num="${i}"]`).val(list.list[i].qty))}$('[name="list-title"]').val(list.title).trigger("blur")}else K.msg.show({msg:"There is no copied setting!",time:2e3})},_pasteOver:function(layer){layer.makeBackup(),layer.setStyle($.extend(layer.options,Cookies.get("copy")&&Cookies.get("copy")[this.shape]||{}))},_pasteOut:function(layer){layer.setStyle($.extend(layer.options,layer.paste.options))},_delete:function(){var _this=this;this._hide(),$("<div />",{class:"screen-blank",html:$("<div />",{class:"confirm",html:$("<div />",{class:"message",html:"Are you sure you want to delete this layer?"})})}).appendTo("body"),$("<a />",{class:"button no",title:"Cancel",html:"Cancel"}).appendTo(".confirm").on("click",function(){$(".screen-blank").remove()}),$("<a />",{class:"button yes",title:"Delete",html:"Delete"}).appendTo(".confirm").on("click",function(){_this._trueDelete.call(_this),$(".screen-blank").remove()})},_trueDelete:function(){var layer;removeLayer(this.layer,this.group,!0)},_toType:function(){var layer=this.layer,o=layer.options,p=layer._popup,setting=layer.editing.window,isPopup=setting.bMatch("popup-"),value;if(setting&&o.type&&"type"!=setting){switch(setting=setting.replace("popup-",""),isPopup?1:"marker"==this.type&&K.isInArray(setting,["className","iconUrl","iconSize","html"])?2:0){case 1:value="content"==setting?p._content:p.options[setting];break;case 2:value=o.icon.options[setting];break;default:value=o[setting]}$.each(K.group.mode,function(i,g){$.each(g._layers,function(i,l){l.options.type==o.type&&(isPopup?l.updatePopup(setting,value):l.applySetting(setting,value))})}),K.msg.show({msg:"Setting copied to all "+o.type,time:2e3})}},_dupe:function(){this._hide();var layer=this.layer,nSettings=$.extend({},layer.options,{id:ID()}),ll=layer._latlngs,pType=polyType(ll);"Rectangle"!=pType?("Polygon"==pType&&(ll=ll[0]),ll.splice(1,0,L.latLng((ll[0].lat+ll[1].lat)/2,(ll[0].lng+ll[1].lng)/2))):(ll[0][0].lng-=1e-6,ll[0][1].lng-=1e-6),this.new="Polyline"==polyType(layer._latlngs)?L.polyline(layer._latlngs,nSettings):"Rectangle"==polyType(layer._latlngs)?L.rectangle(layer._latlngs,nSettings):L.polygon(layer._latlngs,nSettings),K.group.mode[layer.options.group].addLayer(this.new),this.new.on("click",this.show),this.new.saved(!1),createGeoJSON(),switchLayerGroups(),polyHoverAnimation(),K.msg.show({msg:"Duplicated",time:2e3})},_join:function(){var layer=this.layer;this.join=layer,layer.off("click").bringToBack(),this._hide(),K.msg.show({msg:"Select the shape to join!",time:3e3})},_move:function(){var fn,layer=K.tool.layer.layer;layer.dragging.enabled()?(layer.dragging.disable(),$(this).removeClass("end")):(layer.dragging.enable(),$(this).addClass("end"),layer.on("dragend",function(){this.saved(!1)}))},_edit:function(){var fn,layer=K.tool.layer.layer;layer.editing.edit=!layer.editing.edit,$(this).toggleClass("end"),switchLayerGroups()},_split:function(){this._hide();var layer=this.layer,newLayer=this.new,show=this.show;$.each(layer._latlngs,function(i,m){sets=$.extend({},layer.options,{id:ID()}),newLayer="Rectangle"==polyType([m])?L.rectangle([m],sets):L.polygon([m],sets),K.group.mode[newLayer.options.group].addLayer(newLayer),newLayer.on("click",show),newLayer.saved(!1)}),removeLayer(layer,this.group,!0),switchLayerGroups(),polyHoverAnimation()},_hide:function(){$("#settings-menu").remove()},_refresh:function(){K.tool.layer._hide(),K.tool.layer._show.call(K.tool.layer,K.tool.layer.layer)},updateSaved:function(){!this.layer.editing.saved||this.layer.backup&&this.layer.backup.changes?($(".settings-save").css("background-color","#735711"),$(".unsaved").show()):($(".settings-save").css("background-color","#24373d"),$(".unsaved").hide())}},L.Layer.include({tools:K.tool.layer,backup:!1,makeBackup:function(){var backup=function(obj){var rObj={};for(key in obj)"object"===$.type(obj[key])?rObj[key]=backup(obj[key]):"function"===$.type(obj[key])||key.bMatch(/^_/)||(rObj[key]=obj[key]);return rObj},t=this.backup?"paste":"backup";return this[t]={},this[t].options=backup(this.options),this._popup&&(this[t].popup={},this[t].popup._content=this._popup._content,this._popup.options&&(this[t].popup.options=backup(this._popup.options))),"backup"==t&&(K.isInArray(this.options.shape,["polygon","polyline"])?this.backup.pos={latlngs:L.LatLngUtil.cloneLatLngs(this.getLatLngs())}:"marker"==this.options.shape&&(this.backup.pos={latlng:L.LatLngUtil.cloneLatLng(this.getLatLng())})),this},applySetting:function(setting,value,skipSave){if(this.backup||skipSave||this.makeBackup(),"marker"==this.options.shape&&K.isInArray(setting,["className","iconUrl","iconSize","html"])){var p=this.options.icon.options,layer=this;p[setting]=value.bMatch(/\d+,\d+/)?value.split(","):value,$.ajax({type:"HEAD",url:p.iconUrl,success:function(){layer.setIcon(createIcon({url:p.iconUrl,size:p.iconSize,html:p.iconUrl?"":p.html,className:p.className,done:K.complete.is(layer),time:K.complete.time(layer)})),K.complete.is(layer)&&K.complete.add(layer)}})}else this.options[setting]=value;return"marker"!=this.options.shape&&this.setStyle(this.options),"marker"==this.options.shape&&this.setOpacity(this.options.opacity),!skipSave&&this.saved(!1),this},updatePopup:function(setting,value){this.backup||this.makeBackup();var p=this._popup;if("list"==setting)p.options.list=value,p._content=this.convertContent(p.options);else if("content"==setting)p._content=value,p.options.list={};else if("className"==setting){p.options[setting]=value;var ocn=p.oldClassName||this.backup.popup.options.className;$(p._container).removeClass(ocn).addClass(value),p.oldClassName=value}if(p instanceof L.Popup){var isOpen=this.isPopupOpen();this.closePopup(),this.bindPopup(p._content,p.options),p._content?(L.setOptions(p,p.options),isOpen&&this.openPopup()):this.unbindPopup()}else p&&p._content&&this.bindPopup(p._content,p.options);this.saved(!1)},saved:function(saved){var tool=K.tool.layer;this.editing.saved=saved,this.backup.changes=!saved,saved?(K.save.remove(this),delete this.backup):K.save.add(this),tool.isOpen()&&tool.updateSaved()}}),$(function(){$.ajax({url:"includes/credits.php"}).done(function(a){K.credits=a}),K.tool.marker.fill(),$.ajax({url:"includes/map_date.php"}).done(function(a){K.mapVersion=a,L.imageOverlay(`images/map.svg?v=${K.mapVersion}`,[[15,-15],[-15,15]],{attribution:'<a title="Tom Clancy\'s The Division 2" href="https://tomclancy-thedivision.ubisoft.com/">The Division 2</a>',pane:"mapPane"}).addTo(K.myMap)}),K.myMap.addLayer(K.group.mode.groupAll).addLayer(K.group.mode.groupDZ),K.myMap.on("zoomend moveend",function(e){zoom=e.target._zoom,onZoomEnd(),Cookies.set("zoom",K.myMap.getZoom(),K.expires),Cookies.set("pan",K.myMap.getCenter(),K.expires),polyHoverAnimation()}),$(".side-menu-toggle.mode").on("click",function(){var $t=$(this);K.mode.get=$t.hasClass("one")?K.mode.not("survival","normal"):K.mode.not("last stand","normal"),Cookies.set("mode",K.mode.get,K.expires),K.group.mode=K.group.feature[K.mode.get],!K.bar.b.power||K.bar.b.power.enabled()||(K.check.doOnce=!0),pageLoad()}),$("#side-bar .side-menu-toggle:not(.mode):not(.full)").on("click",function(){var sb=$("#side-bar"),c="active",a=$(this).attr("button"),o=Cookies.get("sideMenu"),setCookies=function(){Cookies.set("sideBar",sb.hasClass(c),K.expires),Cookies.set("sideMenu",a,K.expires)};$(this).hasClass(c)?(sb.removeClass(`${c} ${a}`),setTimeout(function(){sb.children().removeClass(c),setCookies()},1e3)):sb.hasClass(c)?(sb.removeClass(`${c} ${o}`),setTimeout(function(){sb.children().removeClass(c),sb.addClass(`${c} ${a}`),sb.children(`.${a}`).addClass(c),setCookies()},1e3)):(sb.addClass(`${c} ${a}`),sb.children(`.${a}`).addClass(c),setCookies())}),$("#side-bar > a").each(function(i,el){$(this).css("top",i=10+40*i+"px")});var el=$("#side-bar .side-menu-toggle.full");el.on("click",toggleFullScreen),$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(e){el.toggleClass("yes")}),K.urlParam("overwolf")||Cookies.get("currentUpdate")==K.currentUpdate||(Cookies.set("sideMenu","changes",K.expires),Cookies.set("sideBar",!0,K.expires),Cookies.set("currentUpdate",K.currentUpdate,K.expires)),$("#side-bar .login").on("click",".page",function(){var page=$(this).attr("name");$.ajax({url:`includes/${page}.php`}).done(function(a){a&&$("#side-bar .login .side-content").html(a)})}),$("#side-bar").on("click","#regform .button",doRegister),$("#side-bar").on("keypress","#regform .input",function(e){13==e.which&&doRegister()}),$("#side-bar").on("click","#donate.button",doDonator),$("#side-bar").on("keypress","#donator",function(e){13==e.which&&doDonator()}),$("#side-bar").on("click","#login .button",doLogin),$("#side-bar").on("keypress","#login .input",function(e){13==e.which&&doLogin()}),$("#side-bar").on("click","#reset .button",doReset),$("#side-bar").on("keypress","#reset .input",function(e){13==e.which&&doReset()}),$("#side-bar").on("click","#forgot .button",doForgot),$("#side-bar").on("keypress","#forgot .input",function(e){13==e.which&&doForgot()}),$("form").submit(function(){return!1}),$("#side-bar").on("click","#logout",function(){$.ajax({url:"includes/logout.php"}).done(function(a){K.user.name=!1,K.user.type=0,K.user.data=!1,$("#side-bar .login .side-content").html(a),pageLoad()})}),$("#side-bar").on("click","#rem-check",function(){$.ajax({type:"POST",url:"includes/validator.php",data:{checked:$(this).prop("checked")}})}),$(document).mousedown(function(e){if(!K.check.grabbing){var container=$(".settings-divider, .switch-active-group, #slider-box, .group-switch");container.is(e.target)||0!==container.has(e.target).length||$(container).remove()}}),$("#side-bar").on("focus",".login .input",function(){$("."+$(this).attr("name")).show(500)}).on("blur",".login .input",function(){$("."+$(this).attr("name")).hide(500)}).on("propertychange change click keyup input paste",".login .input",function(){var el=$(this),ty=el.attr("id"),vl=el.val(),re=!1;"email"==ty||"donator"==ty?re=vl.bMatch(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/):"username"==ty?re=vl.bMatch(/^\w+$/):"password"==ty?re=vl.bMatch(/(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/):"confirmpwd"==ty&&(re=vl==$("#password").val()),el.addClass("incorrect"),re&&el.removeClass("incorrect")}),$("#side-bar .side-menu-toggle").on("mouseenter touchstart",function(){$(this).css("left","-"+($(this).width()+50)+"px")}).on("mouseleave touchmove click",function(){$(this).css("left","-35px")}),$(window).bind("beforeunload",function(){if(K.save.check()){if(navigator.userAgent.toLowerCase().match(/msie|chrome/)){if(window.aysHasPrompted)return;window.aysHasPrompted=!0,window.setTimeout(function(){window.aysHasPrompted=!1},900)}return"are you sure"}}),void 0!==Cookies.get("powered")&&(K.check.doOnce=!Cookies.get("powered")),"string"==$.type(K.urlParam("d"))&&$.ajax({type:"POST",url:"includes/process_donator.php",data:{load:K.urlParam("d")}}).done(function(a){window.location.href=window.location.href.split("?")[0]}),pageLoad()});var ID=function(){return"_"+Math.random().toString(36).substr(2,9)};function arraysEqual(a,b){if(a===b)return!0;if(null==a||null==b)return!1;if(a.length!=b.length)return!1;a.sort(),b.sort();for(var i=0;i<a.length;++i)if(a[i]!==b[i])return!1;return!0}var tagsToReplace={"&":"&amp;","<":"&lt;",">":"&gt;"};function replaceTag(tag){return tagsToReplace[tag]||tag}function safeTags(str){return str.replace(/[&<>]/g,replaceTag)}function hideAlert(){$("#alert").hide()}function naturalCompare(a,b){var ax=[],bx=[];for(a.replace(/(\d+)|(\D+)/g,function(_,$1,$2){ax.push([$1||1/0,$2||""])}),b.replace(/(\d+)|(\D+)/g,function(_,$1,$2){bx.push([$1||1/0,$2||""])});ax.length&&bx.length;){var an=ax.shift(),bn=bx.shift(),nn=an[0]-bn[0]||an[1].localeCompare(bn[1]);if(nn)return nn}return ax.length-bx.length}var rnothtmlwhite=/[^\x20\t\r\n\f]+/g;function classesToArray(value){return Array.isArray(value)?value:"string"==typeof value&&value.match(rnothtmlwhite)||[]}function stripAndCollapse(value){var tokens;return(value.match(rnothtmlwhite)||[]).join(" ")}
//# sourceMappingURL=div.map.min.js.map
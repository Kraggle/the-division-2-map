L.Handler.PathDrag=L.Handler.extend({statics:{DRAGGING_CLS:"leaflet-path-draggable"},initialize:function(path){this._path=path,this._matrix=null,this._startPoint=null,this._dragStartPoint=null,this._mapDraggingWasEnabled=!1},addHooks:function(){this._path.on("mousedown",this._onDragStart,this),this._path.options.className=this._path.options.className?this._path.options.className+" "+L.Handler.PathDrag.DRAGGING_CLS:L.Handler.PathDrag.DRAGGING_CLS,this._path._path&&L.DomUtil.addClass(this._path._path,L.Handler.PathDrag.DRAGGING_CLS)},removeHooks:function(){this._path.off("mousedown",this._onDragStart,this),this._path.options.className=this._path.options.className.replace(new RegExp("\\s+"+L.Handler.PathDrag.DRAGGING_CLS),""),this._path._path&&L.DomUtil.removeClass(this._path._path,L.Handler.PathDrag.DRAGGING_CLS)},moved:function(){return this._path._dragMoved},_onDragStart:function(evt){var eventType=evt.originalEvent._simulated?"touchstart":evt.originalEvent.type;this._mapDraggingWasEnabled=!1,this._startPoint=evt.containerPoint.clone(),this._dragStartPoint=evt.containerPoint.clone(),this._matrix=[1,0,0,1,0,0],L.DomEvent.stop(evt.originalEvent),L.DomUtil.addClass(this._path._renderer._container,"leaflet-interactive"),L.DomEvent.on(document,L.Draggable.MOVE[eventType],this._onDrag,this).on(document,L.Draggable.END[eventType],this._onDragEnd,this),this._path._map.dragging.enabled()&&(this._path._map.dragging.disable(),this._mapDraggingWasEnabled=!0),this._path._dragMoved=!1,this._path._popup&&this._path._popup._content&&this._path._popup._close(),this._replaceCoordGetters(evt)},_onDrag:function(evt){L.DomEvent.stop(evt);var first=evt.touches&&evt.touches.length>=1?evt.touches[0]:evt,containerPoint=this._path._map.mouseEventToContainerPoint(first),totalMouseDragDistance;if("touchmove"===evt.type&&!this._path._dragMoved&&this._dragStartPoint.distanceTo(containerPoint)<=this._path._map.options.tapTolerance)return;var x=containerPoint.x,y=containerPoint.y,dx=x-this._startPoint.x,dy=y-this._startPoint.y;(dx||dy)&&(this._path._dragMoved||(this._path._dragMoved=!0,this._path.fire("dragstart",evt),this._path.bringToFront()),this._matrix[4]+=dx,this._matrix[5]+=dy,this._startPoint.x=x,this._startPoint.y=y,this._path.fire("predrag",evt),this._path._transform(this._matrix),this._path.fire("drag",evt))},_onDragEnd:function(evt){var containerPoint=this._path._map.mouseEventToContainerPoint(evt),moved=this.moved();if(moved&&(this._transformPoints(this._matrix),this._path._updatePath(),this._path._project(),this._path._transform(null),L.DomEvent.stop(evt)),L.DomEvent.off(document,"mousemove touchmove",this._onDrag,this).off(document,"mouseup touchend",this._onDragEnd,this),this._restoreCoordGetters(),moved){this._path.fire("dragend",{distance:Math.sqrt(L.LineUtil._sqDist(this._dragStartPoint,containerPoint))});var contains=this._path._containsPoint;this._path._containsPoint=L.Util.falseFn,L.Util.requestAnimFrame(function(){L.DomEvent._skipped({type:"click"}),this._path._containsPoint=contains},this)}this._matrix=null,this._startPoint=null,this._dragStartPoint=null,this._path._dragMoved=!1,this._mapDraggingWasEnabled&&(moved&&L.DomEvent._fakeStop({type:"click"}),this._path._map.dragging.enable())},_transformPoints:function(matrix,dest){var path=this._path,i,len,latlng,px=L.point(matrix[4],matrix[5]),crs=path._map.options.crs,transformation=crs.transformation,scale=crs.scale(path._map.getZoom()),projection=crs.projection,diff=transformation.untransform(px,scale).subtract(transformation.untransform(L.point(0,0),scale)),applyTransform=!dest;if(path._bounds=new L.LatLngBounds,path._point)dest=projection.unproject(projection.project(path._latlng)._add(diff)),applyTransform&&(path._latlng=dest,path._point._add(px));else if(path._rings||path._parts){var rings=path._rings||path._parts,latlngs=path._latlngs;for(dest=dest||latlngs,L.Util.isArray(latlngs[0])||(latlngs=[latlngs],dest=[dest]),i=0,len=rings.length;i<len;i++){dest[i]=dest[i]||[];for(var j=0,jj=rings[i].length;j<jj;j++)latlng=latlngs[i][j],dest[i][j]=projection.unproject(projection.project(latlng)._add(diff)),applyTransform&&(path._bounds.extend(latlngs[i][j]),rings[i][j]._add(px))}}return dest},_replaceCoordGetters:function(){this._path.getLatLng?(this._path.getLatLng_=this._path.getLatLng,this._path.getLatLng=L.Util.bind(function(){return this.dragging._transformPoints(this.dragging._matrix,{})},this._path)):this._path.getLatLngs&&(this._path.getLatLngs_=this._path.getLatLngs,this._path.getLatLngs=L.Util.bind(function(){return this.dragging._transformPoints(this.dragging._matrix,[])},this._path))},_restoreCoordGetters:function(){this._path.getLatLng_?(this._path.getLatLng=this._path.getLatLng_,delete this._path.getLatLng_):this._path.getLatLngs_&&(this._path.getLatLngs=this._path.getLatLngs_,delete this._path.getLatLngs_)}}),L.Handler.PathDrag.makeDraggable=function(layer){return layer.dragging=new L.Handler.PathDrag(layer),layer},L.Path.prototype.makeDraggable=function(){return L.Handler.PathDrag.makeDraggable(this)},L.Path.addInitHook(function(){this.dragging=new L.Handler.PathDrag(this),this.options.draggable&&(this.options.interactive=!0,this.once("add",function(){this.dragging.enable()}))});
//# sourceMappingURL=Path.Drag.min.js.map
globalVar=!1,function($){$.urlParam=function(name){var a={},r=window.location.href.match(/\?([^#]*)/);return null==r?null:(r=r[1].split("&"),$.each(r,function(k,v){v=v.split("="),a[v[0]]=v[1]}),a[name]||a)},$.curtail=function(){var a=arguments[0],e=arguments[1];return!Object.keys(a).length&&Object.keys(e).length&&(a=$.extend({},arguments[1]),e=arguments[2]),e&&"object"!=typeof e&&(e=[e]),$.each(e,function(i,v){v in a&&delete a[v]}),a},$.bInArray=function(){return-1!=$.inArray(arguments[0],arguments[1])}}(jQuery),L.Draw.Feature.include({enable:function(){this._disabled||this._enabled||(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DRAWSTART,{layerType:this.type}))},toggle:function(){this._enabled?(L.Handler.prototype.disable.call(this),this._map.fire(L.Draw.Event.DRAWSTOP,{layerType:this.type}),this.fire("disabled",{handler:this.type})):(L.Handler.prototype.enable.call(this),this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DRAWSTART,{layerType:this.type}))},disabler:function(){return this._disabled=!0,this.disable(),this._updateDisabled(),this},enabler:function(){return this._disabled=!1,this._updateDisabled(),this},_updateDisabled:function(){var className="leaflet-disabled";this._button||(this._button=document.getElementsByClassName("leaflet-draw-draw-"+this.type)[0]),L.DomUtil.removeClass(this._button,className),this._disabled&&L.DomUtil.addClass(this._button,className)}}),L.EditToolbar.include({getActions:function(){return[{title:L.drawLocal.edit.toolbar.actions.save.title,text:L.drawLocal.edit.toolbar.actions.save.text,callback:this._save,context:this},{title:L.drawLocal.edit.toolbar.actions.cancel.title,text:L.drawLocal.edit.toolbar.actions.cancel.text,callback:this.disable,context:this}]}}),L.EditToolbar.Delete.include({enable:function(){this._disabled||!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.DELETESTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._deletableLayers.on("layeradd",this._enableLayerDelete,this).on("layerremove",this._disableLayerDelete,this))},disabler:function(){return this._disabled=!0,this.disable(),this._updateDisabled(),this},enabler:function(){return this._disabled=!1,this._updateDisabled(),this},_updateDisabled:function(){var className="leaflet-disabled";this._button||(this._button=document.getElementsByClassName("leaflet-draw-edit-"+this.type)[0]),L.DomUtil.removeClass(this._button,className),this._disabled&&L.DomUtil.addClass(this._button,className)}}),L.EditToolbar.Edit.include({enable:function(){this._disabled||!this._enabled&&this._hasAvailableLayers()&&(this.fire("enabled",{handler:this.type}),this._map.fire(L.Draw.Event.EDITSTART,{handler:this.type}),L.Handler.prototype.enable.call(this),this._featureGroup.on("layeradd",this._enableLayerEdit,this).on("layerremove",this._disableLayerEdit,this))},disabler:function(){return this._disabled=!0,this.disable(),this._updateDisabled(),this},enabler:function(){return this._disabled=!1,this._updateDisabled(),this},_updateDisabled:function(){var className="leaflet-disabled";this._button||(this._button=document.getElementsByClassName("leaflet-draw-edit-"+this.type)[0]),L.DomUtil.removeClass(this._button,className),this._disabled&&L.DomUtil.addClass(this._button,className)}}),L.Layer.include({bindPopup:function(content,options){return options=$.extend({className:"",pane:(options.className||"").bIndexOf("poly-info")?"messagePane":"popupPane",list:{},offset:L.point(-24,42),closeButton:!1,autoPan:!1},options),!content&&options.list.title&&(content=this.convertContent(options)),content instanceof L.Popup?(L.setOptions(content,options),this._popup=content,content._source=this):(content=(content||"").bMatch(/^\$/)?_k.popupContent[content]:content,this._popup&&!options||(this._popup=new L.Popup(options,this)),this._popup.setContent(content)),this._popupHandlersAdded||(this.on({remove:this.closePopup,move:this._movePopup}),this.on("mouseover click focus",this._openPopup).on("mouseout blur",this.closePopup),this._popupHandlersAdded=!0),this},convertContent:function(options){var list=options.list,html="",img,mark;return list.title&&(html+='<span class="title">'+list.title+"</span>"),$.each(list.subs,function(i,v){v&&(html+="<p>"+v+"</p>")}),list.list&&list.list[0]&&list.list[0].item&&(list.list.sort(function(a,b){return a.item<b.item?-1:a.item>b.item?1:0}),html+="<ul>",$.each(list.list,function(i,v){if(!v)return!0;var n=(v.item||"").replace(/ /g,"");$.each(_k.tool.marker.layers,function(j,w){w[n]&&(mark=w[n])}),img="<img"+(mark?' src="'+mark.properties.icon.options.iconUrl+'"':"")+">",html+="<li>"+img+"<span>"+v.item+'</span><span class="qty">'+(v.qty>1?"(x"+v.qty+")":"")+"</span></li>"}),html+="</ul>"),html},closePopup:function(){return this._popup&&this._popup._content&&this._popup._close(),this}}),L.DivOverlay.include({_updateContent:function(){if(this instanceof L.Popup&&this.options.list&&this.options.list.title&&(this._content=this.convertContent(this.options)),this._content){var node=this._contentNode,content="function"==typeof this._content?this._content(this._source||this):this._content;if("string"==typeof content)node.innerHTML=content;else{for(;node.hasChildNodes();)node.removeChild(node.firstChild);node.appendChild(content)}this.fire("contentupdate")}}}),L.Icon.include({_setIconStyles:function(img,name){var options=this.options,sizeOption=options[name+"Size"];"number"==typeof sizeOption&&(sizeOption=[sizeOption,sizeOption]);var size=L.point(sizeOption),anchor=L.point("shadow"===name&&options.shadowAnchor||options.iconAnchor||size&&size.divideBy(2,!0));img.className="leaflet-marker-"+name+" "+(options.className||""),anchor&&(img.style.marginLeft=-anchor.x+"px",img.style.marginTop=-anchor.y+"px",(options.className||"").bIndexOf("overground")?img.style.marginTop=-size.y+"px":(options.className||"").bIndexOf("underground")&&(img.style.marginTop=0)),size&&(img.style.width=size.x+"px",img.style.height=size.y+"px")}}),L.Control.Button=L.Control.extend({options:{position:"topleft",container:"map",text:"",title:"Save to JSON",css:"save",clickFn:createGeoJSON},onAdd:function(map){var control="leaflet-control",options=this.options,el=control+" "+options.container+" leaflet-bar",container=document.getElementsByClassName(el)[0]||L.DomUtil.create("div",el);return this._button=this._createButton(options.text,options.title,control+"-"+options.css,container,this._onClick),container},onRemove:function(map){},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_onClick:function(e){this._disabled||this.options.clickFn(this)},_createButton:function(html,title,className,container,fn){var link=L.DomUtil.create("a",className,container);return link.innerHTML=html,link.href="#",link.title=title,link.setAttribute("role","button"),link.setAttribute("aria-label",title),L.DomEvent.on(link,"mousedown dblclick",L.DomEvent.stopPropagation).on(link,"click",L.DomEvent.stop).on(link,"click",fn,this),link},_updateDisabled:function(){var className="leaflet-disabled";L.DomUtil.removeClass(this._button,className),this._disabled&&L.DomUtil.addClass(this._button,className)}}),L.control.button=function(options){return new L.Control.Button(options)},Cookies.json=!0;var _k={currentUpdate:"17/01/2018",bar:{b:{save:!1,group:!1,grid:!1,tools:!1},draw:{},edit:{}},check:{editing:!1,deleting:!1,disabled:!1,doOnce:!0},drawControl:!1,group:{save:new L.FeatureGroup,draw:new L.FeatureGroup([],{makeBoundsAware:!1}),feature:{}},grid:{overlay:L.imageOverlay("images/grid.svg",[[-19.05,-19.05],[19.05,19.05]]),x:0,y:0,r:0},save:{unsaved:new L.FeatureGroup,deleted:[],add:function(layer){this.unsaved.addLayer(layer),this.check()},remove:function(layer){this.unsaved.removeLayer(layer._leaflet_id),this.check()},delete:function(layer){this.remove(layer),this.deleted.push(layer.options.id),this.check()},check:function(){return(r=Object.keys(this.unsaved._layers).length+this.deleted.length)?_k.bar.b.save.enable():_k.bar.b.save.disable(),r}},lng:"en",map:{active:Cookies.get("activeMap")||[],group:{groupAll:[],groupDZ:["n/a"],groupHidden:["n/a"],group08:[],group09:[],group10:[],group11:[],group12:[]},type:{counts:{}},mode:{},property:{polygon:["color","weight","opacity","fillColor","fill","fillOpacity","stroke","group","shape","type","className","id","mode","creator"],polyline:["color","weight","opacity","stroke","group","shape","type","className","id","mode","creator"],marker:["icon","group","type","shape","opacity","id","mode","creator"],popup:["className"]},defaults:{marker:{className:"anim-icon",group:"group08",iconSize:[22,22],iconUrl:"images/poi-contaminated.svg",mode:"all",shape:"marker",type:"Contaminated"},polygon:{className:"",color:"#c22e2e",fill:1,fillColor:"#672f2f",fillOpacity:.05,group:"group08",mode:"all",opacity:.4,pane:"overlayPane",shape:"polygon",smoothFactor:1,stroke:1,type:"ContaminatedZone",weight:1},polyline:{color:"#207e70",group:"groupAll",mode:"all",opacity:1,pane:"overlayPane",shape:"polyline",smoothFactor:1,stroke:1,type:"",weight:5}},settings:{counts:{iconUrl:[],iconSize:[],className:[],color:[],fillColor:[],popup:{className:[]},opacity:[],fillOpacity:[],fill:[!0,!1],interactive:[!0,!1],stroke:[!0,!1],weight:[],type:[],mode:[],group:[]},marker:["className","iconUrl","opacity","iconSize","html","type","mode","group","id"],popup:["className","content","list"],polygon:["fill","fillColor","fillOpacity","stroke","color","opacity","weight","className","type","mode","group","id"],polyline:["color","opacity","weight","className","type","mode","group","id"],types:{className:"string",color:"string",fill:"boolean",fillColor:"string",fillOpacity:"number",group:"string",html:"string",iconSize:"array",iconUrl:"string",id:"string",mode:"string",opacity:"number",stroke:"boolean",type:"string",weight:"number"}},zIndex:["PointOfInterest","Hideout","Contaminated","Landmark","CrashSite"]},mode:{get:Cookies.get("mode")||"normal",not:function(mode=!1,other){return mode?this.get==mode?other:mode:"normal"==this.get?["survival","last stand","survival last stand"]:["normal","survival","normal survival"]}},msg:{note:$(".notification"),show:function(options){$.proxy(_k.msg._show(options),_k.msg)},_show:function(options){options=$.extend({msg:"",time:0,dots:!1},options);var dot='<div class="dot"></div>';this.note.length||($("body").append('<div class="notification"></div>'),this.note=$(".notification")),options.msg&&(this.timeout&&clearTimeout(this.timeout),this.note.removeClass("dots"),options.dots&&this.note.addClass("dots"),this.note.html(options.msg+(options.dots?'<div class="dot-box">'+dot+dot+dot+dot+dot+"</div>":"")),this.note.fadeIn(500),options.time&&(this.timeout=setTimeout(this.hide,options.time)))},hide:function(){$.proxy(_k.msg._hide(),_k.msg)},_hide:function(){this.note.fadeOut(500),this.timeout=!1},timeout:!1},myMap:L.map("mapid",{center:Cookies.get("pan")||[0,0],zoom:Cookies.get("zoom")||7,minZoom:7,maxZoom:15,maxBounds:[[-4.85,-6.35],[5.65,6.35]],zoomSnap:.25,zoomDelta:.5,wheelPxPerZoomLevel:100,zoomControl:!1,attributionControl:!0}),pane:{},popupContent:{$rucksack:"<span class='title'>Rucksack</span><p>Could contain...</p><ul><li><img src='images/crate-clothing.svg'><span>Clothing</span><span class='qty'></span></li><li><img src='images/crate-food.svg'><span>Food</span><span class='qty'></span></li><li><img src='images/crate-drink.svg'><span>Drink</span><span class='qty'></span></li></ul>",$crateElite:"<span class='title'>Elite Crate</span><p>Contains a combination of...</p><ul><li><img src='images/crate-gear.svg'><span>Gear</span><span class='qty'></span></li><li><img src='images/crate-weapons.svg'><span>Weapon</span><span class='qty'></span></li><li><img src='images/crate-clothing.svg'><span>Clothing</span><span class='qty'></span></li><li><img src='images/crate-medication.svg'><span>Medication</span><span class='qty'></span></li><li><img src='images/crate-medkit.svg'><span>Medkit</span><span class='qty'></span></li><li><img src='images/crate-food.svg'><span>Food</span><span class='qty'></span></li><li><img src='images/crate-drink.svg'><span>Drink</span><span class='qty'></span></li></ul>"},shortcuts:{Draw:{M:"Marker",P:"Polygon",R:"Rectangle",L:"Polyline"},QuickMarker:{1:"Electronics Survival",2:"Fabric Survival",3:"Tools Survival",4:"Weapon Parts Survival",5:"Clothing",E:"Medkit",A:"Medication",F:"Food",D:"Drink",S:"Rucksack",W:"Weapon",Q:"Gear",Z:"Ground Level",X:"Underground",C:"Overground"}},tool:{},user:{name:!1,type:0,error:!1},local:{data:{},lang:!1,email:null==Cookies.get("email-check")||Cookies.get("email-check"),total:0,count:0,languages:!1,users:[],delete:{},save:{},update:function(){$.proxy(_k.local._update(),_k.local)},_update:function(){if(this.select){var $t=$("#translate textarea"),$c=$(".contribute"),data=this.data[this.select];this.lang in data?($t.val(data[this.lang]),$t.attr("original",data[this.lang]),$c.show().children(".user").html(data[this.lang+"-user"])):($t.val(""),$t.attr("original",""),$c.hide())}this.lang&&(this.total=0,this.count=0,$.each(this.data,function(k,v){var $b=$("#"+hex_sha512(k)),l=_k.local;l.lang in v?(l.count++,$b.addClass("got")):$b.removeClass("got"),l.total++}),$("#translate .display").removeClass("blink-me"),$("#translate .number").html((100*this.count/this.total).toFixed(1)),$.getJSON("data/languages.json",function(data){var l=_k.local;l.languages=data,l.languages[l.lang].got?$("#done-check a").addClass("checked"):$("#done-check a").removeClass("checked")}))}},modes:{get:["normal","survival","last stand"],create:function(){$.each(this.get,function(index,mode){_k.group.feature[mode]={},_k.map.type[mode]={marker:{},polygon:{},polyline:{}}})}}};function pageLoad(){"true"==$.urlParam("noIcon")&&Cookies.set("hideIcon",!0),"true"==$.urlParam("clean")&&Cookies.set("cleanMenu",!0),Cookies.get("hideIcon")||$("#survival-logo").fadeIn(500),Cookies.get("cleanMenu")&&($(".side-menu-toggle.login").hide(0),$(".side-menu-toggle.filters").hide(0),$(".side-menu-toggle.full").hide(0),$(".side-menu-toggle.changes").hide(0),$(".side-menu-toggle.todo").hide(0),$(".side-menu-toggle.gear").hide(0),$(".side-menu-toggle.language").hide(0),$(".side-menu-toggle.shorts").hide(0),$(".leaflet-control-attribution.leaflet-control").hide(0),$("#logo").hide(0)),"true"==$.urlParam("overwolf")&&($(".side-menu-toggle.full").hide(0),$(".side-menu-toggle.changes").hide(0),$(".side-menu-toggle.todo").hide(0),$(".side-menu-toggle.language").hide(0),$(".side-menu-toggle.shorts").hide(0),$(".leaflet-control-attribution.leaflet-control").hide(0),$("#alert").hide(0),$("#logo").hide(0),$("#side-bar .side-menu-toggle.gear").css("top","170px")),$.ajaxSetup({cache:!1}),$.ajax({url:"includes/check_login.php"}).done(function(a){a=$.parseJSON(a),_k.user.name=a.username||!1,_k.user.type=a.usertype||0,_k.user.donate=a.donate||0,!_k.user.donate&&!$.urlParam("overwolf")&&$("#alert").show(),_k.user.donate&&$("#alert").hide(),setCollectionData(),$("#message").removeClass("master");var shorts=$("#side-bar .shorts .side-content");if(shorts.html(""),$(".side-menu-toggle.shorts").hide(),$.each(_k.bar.b,function(i,v){empty(v)}),empty(_k.drawControl),$("document").off("keypress"),$("#side-bar a.login").removeClass("out"),_k.user.type){$("#side-bar a.login").addClass("out"),$("#message").addClass("master"),!$.urlParam("overwolf")&&$(".side-menu-toggle.shorts").show();var key=function(k,t){return'<div class="item"><div>'+k+'</div><div class="grey">-</div> <span>'+t.replace(" Survival","")+"</span></div>"};shorts.append('<span class="title">Shortcuts</span>'),$.each(_k.shortcuts,function(sub,a){shorts.append('<span class="title sub">'+sub.space()+"</span>"),$.each(a,function(k,t){shorts.append(key(k,t))})}),shorts.append(_k.credits),_k.bar.b.power=L.control.button({text:"",container:"power",title:"Enable/disable tools",css:"power",clickFn:function(){_k.bar.b.power._click()}}).addTo(_k.myMap),_k.bar.b.power=$.extend(_k.bar.b.power,{enabled:function(){return!$(this._button).hasClass("enabled")},_click:function(){var el=$(this._button),buttons=$(".leaflet-top.leaflet-left").children().not(".power").find("a");this.enabled()||_k.check.doOnce?(el.addClass("enabled"),$.each(_k.bar.draw,function(i,type){type.disabler()}),$("#marker-tools, .group-switch, #settings-menu").remove(),_k.bar.b.group.disable(),_k.bar.b.tools.disable(),switchLayerGroups(!0),$(buttons.get().reverse()).each(function(index,btn){setTimeout(function(){$(btn).css("transform","translateX(-50px)")},40*index)})):(buttons.each(function(index,btn){setTimeout(function(){$(btn).css("transform","translateX(0px)")},40*index)}),el.removeClass("enabled"),$.each(_k.bar.draw,function(i,type){type.enabler()}),_k.bar.b.group.enable(),_k.bar.b.tools.enable(),switchLayerGroups()),Cookies.set("powered",this.enabled()),_k.check.doOnce=!1}}),_k.bar.b.save=L.control.button().addTo(_k.myMap).disable(),_k.bar.b.group=L.control.button({text:"",title:"Switch editable layers",css:"group",clickFn:function(){if($(".group-switch").length)$(".group-switch").remove();else{$("body").append('<div class="leaflet-menu group-switch"></div>');var div=document.getElementsByClassName("group-switch")[0];L.DomEvent.disableClickPropagation(div),L.DomEvent.on(div,"mousewheel",L.DomEvent.stopPropagation);var list=$.merge(_k.map.mode[_k.mode.get],_k.map.mode.all).sort();$.unique(list),$.each(list,function(i,t){$(".leaflet-menu").append('<a class="leaflet-menu-item switch-active-group'+(_k.map.active[t]?" active":"")+'" type="'+t+'">'+t.space()+"</a>")}),$(".switch-active-group").on("click",function(e){var t=$(this).attr("type");$(this).toggleClass("active"),_k.map.active[t]=!_k.map.active[t],Cookies.set("activeMap",$.extend({},_k.map.active)),switchLayerGroups()})}}}).addTo(_k.myMap),_k.bar.b.grid=L.control.button({text:"",title:"Grid modifier tools",css:"grid",clickFn:function(){var el=arguments[0]._button;if($("#slider-box").length)$("#slider-box").remove();else{var gridTools=["rotate","x-pos","y-pos"];$(el).after('<div id="slider-box"></div>'),$.each(gridTools,function(i,type){$("#slider-box").append('<div class="leaflet-menu-slider"><div id="slider-'+type+'" class="slider-class '+type+'"><div class="handle-'+type+' ui-slider-handle"></div></div></div>'),$("#slider-"+type).slider({min:"rotate"==type?-45:-100,max:"rotate"==type?45:100,step:"rotate"==type?.5:1,value:Cookies.get("grid-"+type)||0,create:function(){var val=$(this).slider("value");$(".handle-"+type).text("rotate"==type?val+" deg":"x-pos"==type?"X: "+val:"Y: "+val)},slide:function(e,ui){$(".handle-"+type).text("rotate"==type?ui.value+" deg":"x-pos"==type?"X: "+ui.value:"Y: "+ui.value),Cookies.set("grid-"+type,ui.value),setGridRotate()},change:function(e,ui){$(".handle-"+type).text("rotate"==type?ui.value+" deg":"x-pos"==type?"X: "+ui.value:"Y: "+ui.value),Cookies.set("grid-"+type,ui.value),setGridRotate()}})}),$("#slider-box").append('<div class="slider-resets"></div>'),$.each(gridTools,function(i,type){$(".slider-resets").append('<a class="slider-button reset-'+type+'">Reset '+type.firstToUpper()+"</a>"),$(".slider-button.reset-"+type).on("click",function(){$("#slider-"+type).slider("value",0)})}),$(".slider-resets").append('<a class="slider-button reset-all">Reset All</a>'),$(".slider-button.reset-all").on("click",function(){$(".slider-class").slider("value",0)});var div=L.DomUtil.get("slider-box");L.DomEvent.disableClickPropagation(div),L.DomEvent.on(div,"mousewheel",L.DomEvent.stopPropagation)}}}).addTo(_k.myMap).disable(),_k.bar.b.tools=L.control.button({text:"",title:"Toggle marker tool panel",css:"tools",clickFn:_k.tool.marker.show}).addTo(_k.myMap),icon="object"==$.type(Cookies.get("marker"))?Cookies.get("marker"):{};var createIcon=L.Icon.extend({options:{iconSize:icon.iconSize||[22,22],iconUrl:icon.iconUrl||"images/poi-contaminated.svg",html:icon.html||"<img class='halo' src='images/_a.svg'><img src='"+(icon.iconUrl||"images/poi-contaminated.svg")+"' class='icon'>",className:icon.className||"anim-icon"}});_k.drawControl=new L.Control.Draw({draw:{circle:!1,marker:{icon:new createIcon}},edit:{featureGroup:_k.group.draw,selectedPathOptions:{maintainColor:!0,moveMarkers:!0}}}),_k.myMap.addControl(_k.drawControl).on("draw:created",drawEventCreated),_k.bar.draw.Polygon=_k.drawControl._toolbars.draw._modes.polygon.handler,_k.bar.draw.Polyline=_k.drawControl._toolbars.draw._modes.polyline.handler,_k.bar.draw.Rectangle=_k.drawControl._toolbars.draw._modes.rectangle.handler,_k.bar.draw.Marker=_k.drawControl._toolbars.draw._modes.marker.handler,_k.bar.edit.Edit=_k.drawControl._toolbars.edit._modes.edit.handler,_k.bar.edit.Remove=_k.drawControl._toolbars.edit._modes.remove.handler,$(document).off("keypress"),$(document).on("keypress",keypressEvent),drawButtons=$(".leaflet-draw-section"),_k.myMap.on("draw:editstart",function(e){polyHoverAnimation(!0),$("#settings-menu, .group-switch, #marker-tools").remove(),_k.bar.b.power.disable(),_k.bar.b.group.disable(),_k.bar.b.save.disable(),_k.bar.b.tools.disable(),_k.myMap.addLayer(_k.group.draw).addLayer(_k.grid.overlay),_k.bar.b.grid.enable(),setGridRotate(),_k.bar.edit.Remove.disabler(),$.each(_k.bar.draw,function(i,type){type.disabler()}),_k.check.editing=!0,editIconMessage()}),_k.myMap.on("draw:edited",function(e){e.layers.eachLayer(function(l){l.editing.saved=!1,_k.save.add(l)})}),_k.myMap.on("draw:editstop",function(e){_k.bar.b.power.enable(),_k.bar.b.group.enable(),_k.bar.b.tools.enable(),_k.save.check(),_k.myMap.removeLayer(_k.grid.overlay),_k.bar.b.grid.disable(),$("#slider-box").remove(),_k.bar.edit.Remove.enabler(),$.each(_k.bar.draw,function(i,type){type.enabler()}),_k.check.editing=!1,polyHoverAnimation(),onZoomEnd(!0)}),_k.myMap.on("draw:deletestart",function(e){_k.check.deleting=!0,$.each(_k.bar.b,function(i,type){type.disable()}),_k.bar.edit.Edit.disabler(),$.each(_k.bar.draw,function(i,type){type.disabler()}),_k.myMap.addLayer(_k.group.draw).addLayer(_k.grid.overlay),setGridRotate()}),_k.myMap.on("draw:deleted",function(e){_k.group.draw.eachLayer(function(l){var i=l._leaflet_id;_k.group.draw.removeLayer(i),_k.save.delete(l)})}),_k.myMap.on("draw:deletestop",function(e){_k.check.deleting=!1,_k.bar.b.power.enable(),_k.bar.b.group.enable(),_k.save.check(),_k.bar.edit.Edit.enabler(),$.each(_k.bar.draw,function(i,type){type.enabler()}),onZoomEnd(!0)}),_k.myMap.on("draw:drawstop",function(e){_k.msg.show({msg:"Remember, you may have to zoom in to see the layers you create!",time:2500})})}_k.user.type&&_k.check.doOnce&&_k.bar.b.power._onClick();var btn="#side-bar a.mode",b1=_k.mode.not("survival","normal"),b2=_k.mode.not("last stand","normal");$.each(_k.modes.get,function(i,mode){$(btn).removeClass(mode)}),$(btn+".one").text(b1.titleCase()+" Map").addClass(b1),$(btn+".two").text(b2.titleCase()+" Map").addClass(b2),$.each(_k.modes.get,function(i,mode){$("#logo").removeClass(mode)}),$("#logo").addClass(_k.mode.get),$.ajax({type:"POST",url:"includes/file_exists.php",data:{data:_k.user.name}}).done(function(a){a=$.parseJSON(a),_k.userPath=a?"data/"+_k.user.name+"/geoJSON.json":"data/empty.json",$.getJSON(_k.userPath,function(userJSON){$.getJSON("data/geoJSON.json",function(geoJSON){$.each(_k.group.feature,function(i,mode){$.each(mode,function(j,group){group.clearLayers(),_k.myMap.removeLayer(group)})}),_k.map.type.counts={},userJSON.features&&$.extend(geoJSON.features,userJSON.features),$.each(geoJSON.features,function(i,e){var newLayer,p=e.properties,g=e.geometry;if(p){if(p.type||(p.type=""),p.type&&!$.bInArray(p.type,_k.map.group[p.group])&&_k.map.group[p.group].push(p.type),p.type&&p.mode&&p.shape){var filter=!1;if(_k.user.type<1?p.type.bIndexOf("Complete")||"Error"==p.type||(filter=!0):_k.user.type<=3?p.type.bIndexOf(_k.user.name)?filter=!0:p.type.bIndexOf("Complete")||"Error"==p.type||(filter=!0,filter=!0):_k.user.type>=4&&(filter=!0),filter){var val=p.fillColor;"marker"==p.shape&&(val=p.icon.options.iconUrl),"polyline"==p.shape&&(val=p.color),_k.map.type.counts[p.type]?_k.map.type.counts[p.type]++:_k.map.type.counts[p.type]=1,$.each(_k.modes.get,function(i,mode){(p.mode.bMatch(mode)||"all"==p.mode)&&(_k.map.type[mode][p.shape][p.type]||(_k.map.type[mode][p.shape][p.type]=[]),$.bInArray(val,_k.map.type[mode][p.shape][p.type])||(_k.map.type[mode][p.shape][p.type].push(val),"polygon"==p.shape&&_k.map.type[mode][p.shape][p.type].push(p.color)))})}}for(n in _k.map.mode.hasOwnProperty(p.mode)||(_k.map.mode[p.mode]=[]),p.mode&&p.type&&!$.bInArray(p.type,_k.map.mode[p.mode])&&_k.map.mode[p.mode].push(p.type),p)p[n]=toCorrectType(n,p[n]),n in _k.map.settings.counts&&addSet(_k.map.settings.counts[n],p[n]);if("marker"==p.shape&&p.type){var obj=$.extend(!0,{},e,{properties:{icon:{options:{className:(p.icon.options.className||"").replace(/\w+ground/g,"").trim()}}}});$.each(_k.modes.get,function(i,mode){!p.mode.bIndexOf(mode)&&"all"!=p.mode||$.bInArray(p.type,_k.tool.marker.layers[mode])||(_k.tool.marker.layers[mode][p.type]=obj)})}if("Polyline"==g.type)newLayer=L.polyline(g.coordinates,p);else if("Polygon"==g.type||"Rectangle"==g.type){var obj=$.extend(p,{pane:p.pane||("poly-hover"==p.className?"zonePane":"overlayPane")});newLayer="Rectangle"==g.type?L.rectangle(g.coordinates,obj):L.polygon(g.coordinates,obj)}else if("Point"==g.type)for(n in newLayer=createMarker($.extend(p,p.icon.options,{latlng:g.coordinates})),p.icon.options)p.icon.options[n]=toCorrectType(n,p.icon.options[n]),n in _k.map.settings.counts&&addSet(_k.map.settings.counts[n],p.icon.options[n]);if("popup"in e&&("content"in e.popup||"options"in e.popup&&"list"in e.popup.options&&e.popup.options.list.title)){var o=e.popup;o.options.className||(o.options.className=""),newLayer.bindPopup(o.content,{className:o.options.className,list:o.options.list||{}}),_k.user.type&&addSet(_k.map.settings.counts.popup.className,e.popup.options.className)}_k.user.type&&(_k.user.type>=4||p.creator.toLowerCase()==_k.user.name.toLowerCase())&&newLayer.on("click",_k.tool.layer.show);var add=!1;_k.user.type<1?p.type.bIndexOf("Complete")||"Error"==p.type||(add=!0):_k.user.type<=3?p.type.bIndexOf(_k.user.name)?add=!0:p.type.bIndexOf("Complete")||"Error"==p.type||(add=!0):_k.user.type>=4&&(add=!0),add&&addToFeatureGroups(newLayer)}})}).fail(function(){console.log("error")}).done(function(){onZoomEnd(),_k.user.type&&switchLayerGroups();var sb="#side-bar .filters .side-content";if($(sb).html(""),$(sb).append('<a class="hide-all">Hide All</a><span href="#" class="title">'+_k.mode.get.titleCase()+" Filters</span>"),$.each(_k.map.type[_k.mode.get],function(t,a){a=sortObjByKeys(a);var f=Cookies.get("filters")||{};$(sb).append('<span class="sub title">'+(Object.keys(a).length?t.firstToUpper():"")+"</span>"),$.each(a,function(n,i){var c=f[n]||!1,el=$("<a />",{class:"side-bar-button "+(c?"inactive":""),set:t,label:n,html:$("<span />",{html:n.space().replace(/Dz/,"DZ").replace(/ (Survival|Complete)/,"").replace(" Of "," of ")})}).appendTo(sb);$("<span />",{html:"[ x"+_k.map.type.counts[n]+" ]",class:"quantity"}).appendTo(el),i[0].bIndexOf(".svg")?$("<img />",{src:i[Math.floor(Math.random()*i.length)]}).prependTo(el):"polyline"==t?$("<div />",{class:"polyline"}).css({backgroundColor:i[0]}).prependTo(el):$("<div />",{class:"polygon"}).css({borderColor:i[1],backgroundColor:i[0]}).prependTo(el),c&&showHideLayers(t,n,!0)})}),$("#side-bar .side-bar-button").off("click").on("click",function(){$(this).toggleClass("inactive"),togglehideAll();var t=$(this).attr("label"),g=!1,ia=$(this).hasClass("inactive"),filters=Cookies.get("filters")||{};filters[t]=ia,Cookies.set("filters",filters),showHideLayers($(this).attr("set"),t,ia)}),$("#side-bar .hide-all").off("click").on("click",function(){showhideAllLayers(!$(this).hasClass("hidden")),togglehideAll()}),togglehideAll(),$(sb).append(_k.credits),Cookies.get("sideBar")&&!Cookies.get("cleanMenu")){var a=Cookies.get("sideMenu");$("#side-bar, #side-bar ."+a).addClass("active "+a)}polyHoverAnimation(),$('[title!=""]').qtip({position:{viewport:$("#mapid"),my:"left center",at:"right center"},style:{classes:"tooltip-style"},show:{delay:250,solo:!0},hide:{event:"click mouseleave"}}),$(document).on("mouseover",'[title!=""]',function(e){$(this).attr("title")&&($(this).removeAttr("oldtitle"),$(this).qtip("destroy",!0),$(this).qtip({position:{viewport:$("#mapid"),my:"left center",at:"right center"},style:{classes:"tooltip-style"},show:{delay:250,solo:!0},hide:{event:"click mouseleave"}}),$(this).qtip("toggle",!0))}),setTimeout(function(){$("#survival-logo").fadeOut(1e3)},1e3),$(".paypalBtn").off("click").on("click",function(event){$("#side-bar .filters .paypalBtn").closest("form").submit()})})})})})}function doDonator(){$.ajax({type:"POST",url:"includes/process_donator.php",data:{email:$("#donator").val()}}).done(function(a){(a=$.parseJSON(a)).success?($("#side-bar .login .success").html(a.success),$("#side-bar .login .error").html(""),$("#donator").val("")):($("#side-bar .login .error").html(a.error),$("#side-bar .login .success").html(""))})}function doLogin(){_this=document.getElementById("login"),formhash(_this,_this.password),$.ajax({type:"POST",url:"includes/process_login.php",data:{email:_this.username.value,p:_this.p.value}}).done(function(a){Cookies.get("username")&&(_k.user.name=Cookies.get("username"),_k.user.type=Cookies.get("usertype")),Cookies.get("donate")?$("#alert").hide():$("#alert").show(),a&&($("#side-bar .login .side-content").html(a),_k.check.doOnce=!0,pageLoad())})}function doRegister(){_this=document.getElementById("regform"),regformhash(_this,_this.username,_this.email,_this.password,_this.confirmpwd)?$.ajax({type:"POST",url:"includes/process_register.php",data:{username:_this.username.value,email:_this.email.value,p:_this.p.value}}).done(function(a){a=a.bMatch(/^(\{|\[])".*(\}|\])$/)?$.parseJSON(a):a,"object"==$.type(a)&&a.error?$("#side-bar .login .error").html(a.error):$("#side-bar .login .side-content").html(a)}):$("#side-bar .login .error").html(_k.user.error)}function doReset(){_this=document.getElementById("reset"),resetformhash(_this,_this.password,_this.confirmpwd)?$.ajax({type:"POST",url:"includes/process_reset.php",data:{token:$.urlParam("token"),p:_this.p.value}}).done(function(a){a=a.bMatch(/^(\{|\[])".*(\}|\])$/)?$.parseJSON(a):a,"object"==$.type(a)&&a.error?$("#side-bar .login .error").html(a.error):window.location.href=window.location.href.split("?")[0]}):$("#side-bar .login .error").html(_k.user.error)}function doForgot(){_this=document.getElementById("forgot"),$.ajax({type:"POST",url:"includes/process_forgot.php",data:{email:_this.email.value}}).done(function(a){globalVar=a.bMatch(/^(\{|\[])".*(\}|\])$/)?$.parseJSON(a):a,$.ajax({url:"includes/login.php"}).done(function(b){b&&$("#side-bar .login .side-content").html(b),"object"==$.type(globalVar)&&(globalVar.error&&$("#side-bar .login .error").html(globalVar.error),globalVar.success&&$("#side-bar .login .success").html(globalVar.success))})})}function randomInt(min,max){return min=Math.ceil(min),max=Math.floor(max),Math.floor(Math.random()*(max-min))+min}function translator(){}function keypressEvent(e){if(_k.user.type&&!_k.tool.layer.enabled()&&_k.bar.b.power.enabled()){109==e.which?(e.preventDefault(),_k.bar.draw.Marker.toggle()):114==e.which?(e.preventDefault(),_k.bar.draw.Rectangle.toggle()):112==e.which?(e.preventDefault(),_k.bar.draw.Polygon.toggle()):108==e.which&&(e.preventDefault(),_k.bar.draw.Polyline.toggle());var quickAction=function(_e,type){_k.tool.marker.show(!0),$("#marker-tools a").removeClass("enabled"),$('#marker-tools a[type="'+type+'"]').addClass("enabled"),_k.bar.draw.Marker.enable()};115==e.which?(e.preventDefault(),quickAction(e,"Rucksack")):49==e.which?(e.preventDefault(),quickAction(e,"ElectronicsSurvival")):50==e.which?(e.preventDefault(),quickAction(e,"FabricSurvival")):51==e.which?(e.preventDefault(),quickAction(e,"ToolsSurvival")):52==e.which?(e.preventDefault(),quickAction(e,"WeaponPartsSurvival")):53==e.which?(e.preventDefault(),quickAction(e,"Clothing")):101==e.which?(e.preventDefault(),quickAction(e,"Medkit")):97==e.which?(e.preventDefault(),quickAction(e,"Medication")):102==e.which?(e.preventDefault(),quickAction(e,"Food")):100==e.which?(e.preventDefault(),quickAction(e,"Drink")):113==e.which?(e.preventDefault(),quickAction(e,"Gear")):119==e.which?(e.preventDefault(),quickAction(e,"Weapon")):122==e.which?(e.preventDefault(),$('#marker-tools input[value=""]').prop("checked",!0),$("#marker-tools a").removeClass("underground overground")):120==e.which?(e.preventDefault(),$('#marker-tools input[value="underground"]').prop("checked",!0),$("#marker-tools a").removeClass("underground overground").addClass("underground")):99==e.which&&(e.preventDefault(),$('#marker-tools input[value="overground"]').prop("checked",!0),$("#marker-tools a").removeClass("underground overground").addClass("overground"))}}function drawEventCreated(e){var layer=e.layer,type=e.layerType,val="",popup=!1,copy=Cookies.get("copy")||{},obj,obj;if("marker"==type)if(_k.tool.marker.enabled()&&$("#marker-tools a.enabled").length){var lvl=$("input[name='radio']:checked").val(),typ=$("#marker-tools a.enabled").attr("type"),j=_k.tool.marker.layers[_k.mode.get][typ],p=j.properties;lvl=lvl?" "+lvl:"",layer=createMarker($.extend({},p,p.icon.options,{id:ID(),latlng:layer._latlng,className:p.icon.options.className+lvl})),popup=j.popup}else icon="object"==$.type(mark=copy.marker)?mark:_k.map.defaults.marker,layer=createMarker($.extend({},icon,{id:ID(),latlng:layer._latlng}));if(("polygon"==type||"rectangle"==type)&&((obj=copy.polygon||_k.map.defaults.polygon)&&"object"==$.type(obj))){var ll=layer._latlngs[0].removeDupes();$.extend(obj,{id:ID(),pane:"poly-hover"==obj.className?"zonePane":"overlayPane",mode:obj.mode||_k.mode.get}),layer="rectangle"==type?L.rectangle(ll,obj):L.polygon(ll,obj)}"polyline"==type&&((obj=copy.polyline||_k.map.defaults.polyline)&&"object"==$.type(obj)&&(layer=L.polyline(layer._latlngs.removeDupes(),$.extend(obj,{id:ID(),mode:obj.mode||_k.mode.get}))));o=popup||copy[type+"Popup"]||{},(o.content||o.options&&o.options.list&&o.options.list.title)&&layer.bindPopup(o.content,$.extend(!0,{},o.options)),layer.options.creator=_k.user.name,layer.options.group=layer.options.group||"group08",_k.group.mode[layer.options.group].addLayer(layer),layer.on("click",_k.tool.layer.show),layer.editing.saved=!1,_k.save.add(layer),switchLayerGroups(),polyHoverAnimation()}function setCollectionData(){$("#side-bar .img-check").removeClass("checked"),$.ajax({type:"POST",url:"includes/collection_data_get.php"}).done(function(a){if(Cookies.json=!0,setData=!!a.bMatch(/(\{|\[])".*(\}|\])/)&&$.parseJSON(a),!setData){var setData1=Cookies.getJSON("setData1"),setData2=Cookies.getJSON("setData2");"object"===$.type(setData1)&&"object"===$.type(setData2)&&(setData=$.extend({},setData1,setData2))}setData&&$.each(setData,function(index,val){val&&$('#side-bar .img-check[name="'+index+'"]').addClass("checked")}),updateSetCounter()})}function updateSetCounter(){$(".set-piece").each(function(index,el){var count=$(this).find(".img-check.checked").length;$(this).find(".counter").html(count||""),$(this).find(".set-bonus").removeClass("active");for(var i=count;i>0;i--)$(this).find(".set-bonus."+i).addClass("active")});var checks="#side-bar .img-check",total,got,left=$(checks).length-$(checks+".checked").length,counters=$("#side-bar .counter"),totalSets=counters.length,sets=0,m;counters.each(function(index,el){6==$(this).text()&&sets++});var setData={};if($(checks).each(function(index,el){setData[$(this).attr("name")]=$(this).hasClass("checked")}),$("#side-bar .warning").html(""),_k.user.type)$.ajax({type:"POST",url:"includes/collection_data_set.php",data:{setData:JSON.stringify(setData)}}).done(function(a){Cookies.remove("setData")});else{$("#side-bar .warning").html("This data is stored as a cookie, if you would            like it to be persistant, please create an account or sign in.");for(var setData1={},setData2=setData;Object.keys(setData1).length<Object.keys(setData2).length;){var key=Object.keys(setData2)[0];setData1[key]=setData2[key],delete setData2[key]}Cookies.set("setData1",setData1),Cookies.set("setData2",setData2)}translator()}function empty(obj){"boolean"!=$.type(obj)&&(obj.remove(),obj=!1)}function removeEmpty(obj){var typ="array"==$.type(obj);return $.each(obj,function(i,v){$.bInArray($.type(v),["object","array"])&&(obj[i]=removeEmpty(v));var t=$.type(v);("string"==t&&!v||"object"==t&&!Object.keys(v).length||"array"==t&&!v.length||"function"==t)&&(typ?obj.splice(i,1):delete obj[i])}),obj}function sortObjByKeys(object){var keys=Object.keys(object),rObj={};return keys.sort(naturalCompare),$.each(keys,function(i,v){rObj[v]=object[v]}),rObj}function addToFeatureGroups(layer){var m=layer.options.mode,g=layer.options.group;$.each(_k.modes.get,function(i,mode){(m.bIndexOf(mode)||"all"==m)&&_k.group.feature[mode][g].addLayer(layer)})}function polyHoverAnimation(stop){var polys=$('path.leaflet-interactive:not(.poly-hover):not([fill="none"])');polys.off("mouseover mouseout"),stop||polys.on("mouseover",function(){var _this=$(this),cls=_this.attr("class").split(" ");$.each(cls,function(i,c){c.bIndexOf("phg")&&(_this=$("path."+c))}),_this.addClass("hover")}).on("mouseout",function(){var _this=$(this),cls=_this.attr("class").split(" ");$.each(cls,function(i,c){c.bIndexOf("phg")&&(_this=$("path."+c))}),_this.removeClass("hover")})}function editIconMessage(){var editIcon=$(".leaflet-editing-icon"),elMessage=$("#message"),elWarning;elMessage.children(".message").length||elMessage.append('<div class="message"></div>'),elWarning=elMessage.children(".message"),editIcon.length>1e3&&elWarning.text("There are "+editIcon.length+" editing icons, \t\tyou may want to switch groups to speed things up!"),elWarning.text(""),_k.check.editing&&setTimeout(editIconMessage,2e3)}function setGridRotate(reset){var grid=$(".leaflet-overlay-pane").children().last();if("images/grid.svg"==grid.attr("src")){var gridM=grid.css("transform").split(",");_k.grid.x=!_k.grid.x||reset?gridM[4]:_k.grid.x,_k.grid.y=!_k.grid.y||reset?gridM[5].replace(")",""):_k.grid.y,_k.grid.r=Cookies.get("grid-rotate")||0;var gridXAlt=Cookies.get("grid-x-pos")||0,gridYAlt=Cookies.get("grid-y-pos")||0;Number(_k.grid.x),Number(_k.grid.y),Number(_k.grid.r),Number(gridXAlt),Number(gridYAlt);var css="translate3d("+_k.grid.x*(gridXAlt/1e5+1)+"px, "+_k.grid.y*(gridYAlt/1e5+1)+"px, 0px) rotate("+_k.grid.r+"deg)";grid.css({transformOrigin:"center",transform:css})}}function togglehideAll(){$("#side-bar .side-bar-button:not(.inactive)").length?$("#side-bar .hide-all").removeClass("hidden").html("Hide All"):$("#side-bar .hide-all").addClass("hidden").html("Show All")}function createMarker(p){return cn=p.className||"",p.html=p.iconUrl?"":p.html,L.marker(p.latlng,{icon:L.divIcon({iconUrl:p.iconUrl||"",iconSize:p.iconSize||"",html:p.html||(cn.bIndexOf("anim-icon")?"<img class='halo' src='images/_a.svg'>":"")+"<img src='"+(p.iconUrl||"")+"' class='icon'>",className:cn.filter()}),creator:p.creator,id:p.id,opacity:p.opacity||"",group:p.group||"",type:p.type||getType(p.iconUrl,p.group,p.iconUrl?"marker":"html"),shape:p.shape||"marker",riseOnHover:!0,zIndexOffset:$.bInArray(p.type,_k.map.zIndex)?1e3:0,mode:p.mode||getMode(p.type)})}function showhideAllLayers(show){$.each(_k.map.type[_k.mode.get],function(t,a){$.each(a,function(n,i){var btn=$('[set="'+t+'"][label="'+n+'"]');btn.removeClass("inactive"),show&&btn.addClass("inactive");var filters=Cookies.get("filters")||{};filters[n]=show,Cookies.set("filters",filters),showHideLayers(t,n,show)})})}function showHideLayers(s,t,h){var g,show,hide;switchLayerGroups(!0),$.each(_k.map.group,function(grp,a){$.bInArray(t,a)&&(g=_k.group.mode[grp],show=h?_k.group.mode.groupHidden:g,hide=h?g:_k.group.mode.groupHidden,show&&hide&&hide.eachLayer(function(l){var i=l._leaflet_id;l.options.type==t&&l.options.shape==s&&(show.addLayer(hide.getLayer(i)),hide.removeLayer(i))}))}),switchLayerGroups(),polyHoverAnimation()}function toCorrectType(n,v){var t=_k.map.settings.types[n];return"number"==t?Number(v):"boolean"==t?!!v:v}function addSet(i,v,n){"array"==$.type(v)&&(v=v.join(",")),v&&!$.bInArray(v,i)&&i.push(v)}function offset(latlng,oLat,oLng){return oLat&&(latlng.lat+=oLat),oLng&&(latlng.lng+=oLng),latlng}function textColor(hex){var hex=hex.substring(1),rgb=parseInt(hex,16),r,g,b,luma;return.2126*(rgb>>16&255)+.7152*(rgb>>8&255)+.0722*(rgb>>0&255)<40?"#ffffff":"#000000"}function removeLayer(layer,group,del){var grp=group||layer.options.group,id=layer._leaflet_id;del&&_k.save.delete(layer),_k.group.draw.removeLayer(id),$.each(_k.modes.get,function(i,mode){_k.group.feature[mode][grp].removeLayer(id)})}function createPoint(e,f){return $.isArray(e)?L.point(e[0],e[1]):L.point(e,f)}function switchLayerGroups(d){$.ajax({url:"includes/check_login.php"}).done(function(a){a=$.parseJSON(a),_k.user.name=a.username||!1,_k.user.type=a.usertype||0,$.each(_k.group.draw._layers,function(i,l){l.editing.currentGroup=l.options.group,_k.group.mode[l.options.group].addLayer(_k.group.draw.getLayer(i)),_k.group.draw.removeLayer(i)}),!d&&$.each(_k.group.mode,function(j,g){g.eachLayer(function(l){(_k.map.active[l.options.type]&&(l.options.creator==_k.user.name||_k.user.type>3)||l.editing.edit)&&(l.editing.currentGroup="drawLayer",_k.group.draw.addLayer(_k.group.mode[l.options.group].getLayer(l._leaflet_id)),_k.group.mode[l.options.group].removeLayer(l._leaflet_id))})}),_k.myMap.removeLayer(_k.group.draw).addLayer(_k.group.draw).addLayer(_k.group.mode.groupAll),onZoomEnd(!0)})}function createGeoJSON(){$("#settings-menu").remove(),_k.backup=_k.user.name,$.ajax({url:"includes/check_login.php"}).done(function(a){if(a=$.parseJSON(a),_k.user.name=a.username||!1,_k.user.type=a.usertype||0,_k.backup==_k.user.name){_k.msg.show({msg:"SAVING...",dots:!0});var feature,geoData={features:{},deleted:_k.save.deleted};switchLayerGroups(!0),_k.save.unsaved.eachLayer(function(v){if("_latlng"in v){feature={properties:{icon:{options:{}}},geometry:{type:"Point",coordinates:v._latlng}};var iO=v.options.icon.options;"array"===$.type(iO.html)&&(iO.html=iO.html.join("")),$.each(v.options,function(k,z){feature.properties[k]=fix(z)}),$.each(feature.properties,function(i,v){!$.bInArray(i,_k.map.property.marker)&&delete feature.properties[i],!v&&delete feature.properties[i]}),iO.iconUrl&&delete feature.properties.icon.options.html,$.each(feature.properties.icon.options,function(i,v){!v&&delete feature.properties[i]}),delete feature.properties.icon._initHooksCalled}else"_latlngs"in v&&"lat"in v._latlngs[0]?(feature={properties:{},geometry:{type:"Polyline",coordinates:v._latlngs}},$.each(v.options,function(k,z){feature.properties[k]=fix(z)}),$.each(feature.properties,function(i,v){!$.bInArray(i,_k.map.property.polyline)&&delete feature.properties[i],!v&&delete feature.properties[i]})):"_latlngs"in v&&(feature={properties:{},geometry:{type:polyType(v._latlngs),coordinates:v._latlngs}},$.each(v.options,function(k,z){feature.properties[k]=fix(z)}),$.each(feature.properties,function(i,v){!$.bInArray(i,_k.map.property.polygon)&&delete feature.properties[i],!v&&delete feature.properties[i]}));"_popup"in v&&v._popup._content&&(feature.popup={content:v._popup._content,options:{className:v._popup.options.className,list:v._popup.options.list}},$.each(_k.popupContent,function(k,s){v._popup._content==s&&(feature.popup.content=k)}),feature.popup.options.list.title&&delete feature.popup.content),feature.properties.mode=v.options.mode||getMode(v.options.type),feature.properties.id=v.options.id||ID(),geoData.features[feature.properties.id]=feature}),$.ajax({type:"POST",url:"includes/write.php",data:{data:JSON.stringify(geoData)}}).done(function(a){a=a.bMatch(/^(\{|\[])".*(\}|\])$/)?$.parseJSON(a):a,"object"==$.type(a)&&a.message?alert(a.message):(_k.bar.b.save.disable(),_k.save.unsaved.clearLayers(),_k.save.deleted=[],polyHoverAnimation(),_k.msg.hide(),pageLoad())})}else alert("I'm sorry but your account information is incorrect, you cannot save your changes! Please log in and try again!")})}function toggleFullScreen(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function fix(s){return Number(s)?Number(s):s}function polyType(l){return 1==l.length&&4==l[0].length&&l[0][0].lat==l[0][3].lat&&l[0][0].lng==l[0][1].lng?"Rectangle":l[0].lat?"Polyline":"Polygon"}function getType(o,g,a){if(!$.bInArray(a,["marker","polyline","polygon"]))return"";var type="";return o=o.replace("images/",""),$.each(_k.map.type,function(h,tg){$.each(tg[a],function(i,v){$.bInArray(o,v)&&(type=i)})}),type}function getMode(type){return fMode="all",$.each(_k.map.mode,function(mode,array){$.bInArray(type,array)&&(fMode=mode)}),fMode}function onZoomEnd(){setGridRotate(!0),zoom=_k.myMap.getZoom(),$.each(_k.group.mode,function(g,n){var a=g.replace("group","");"number"==typeof(a=a.bIndexOf("_")?a.split("_"):a.bMatch(/\d+/)?Number(a):!a.bIndexOf("Hidden")&&0)&&zoom>=a||"object"==typeof a&&zoom>=a[0]&&zoom<=a[1]?("groupDZ"==g&&_k.myMap.removeLayer(_k.group.mode[g]),_k.myMap.addLayer(_k.group.mode[g])):_k.myMap.removeLayer(_k.group.mode[g])})}function urlExists(url,callback){$.ajax({type:"HEAD",url:url,success:function(){callback(!0)},error:function(){callback(!1)}})}function setSelectionRange(input,selectionStart,selectionEnd){if(input.setSelectionRange)input.focus(),input.setSelectionRange(selectionStart,selectionEnd);else if(input.createTextRange){var range=input.createTextRange();range.collapse(!0),range.moveEnd("character",selectionEnd),range.moveStart("character",selectionStart),range.select()}}function setCaretToPos(input,posA,posB){setSelectionRange(input,posA,posB||posA)}_k.modes.create(),$.each(_k.group.feature,function(i,m){$.each(_k.map.group,function(g,a){m[g]=new L.FeatureGroup})}),_k.myMap.createPane("messagePane",L.DomUtil.get("message")),_k.myMap.createPane("mapPane"),_k.myMap.createPane("zonePane"),_k.group.mode=_k.group.feature[_k.mode.get],_k.tool.marker={full:!1,fill:function(){var _this=_k.tool.marker;!_this.full&&$.each(_k.modes.get,function(i,mode){_this.layers[mode]={}}),_this.full=!0},layers:{},enabled:function(){var el;return!!$("#marker-tools").length},show:function(){var skip="boolean"==$.type(arguments[0])&&arguments[0];_k.tool.marker._show.call(_k.tool.marker,skip)},_show:function(skip){if(this.enabled()){if(skip)return;$("#marker-tools").remove()}else{$("body").append('<div id="marker-tools"></div>'),tools=$("#marker-tools"),tools.append('<div class="outer inputs">\t\t\t<div>\t\t\t<input id="_1" type="radio" name="radio" value="" checked><label for="_1">Z - Ground</label></br>\t\t\t<input id="_2" type="radio" name="radio" value="underground"><label for="_2">X - Subway</label></br>\t\t\t<input id="_3" type="radio" name="radio" value="overground"><label for="_3">C - Roof</label></br>\t\t\t</div>\t\t\t</div>\t\t\t<div class="outer icons"></div>'),tools.draggable({containment:"#mapid",start:function(){$(this).css({transform:"translateX(0)",bottom:"initial"})},stop:function(){this.position=$.extend({},$(this).position(),{transform:"translateX(0)",bottom:"initial",width:$(this).width(),height:$(this).height()}),Cookies.set("toolPos",this.position)}}).resizable({containment:"#mapid",minHeight:92,minWidth:250,resize:function(){iconSize.call($(".outer.icons"))},stop:function(){this.position=$.extend({},$(this).position(),{transform:"translateX(0)",bottom:"initial",width:$(this).width(),height:$(this).height()}),Cookies.set("toolPos",this.position)}}),this.position=Cookies.get("toolPos")||!1,this.position&&tools.css(this.position);var iconSize=function(){var n=$("a",this).length,a=$(this).width(),b=$(this).height(),i,x,y,m,k,o,oX,oY,w,oK,oM;for(i=1;i<n+1&&(x=a/(m=Math.round(i)),y=b/(k=Math.ceil(n/i)),!(Math.abs(x-y)>o));i++)oX=x,oY=y,oK=k,oM=m,o=Math.abs(x-y);for(w=Math.min(oX,oY)-16,$("a",this).width(w).height(w),$("div.spacer").remove(),i=0;i<oK*oM-n;i++)$('<div class="spacer" />').width(w+16).height(0).appendTo(this)};$('input[name="radio"]').on("change",function(){$("a",tools).removeClass("underground overground").addClass($(this).val())});var layers=this.layers[_k.mode.get];layers=sortObjByKeys(layers),$.each(layers,function(i,e){var p=e.properties,active=p.type==(Cookies.get("markerToolIcon")||"Contaminated")?"enabled":"",key=!1;$.each(_k.shortcuts.QuickMarker,function(k,t){p.type.space()!=t||"Underground"==p.type||(key=k)}),(p.mode.bIndexOf(_k.mode.get)||"all"==p.mode)&&(icn=$("<a />",{class:active,title:p.type.replace("Survival","").space(),type:p.type,html:'<img src="'+p.icon.options.iconUrl+'">'+(key?'<span class="key">'+key+"</span>":"")}).appendTo(".outer.icons"))}),$("#marker-tools a").on("mousedown",function(){var lvl=$("input[name='radio']:checked").val();typ=$(this).attr("type"),$(this).siblings("a").removeClass("enabled"),$(this).addClass("enabled"),Cookies.set("markerToolIcon",typ),_k.bar.draw.Marker.enable()}),iconSize.call($(".outer.icons")),$(window).off("resize").on("resize",function(){iconSize.call($(".outer.icons"))}),$('.outer.icons [title!=""]').qtip({position:{viewport:$("#mapid"),my:"top center",at:"bottom center"},style:{classes:"tooltip-style"},show:{delay:250,solo:!0},hide:{event:"click mouseleave"}})}}},_k.tool.layer={type:"",id:0,icon:{},new:{},group:"",pop:{},mark:{},join:!1,enabled:function(){var el;return!!$("#settings-menu").length},show:function(){_k.tool.layer._show.call(_k.tool.layer,this)},_show:function(mark){var _this=this;if(!_k.check.deleting&&!_k.check.editing&&_k.bar.b.power.enabled()){if(!this.tags){this.tags=[];var layers={};$.each(_k.tool.marker.layers,function(i,mode){$.extend(layers,mode)}),layers=sortObjByKeys(layers),$.each(layers,function(v,i){_this.tags.push(v.space())})}if(this._hide(),this.mark=mark,this.type=mark.options.shape,this.id=mark._leaflet_id,"saved"in mark.editing||(mark.editing.saved=!0),"options"in mark||(mark.options={}),"marker"==this.type&&("icon"in mark.options||(mark.options.icon={}),"options"in mark.options.icon||(mark.options.icon.options={}),this.icon=mark.options.icon.options),"_popup"in mark||(mark._popup={}),"_content"in mark._popup||(mark._popup._content=""),"options"in mark._popup||(mark._popup.options={}),"list"in mark._popup.options||(mark._popup.options.list={}),this.group=mark.options.group,this.pop=mark.getPopup(),this._backup(),this.join){if(this.join._latlngs.push(mark._latlngs[0]),this.new=L.polygon(this.join._latlngs,$.extend({},this.join.options,{pane:"poly-hover"==this.join.options.className?"zonePane":"overlayPane"})),this.pop=this.join._popup,this.pop._content||this.pop.options.list.title){var o=this.pop;this.new.bindPopup(o._content,{className:o.options.className,list:o.options.list||{}})}return removeLayer(this.join),removeLayer(mark,this.group,!0),_k.group.mode[this.new.options.group].addLayer(this.new),this.new.on("click",_k.tool.layer.show),this.new.editing.saved=!1,_k.save.add(this.new),this.join=!1,void _k.msg.hide()}if($.each(_k.map.settings.counts,function(a,v){"array"==$.type(v)?($.unique(v),v.sort()):"object"==$.type(v)&&$.each(v,function(b,w){$.unique(w),w.sort()})}),$(mark[$.bInArray(mark.options.shape,["polygon","polyline"])?"_path":"_icon"]).addClass("leaflet-layer-editing"),$("body").append('<div id="settings-menu" class="settings-divider"><div class="settings-side left"></div><div class="settings-side right"></div></div>'),$("#settings-menu").on("remove",function(){$(".leaflet-layer-editing").removeClass("leaflet-layer-editing")}).draggable({containment:"#mapid",start:function(){$(this).css({transform:"translate(0, 0)"})},stop:function(){this.position=$.extend({},$(this).position(),{transform:"translate(0, 0)"}),Cookies.set("menuPos",this.position)}}),this.position=Cookies.get("menuPos")||!1,this.position){var w=$(window).width()-300,h=$(window).height()-515;this.position.left=w<this.position.left?w:this.position.left,this.position.top=h<this.position.top?h:this.position.top,$("#settings-menu").css(this.position)}$(".settings-side.left").append('<div class="settings-tools marker">\t\t\t<span class="settings-title">'+mark.options.shape.toUpperCase()+'</span>\t\t\t</div>\t\t\t<div class="settings-tools popup">\t\t\t<span class="settings-title">POPUP</span>\t\t\t</div>\t\t\t<div class="settings-tools buttons"></div>\t\t\t<div class="settings-tools save">\t\t\t<a class="settings-save" aria-label="save">CONFIRM</a>\t\t\t<a class="settings-cancel" aria-label="cancel">CANCEL</a>\t\t\t</div>\t\t\t<div class="creator">'+mark.options.creator+'</div>\t\t\t<div class="unsaved" '+(mark.editing.saved?'style="display: none"':"")+">Save me!</div>");var btn=$('<a class="settings icon" />'),box=".settings-tools.buttons",btns=[{cls:"copy",title:"Copy these settings"},{cls:"paste",title:"Paste copied settings",type:["polygon","polyline"]},{cls:"edit"+(mark.editing.edit?" end":""),title:"Add this to editable layer"},{cls:"move"+(mark.dragging.enabled()?" end":""),title:"Drag this layer"},{cls:"join",title:"Make another polygon a hole in this",type:["polygon"]},{cls:"split",title:"Split these polygons",type:["polygon"]},{cls:"dupe",title:"Duplicate this poly",type:["polygon"]},{cls:"delete",title:"Delete this layer"}];for(i in btns)b=btns[i],!b.cls||b.type&&!$.bInArray(this.type,b.type)||btn.clone().attr({"aria-label":b.cls,title:b.title}).addClass(b.cls).appendTo(box);mark.backup&&mark.backup.changes&&$(".settings-save").css("background-color","#735711"),$.each(_k.map.settings[this.type],function(i,n){$("<a />",{class:"dnt settings-item "+n,"aria-label":n,html:n.firstToUpper()}).appendTo(".settings-tools.marker")}),$.each(_k.map.settings.popup,function(i,n){$("<a />",{class:"dnt settings-item "+n,"aria-label":"popup-"+n,html:n.firstToUpper()}).appendTo(".settings-tools.popup")}),$(".settings-item").on("mousedown",this._settingClick).on("mouseover",this._settingOver).on("mouseleave",this._settingLeave),$(".settings-save").on("click",function(){_this._save.call(_this)}),$(".settings-cancel").on("click",function(){_this._cancel.call(_this)}),$(".settings.copy").on("click",function(){_this._copy.call(_this)}),$(".settings.paste").on("click",function(){_this._paste.call(_this)}).on("mouseover",function(){_this._pasteOver.call(_this,mark)}).on("mouseout",function(){_this._pasteOut.call(_this,mark)}),$(".settings.delete").on("click",function(){_this._delete.call(_this)}),$(".settings.dupe").on("click",function(){_this._dupe.call(_this)}),$(".settings.join").on("click",function(){_this._join.call(_this)}),$(".settings.move").on("click",this._move),$(".settings.edit").on("click",this._edit),"_latlngs"in mark&&1==mark._latlngs.length?$(".settings.split").hide():$(".settings.split").on("click",function(){_this._split.call(_this)}),mark.editing.window&&$('[aria-label="'+mark.editing.window+'"]').trigger("mousedown"),$('.settings.icon[title!=""]').qtip({position:{viewport:$("#mapid"),my:"bottom left",at:"top center"},style:{classes:"tooltip-style"},show:{delay:250,solo:!0},hide:{event:"click mouseleave"}});var div=L.DomUtil.get("settings-menu");L.DomEvent.disableClickPropagation(div),L.DomEvent.on(div,"mousewheel",L.DomEvent.stopPropagation)}},_backup:function(){var backup=function(obj){var rObj={},i=0;for(key in obj)"object"===$.type(obj[key])?rObj[key]=backup(obj[key]):"function"===$.type(obj[key])||key.bMatch(/^_/)||(rObj[key]=obj[key]);return rObj},mark=this.mark,t=mark.backup?"paste":"backup";mark[t]={},mark[t].options=backup(mark.options),this.pop&&(mark[t].popup={},mark[t].popup._content=this.pop._content,this.pop.options&&(mark[t].popup.options=backup(this.pop.options))),"backup"==t&&($.bInArray(this.type,["polygon","polyline"])?mark.backup.pos={latlngs:L.LatLngUtil.cloneLatLngs(mark.getLatLngs())}:"marker"==this.type&&(mark.backup.pos={latlng:L.LatLngUtil.cloneLatLng(mark.getLatLng())}))},_settingClick:function(){var fn=_k.tool.layer,mark=fn.mark,n=$(this).attr("aria-label"),pop=n.bMatch("popup-"),set=pop?_k.map.settings.counts.popup:_k.map.settings.counts;mark.editing.window=n,n=n.replace("popup-","");var val=mark.options[n];if(pop?val="content"==n?fn.pop._content:fn.pop.options[n]:"marker"==fn.type&&$.bInArray(n,["className","iconUrl","iconSize","html"])&&(val=fn.icon[n]),$(".settings-side.right").html('<div class="settings-tools right-bar" aria-label="'+n+'">\t\t\t<span class="settings-title">'+(pop?"POPUP ":"")+n.space().toUpperCase()+"</span>\t\t\t</div>"),$.bInArray(n,["id"])||($(".right .settings-title").after('<a class="settings icon copy inline" title="Copy this setting" setting="'+n+'" which="'+(pop?"popup":"icon")+'"></a>'),$(".right .settings-title").after('<a class="settings icon paste inline" title="Paste this setting" setting="'+n+'" which="'+(pop?"popup":"icon")+'"></a>'),$(".settings.copy.inline").on("click",fn._copySingle),$(".settings.paste.inline").on("click",fn._pasteSingle)),n in set){$(".settings-tools.right-bar").append('<input type="text" class="settings-item input '+n+'" name="'+n+'" role="input" value="'+(val||"")+'" setting="'+n+'" which="'+(pop?"popup":"icon")+'">');var img,col,num=1,retHtml='<div class="scroll-box">',colors=[];$.each(set[n],function(z,i){if(img="string"==$.type(i)&&i.bIndexOf(".svg"),col="string"==$.type(i)&&i.bIndexOf("#"))return colors.push(i),!0;var fst='<div class="settings-icons">',lst="</div>",trd=lst+fst;retHtml+=(img&&1==num?fst:"")+'<a \t\t\t\tclass="settings-item selector'+(col?" color":img?" icon":"")+'" \t\t\t\taria-label="'+i+'" \t\t\t\trole="button"'+(val==i?' style="background-color: #2f474e; '+(col?" color: "+i+";":"")+'"':col?' style="color: '+i+';"':"")+">"+(img?'<img src="'+i+'" height="30" width="30">':i)+"</a>"+(img&&num==set[n].length?lst:img&&num%3==0?trd:""),num++}),retHtml=$(retHtml+"</div>"),img&&retHtml.addClass("has-icons"),$(".settings-tools.right-bar").append(retHtml),$.unique(colors),colors.sort(),col&&new Huebee($(".settings-item.input")[0],{notation:"hex",hues:16,shades:8,saturations:5,customColors:colors,staticOpen:!0}).on("change",function(){$(".settings-item.input").trigger("click")})}else if("list"===n){"object"!=$.type(val)&&(fn.pop.options[n]={},val={}),$(".settings-tools.right-bar").append('<span class="help">This is an alternative to content, with this it will automatically arrange the content to display correctly in the html tags with images included. Filling this out will remove whatever is in content.</span>\t\t\t\t<div class="scroll-box">\t\t\t\t<div class="section title">\t\t\t\t<span>TITLE</span><br>\t\t\t\t<input type="text" class="settings-item input list" name="list-title" role="input" value="'+(val.title?val.title:"")+'" setting="list-title" which="popup" placeholder="Title">\t\t\t\t</div>\t\t\t\t<div class="section subs">\t\t\t\t<a class="add subs" title="Add another paragraph">+</a><span>PARAGRAPH</span><br>\t\t\t\t</div>\t\t\t\t<div class="section list">\t\t\t\t<a class="add list" title="Add another item">+</a><span>LIST</span><br>\t\t\t\t</div>\t\t\t\t</div>'),val.subs||(val.subs=[""]);var input=$("<input />",{type:"text",class:"settings-item input list",which:"popup"});$.each(val.subs,function(i,itm){input.clone().attr({name:"list-sub",value:itm,num:i,placeholder:"Paragraph"}).appendTo(".section.subs"),$("<br>").appendTo(".section.subs")}),val.list||(val.list=[{item:"",qty:""}]),$.each(val.list,function(i,itm){input.clone().attr({name:"list-item",value:itm.item,num:i,placeholder:"Item"}).autocomplete({source:fn.tags,autoFocus:!0,appendTo:"#settings-menu"}).appendTo(".section.list"),input.clone().attr({type:"number",min:1,name:"list-qty",value:itm.qty||1,num:i,placeholder:"Qty"}).appendTo(".section.list"),$("<br>").appendTo(".section.list")}),$("a.add").on("click",function(){var focus=!1,name;if($(this).hasClass("subs"))name='input[name="list-sub"]',input.clone().attr({name:"list-sub",setting:"list-sub",num:$(name).length,placeholder:"Paragraph"}).appendTo(".section.subs"),$("<br>").appendTo(".section.subs");else{name='input[name="list-item"]';var i=$(name).length;input.clone().attr({name:"list-item",setting:"list-item",num:i,placeholder:"Item"}).autocomplete({source:fn.tags,autoFocus:!0,appendTo:"#settings-menu"}).appendTo(".section.list"),input.clone().attr({type:"number",min:1,name:"list-qty",setting:"list-qty",num:i,placeholder:"Qty"}).appendTo(".section.list"),$("<br>").appendTo(".section.list")}$(name).each(function(i,el){$(el).val()||focus||($(el).focus(),focus=!0)}),inputRenew()})}else $(".settings-tools.right-bar").append('<textarea rows=2 cols=20 wrap="hard" class="settings-item input '+n+'" name="'+n+'" setting="'+n+'" which="'+(pop?"popup":"icon")+'">'+(val||"")+"</textarea>");$(".settings-item.selector").on("click",function(){if($(this).hasClass("color")){var hex=$(this).attr("aria-label");$(".settings-item.input").css({"background-color":hex,color:textColor(hex)})}$(".settings-side.right a:not(.settings-apply)").css("background-color","#24373d"),$(this).css("background-color","#2f474e"),$(".settings-item.input").val($(this).attr("aria-label")),fn._apply.call($(".settings-item.input"))});var inputRenew=function(){$(".input").each(function(){var el=$(this),binds="propertychange change click keyup input paste focus blur";el.data("oldVal",el.val()),el.unbind(binds),el.bind(binds,function(e){if(el.data("oldVal")!=el.val()){el.data("oldVal",el.val()),fn._apply.call(el);var title=$('input[name="list-title"]');title.removeClass("incorrect"),title.val()||title.addClass("incorrect")}}),el.bind("blur",function(e){fn._apply.call(el)})})};inputRenew(),$('.inline.icon[title!=""]').qtip({position:{viewport:$("#mapid"),my:"right center",at:"left center"},style:{classes:"tooltip-style"},show:{delay:250,solo:!0},hide:{event:"click mouseleave"}})},_settingOver:function(){var fn=_k.tool.layer,mark=fn.mark,al,n=$(this).attr("aria-label"),pop=n.bMatch("popup-"),set=pop?_k.map.settings.counts.popup:_k.map.settings.counts;n=n.replace("popup-","");var val=mark.options[n]||"";pop?val="content"==n?fn.pop._content:fn.pop.options[n]:"marker"==fn.type&&$.bInArray(n,["className","iconUrl","iconSize","html"])&&(val=fn.icon[n]),"object"==$.type(val)&&(val=JSON.stringify(val)),$.bInArray(n,["content","html"])&&(val=safeTags(val)),"string"!=$.type(val)||val||(val=void 0);var cv="current-value";$("."+cv,this).length||null==val||$("<span />",{class:cv}).appendTo(this),$("."+cv,this).html(val).fadeIn(250)},_settingLeave:function(){$(".current-value").fadeOut(500)},_apply:function(){var fn=_k.tool.layer,mark=fn.mark;if(fn._backup(),$(".settings-save").css("background-color","#735711"),$(".unsaved").show(),$(this).hasClass("list")){var list=fn.pop.options.list;list.title=$('.input[name="list-title"]').val(),list.subs=[],$('.input[name="list-sub"]').each(function(i,el){var no=$(el).attr("num"),t=$(el).val();if(!t)return!0;list.subs.push(t)}),list.list=[],$('.input[name="list-item"]').each(function(i,el){var no=$(el).attr("num"),t=$(el).val();if(!t)return!0;list.list.push({item:t,qty:t?$('.input[name="list-qty"][num="'+no+'"]').val()||1:""})}),removeEmpty(fn.pop.options.list),fn.pop._content=mark.convertContent(fn.pop.options)}else{var cs=$(this).attr("setting"),w=$(this).attr("which"),val=$(this).val();if("popup"==w){if("content"==cs)fn.pop._content=val,fn.pop.options.list={};else if(fn.pop.options[cs]=val,"className"==cs){var ocn=mark._popup.oldClassName||mark.backup.popup.options.className;$(mark._popup._container).removeClass(ocn).addClass(val),mark._popup.oldClassName=val}}else if("marker"==fn.type&&$.bInArray(cs,["className","iconUrl","iconSize","html"])){fn.icon[cs]=val.bMatch(/\d+,\d+/)?val.split(","):val;var p=mark.options.icon.options;$(this).is(":focus")||$.ajax({type:"HEAD",url:p.iconUrl,success:function(){mark.setIcon(L.divIcon({iconUrl:p.iconUrl,iconSize:p.iconSize,html:(p.className.bIndexOf("anim-icon")?"<img class='halo' src='images/_a.svg'>":"")+"<img src='"+(p.iconUrl||"")+"' class='icon'>",className:p.className})),mark.editing.saved=!1,mark.backup.changes=!0,_k.save.add(mark),fn._refresh()}})}else mark.options[cs]=val}"marker"!=fn.type&&mark.setStyle(mark.options),"marker"==fn.type&&mark.setOpacity(mark.options.opacity),fn.pop instanceof L.Popup?L.setOptions(fn.pop,fn.pop.options):fn.pop&&fn.pop._content&&mark.bindPopup(fn.pop._content,fn.pop.options),mark.editing.saved=!1,mark.backup.changes=!0,_k.save.add(mark)},_save:function(){var copy=Cookies.get("copy")||{},mark=this.mark;this._hide(),"marker"==this.type?copy.marker=$.extend({},this.icon,$.curtail({},mark.options,["id"])):"polyline"==this.type?copy.polyline=$.curtail({},mark.options,["id"]):"polygon"==this.type&&(copy.polygon=$.curtail({},mark.options,["id"]));var p=this.pop,o=p.options;copy[this.type+"Popup"]={content:!p._content||o&&o.list&&o.list.title?"":p._content,options:{className:o&&o.className?o.className:"",list:o&&o.list?o.list:{}}},Cookies.set("copy",copy),delete mark.backup,mark.options.mode.bIndexOf(_k.mode.get)||"all"==mark.options.mode||_k.group.mode[mark.options.group].removeLayer(mark._leaflet_id)},_cancel:function(){if(this._hide(),mark=this.mark,$.extend(!0,mark.options,mark.backup.options),$.extend(!0,this.pop,mark.backup.popup),"marker"==this.type&&($.extend(!0,mark.options.icon.options,mark.options.icon.options),$.extend(!0,mark.options.icon.options.iconSize,mark.options.icon.options.iconSize)),mark.backup.popup.options&&$.extend(!0,this.pop.options,mark.backup.popup.options),"marker"==this.type){mark.setLatLng(mark.backup.pos.latlng);var p=mark.options.icon.options;mark.setIcon(L.divIcon({iconUrl:p.iconUrl,iconSize:p.iconSize,html:(p.className.bIndexOf("anim-icon")?"<img class='halo' src='images/_a.svg'>":"")+"<img src='"+(p.iconUrl||"")+"' class='icon'>",className:p.className})),mark.setOpacity(mark.options.opacity)}else $.bInArray(this.type,["polyline","polygon"])&&(mark.setLatLngs(mark.backup.pos.latlngs),mark.setStyle(mark.options));mark.editing.saved=!0,delete mark.backup,_k.save.remove(mark)},_copy:function(){var copy=Cookies.get("copy")||{},mark=this.mark;"marker"==this.type?copy.marker=$.extend({},this.icon,$.curtail({},mark.options,["id"])):"polyline"==this.type?copy.polyline=$.curtail({},mark.options,"id"):"polygon"==this.type&&(copy.polygon=$.curtail({},mark.options,"id"));var p=this.pop,o=p.options;copy[this.type+"Popup"]={content:!p._content||o&&o.list&&o.list.title?"":p._content,options:{className:o&&o.className?o.className:"",list:o&&o.list?$.extend(!0,{},o.list):{}}},Cookies.set("copy",copy),_k.msg.show({msg:"Settings copied!",time:2e3})},_copySingle:function(){var copy=Cookies.get("copy")||{},fn=_k.tool.layer,pop="popup"==$(this).attr("which"),set=$(this).attr("setting"),val="list"==set?removeEmpty(fn.pop.options.list):$(".input").val();null==val||null==val||"string"==$.type(val)&&!val||"object"==$.type(val)&&!Object.keys(val).length?_k.msg.show({msg:"Copy failed!",time:2e3}):("options"in copy||(copy.options={popup:{}}),pop?copy.options.popup[set]=val:copy.options[set]=val,Cookies.set("copy",copy),_k.msg.show({msg:"Setting copied!",time:2e3}))},_paste:function(){var mark=this.mark,copy,sets=(Cookies.get("copy")||{})[this.type]||!1;sets?(sets=$.extend({},mark.options,sets,{pane:"poly-hover"==sets.className?"zonePane":"overlayPane"}),this.new="polyline"==this.type?L.polyline(mark._latlngs,sets):"Rectangle"==polyType(mark._latlngs)?L.rectangle(mark._latlngs,sets):L.polygon(mark._latlngs,sets),removeLayer(mark,this.group),_k.group.mode[mark.options.group].addLayer(this.new),this.new.on("click",this.show),this.new.editing.saved=!1,_k.save.add(this.new),switchLayerGroups(),polyHoverAnimation(),_k.msg.show({msg:"Settings pasted!",time:2e3}),this._refresh()):_k.msg.show({msg:"You need to copy something first!",time:2e3})},_pasteSingle:function(){var copy=Cookies.get("copy")||{},fn=_k.tool.layer,pop="popup"==$(this).attr("which"),set=$(this).attr("setting");if("options"in copy&&(!pop||copy.options.popup[set])&&(pop||copy.options[set]))if("list"!=set)$(".input").val(pop?copy.options.popup[set]:copy.options[set]).trigger("blur");else{var list=copy.options.popup.list,input;$("input").val("");for(var j=0;j<2;j++){if(list.subs)for(var i=0;i<list.subs.length;i++)list.subs[i]&&((input=$('[name="list-sub"][num="'+i+'"]')).length||$("a.add.subs").trigger("click"),input.val(list.subs[i]));if(list.list)for(i=0;i<list.list.length;i++)list.list[i].item&&((input=$('[name="list-item"][num="'+i+'"]')).length||$("a.add.list").trigger("click"),input.val(list.list[i].item),$('[name="list-qty"][num="'+i+'"]').val(list.list[i].qty))}$('[name="list-title"]').val(list.title).trigger("blur")}else _k.msg.show({msg:"There is no copied setting!",time:2e3})},_pasteOver:function(mark){this._backup(),mark.setStyle($.extend(mark.options,Cookies.get("copy")&&Cookies.get("copy")[this.type]||{}))},_pasteOut:function(mark){mark.setStyle($.extend(mark.options,mark.paste.options))},_delete:function(){var _this=this;this._hide(),$("<div />",{class:"screen-blank",html:$("<div />",{class:"confirm",html:$("<div />",{class:"message",html:"Are you sure you want to delete this layer?"})})}).appendTo("body"),$("<a />",{class:"button no",title:"Cancel",html:"Cancel"}).appendTo(".confirm").on("click",function(){$(".screen-blank").remove()}),$("<a />",{class:"button yes",title:"Delete",html:"Delete"}).appendTo(".confirm").on("click",function(){_this._trueDelete.call(_this),$(".screen-blank").remove()})},_trueDelete:function(){var mark;removeLayer(this.mark,this.group,!0)},_dupe:function(){this._hide();var mark=this.mark,nSettings=$.extend({},mark.options,{id:ID()}),ll=mark._latlngs,pType=polyType(ll);"Rectangle"!=pType?("Polygon"==pType&&(ll=ll[0]),ll.splice(1,0,L.latLng((ll[0].lat+ll[1].lat)/2,(ll[0].lng+ll[1].lng)/2))):(ll[0][0].lng-=1e-6,ll[0][1].lng-=1e-6),this.new="Polyline"==polyType(mark._latlngs)?L.polyline(mark._latlngs,nSettings):"Rectangle"==polyType(mark._latlngs)?L.rectangle(mark._latlngs,nSettings):L.polygon(mark._latlngs,nSettings),_k.group.mode[mark.options.group].addLayer(this.new),this.new.on("click",this.show),this.new.editing.saved=!1,_k.save.add(this.new),createGeoJSON(),switchLayerGroups(),polyHoverAnimation(),_k.msg.show({msg:"Duplicated",time:2e3})},_join:function(){var mark=this.mark;this.join=mark,mark.off("click").bringToBack(),this._hide(),_k.msg.show({msg:"Select the shape to join!",time:3e3})},_move:function(){var fn,mark=_k.tool.layer.mark;mark.dragging.enabled()?(mark.dragging.disable(),$(this).removeClass("end")):(mark.dragging.enable(),$(this).addClass("end"),mark.on("dragend",function(){this.editing.saved=!1,this.backup.changes=!0,_k.save.add(this)}))},_edit:function(){var fn,mark=_k.tool.layer.mark;mark.editing.edit=!mark.editing.edit,$(this).toggleClass("end"),switchLayerGroups()},_split:function(){this._hide();var mark=this.mark,layer=this.new,show=this.show;$.each(mark._latlngs,function(i,m){sets=$.extend({},mark.options,{id:ID()}),layer="Rectangle"==polyType([m])?L.rectangle([m],sets):L.polygon([m],sets),_k.group.mode[layer.options.group].addLayer(layer),layer.on("click",show),layer.editing.saved=!1,_k.save.add(layer)}),removeLayer(mark,this.group,!0),switchLayerGroups(),polyHoverAnimation()},_hide:function(){$("#settings-menu").remove()},_refresh:function(){_k.tool.layer._show.call(_k.tool.layer,_k.tool.layer.mark)}},$(function(){$.ajax({url:"includes/credits.php"}).done(function(a){_k.credits=a}),_k.tool.marker.fill(),L.imageOverlay("images/map.svg?v=3.8",[[-6.35,-6.35],[6.35,6.35]],{attribution:'<a title="Tom Clancy\'s The Division" href="http://tomclancy-thedivision.ubi.com/">The Division</a>',pane:"mapPane"}).addTo(_k.myMap),_k.myMap.addLayer(_k.group.mode.groupAll).addLayer(_k.group.mode.groupDZ),_k.myMap.on("zoomend moveend",function(e){zoom=e.target._zoom,onZoomEnd(),Cookies.set("zoom",_k.myMap.getZoom()),Cookies.set("pan",_k.myMap.getCenter()),polyHoverAnimation()}),$(".side-menu-toggle.mode").on("click",function(){var $t=$(this);_k.mode.get=$t.hasClass("one")?_k.mode.not("survival","normal"):_k.mode.not("last stand","normal"),Cookies.set("mode",_k.mode.get),_k.group.mode=_k.group.feature[_k.mode.get],!_k.bar.b.power||_k.bar.b.power.enabled()||(_k.check.doOnce=!0),pageLoad()}),$("#side-bar .side-menu-toggle:not(.mode):not(.full)").on("click",function(){var sb=$("#side-bar"),c="active",a=$(this).attr("button"),o=Cookies.get("sideMenu"),setCookies=function(){Cookies.set("sideBar",sb.hasClass(c)),Cookies.set("sideMenu",a)};$(this).hasClass(c)?(sb.removeClass(c+" "+a),setTimeout(function(){sb.children().removeClass(c),setCookies()},1e3)):sb.hasClass(c)?(sb.removeClass(c+" "+o),setTimeout(function(){sb.children().removeClass(c),sb.addClass(c+" "+a),sb.children("."+a).addClass(c),setCookies()},1e3)):(sb.addClass(c+" "+a),sb.children("."+a).addClass(c),setCookies())});var el=$("#side-bar .side-menu-toggle.full");el.on("click",toggleFullScreen),$(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(e){el.toggleClass("yes")}),$.urlParam("overwolf")||Cookies.get("currentUpdate")==_k.currentUpdate||(Cookies.set("sideMenu","changes"),Cookies.set("sideBar",!0),Cookies.set("currentUpdate",_k.currentUpdate)),_k.lng=Cookies.get("lang")||"en",$("#side-bar .login").on("click",".page",function(){var page=$(this).attr("name");$.ajax({url:"includes/"+page+".php"}).done(function(a){a&&$("#side-bar .login .side-content").html(a)})}),$("#side-bar").on("click","#regform .button",doRegister),$("#side-bar").on("keypress","#regform .input",function(e){13==e.which&&doRegister()}),$("#side-bar").on("click","#donate.button",doDonator),$("#side-bar").on("keypress","#donator",function(e){13==e.which&&doDonator()}),$("#side-bar").on("click","#login .button",doLogin),$("#side-bar").on("keypress","#login .input",function(e){13==e.which&&doLogin()}),$("#side-bar").on("click","#reset .button",doReset),$("#side-bar").on("keypress","#reset .input",function(e){13==e.which&&doReset()}),$("#side-bar").on("click","#forgot .button",doForgot),$("#side-bar").on("keypress","#forgot .input",function(e){13==e.which&&doForgot()}),$("form").submit(function(){return!1}),$("#side-bar").on("click","#logout",function(){$.ajax({url:"includes/logout.php"}).done(function(a){_k.user.name=!1,_k.user.type=0,$("#side-bar .login .side-content").html(a),pageLoad()})}),$("#side-bar").on("click","#rem-check",function(){$.ajax({type:"POST",url:"includes/validator.php",data:{checked:$(this).prop("checked")}})}),$(document).mousedown(function(e){var container=$(".settings-divider, .switch-active-group, #slider-box, .group-switch");container.is(e.target)||0!==container.has(e.target).length||$(container).remove()}),$("#side-bar").on("focus",".login .input",function(){$("."+$(this).attr("name")).show(500)}).on("blur",".login .input",function(){$("."+$(this).attr("name")).hide(500)}).on("propertychange change click keyup input paste",".login .input",function(){var el=$(this),ty=el.attr("id"),vl=el.val(),re=!1;"email"==ty||"donator"==ty?re=vl.bMatch(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/):"username"==ty?re=vl.bMatch(/^\w+$/):"password"==ty?re=vl.bMatch(/(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}/):"confirmpwd"==ty&&(re=vl==$("#password").val()),el.addClass("incorrect"),re&&el.removeClass("incorrect")}),$("#side-bar .side-menu-toggle").on("mouseenter touchstart",function(){$(this).css("left","-"+($(this).width()+50)+"px")}).on("mouseleave touchmove click",function(){$(this).css("left","-35px")}),$(".set-piece .img-check").on("click",function(){$(this).toggleClass("checked"),updateSetCounter($(this))}),$(".set-piece .check svg").on("click",function(){$(this).siblings("a").toggleClass("checked"),updateSetCounter($(this))}),$(".set-piece .size").on("click",function(){$(this).toggleClass("min"),$(this).parent().toggleClass("min")}),$(window).bind("beforeunload",function(){if(_k.save.check()){if(navigator.userAgent.toLowerCase().match(/msie|chrome/)){if(window.aysHasPrompted)return;window.aysHasPrompted=!0,window.setTimeout(function(){window.aysHasPrompted=!1},900)}return"are you sure"}}),void 0!==Cookies.get("powered")&&(_k.check.doOnce=!Cookies.get("powered")),"string"==$.type($.urlParam("d"))&&$.ajax({type:"POST",url:"includes/process_donator.php",data:{load:$.urlParam("d")}}).done(function(a){window.location.href=window.location.href.split("?")[0]}),pageLoad()}),Array.prototype.removeDupes||(Array.prototype.removeDupes=function(){var r=[],a=[];return $.each(this,function(i,v){var vs=JSON.stringify(v);$.bInArray(vs,r)||(r.push(vs),a.push(v))}),a}),String.prototype.filter||(String.prototype.filter=function(){var s=this.toString().split(" "),r=[];return s.clean(""),s.length<2?s[0]:($.each(s,function(i,v){$.bInArray(v,r)||r.push(v)}),r.join(" "))}),Array.prototype.clean||(Array.prototype.clean=function(deleteValue){for(var i=0;i<this.length;i++)this[i]==deleteValue&&(this.splice(i,1),i--);return this}),String.prototype.bMatch||(String.prototype.bMatch=function(regExp){var s;return null!==this.toString().match(regExp)}),String.prototype.bIndexOf||(String.prototype.bIndexOf=function(str){var s;return-1!=this.toString().toLowerCase().indexOf(str.toLowerCase())}),String.prototype.space||(String.prototype.space=function(){var s;return this.toString().replace(/([A-Z])/g," $1").trim()}),String.prototype.titleCase||(String.prototype.titleCase=function(){var s;return this.toString().replace(/(?:^|\s)\w/g,function(match){return match.toUpperCase()})}),String.prototype.firstToUpper||(String.prototype.firstToUpper=function(){var s=this.toString();return s.substr(0,1).toUpperCase()+s.substr(1)});var ID=function(){return"_"+Math.random().toString(36).substr(2,9)};function arraysEqual(a,b){if(a===b)return!0;if(null==a||null==b)return!1;if(a.length!=b.length)return!1;a.sort(),b.sort();for(var i=0;i<a.length;++i)if(a[i]!==b[i])return!1;return!0}var tagsToReplace={"&":"&amp;","<":"&lt;",">":"&gt;"};function replaceTag(tag){return tagsToReplace[tag]||tag}function safeTags(str){return str.replace(/[&<>]/g,replaceTag)}function hideAlert(){$("#alert").hide()}function naturalCompare(a,b){var ax=[],bx=[];for(a.replace(/(\d+)|(\D+)/g,function(_,$1,$2){ax.push([$1||1/0,$2||""])}),b.replace(/(\d+)|(\D+)/g,function(_,$1,$2){bx.push([$1||1/0,$2||""])});ax.length&&bx.length;){var an=ax.shift(),bn=bx.shift(),nn=an[0]-bn[0]||an[1].localeCompare(bn[1]);if(nn)return nn}return ax.length-bx.length}
//# sourceMappingURL=div.map.min.js.map
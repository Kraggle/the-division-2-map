import{jQuery as $}from"../jQuery/jquery3.4.1.js";import{K}from"../K.js";import{switchLayerGroups,polyHoverAnimation}from"../functions/misc.js";K.complete={layers:[],add:function(e){let t=!0;K.each(this.layers,function(i,o){e.options.id===o.options.id&&(t=!1)}),t&&!e.options.onComplete&&this.layers.push(e),K.timed.interval||K.timed.action()},remove:function(e){let t=!1;for(let i=0;i<this.layers.length;i++){if(e===this.layers[i].options.id){t=i;break}}"number"===K.type(t)&&this.layers.splice(t,1)},is:function(e){if("string"==K.type(e)&&(e=K.group.getLayer(e)),!e)return!1;if(!e.getSetting("complete"))return!1;let t=K.user.data,i=e.options.id;return t||K.in("complete",K.local())||K.local("complete",{}),t?K.in(i,t):K.in(i,K.local("complete"))},time:function(e){if(!this.is(e))return!1;let t=K.user.data,i=e.options.id,o=t?t[i]:K.local("complete")[i];if("string"===K.type(o)){let t=new Date(o).getTime()-(new Date).getTime(),i=Math.ceil(t%864e5/36e5),r=Math.ceil(t%36e5/6e4);t<0?(this.set(!1,e),o=!1):i?o=i+"h":r&&(o=r+"m")}else o=!1;return o},toggle:function(e){return this.set(!e.complete,e)},set:function(e,t){let i=K.user.data,o=t.options.id,r=t.options.time;i||K.in("complete",localStorage)||K.local("complete",{});let l=i||K.local("complete");return e?(l[o]=!r||(new Date).addHours(r).toString(),this.add(t)):(delete l[o],this.remove(t.options.id)),t.complete=e,!i&&K.local("complete",l),i&&(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{$.ajax({type:"POST",url:"php/write_complete.php",data:{data:JSON.stringify(K.user.data)}}).done(()=>{console.log("saved data!",K.user.data)})},1e3)),t.complete},timeout:!1,showHide:function(){switchLayerGroups(!0);let e,t,i,o,r,l=K.completeHidden,n=K.complete.layers,a=K.group.mode.groupComplete;K.filters=K.local("filters")||{},K.each(n,function(n,s){const p=(r=K.filters[s.options.type])?"groupHidden":s.options.group;e=K.group.mode[p],o=s._leaflet_id,t=l?a:e,(i=l?e:a).getLayer(o)&&(t.addLayer(i.getLayer(o)),i.removeLayer(o),s.currentGroup=l?"groupComplete":p)}),switchLayerGroups(),polyHoverAnimation()}},K.timed={layers:[],interval:!1,add:function(e){let t=!0;K.each(K.timed.layers,function(i,o){e.options.id===o.options.id&&(t=!1)}),t&&K.timed.layers.push(e)},action:function(){K.timed.interval=setInterval(()=>{if(!K.timed.layers.length)return clearInterval(K.timed.interval),void(K.timed.interval=!1);K.each(K.timed.layers,function(e,t){t.markComplete()}),K.complete.showHide()},6e4)},remove:function(e){let t=!1;for(let i=0;i<K.timed.layers.length;i++){if(e===K.timed.layers[i].options.id){t=i;break}}"number"===K.type(t)&&K.timed.layers.splice(t,1)}};
//# sourceMappingURL=complete.js.map
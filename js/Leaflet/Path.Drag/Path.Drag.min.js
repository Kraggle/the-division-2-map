import{L}from"../leaflet1.0.3.js";L.Handler.PathDrag=L.Handler.extend({statics:{DRAGGING_CLS:"leaflet-path-draggable"},initialize:function(t){this._path=t,this._matrix=null,this._startPoint=null,this._dragStartPoint=null,this._mapDraggingWasEnabled=!1},addHooks:function(){this._path.on("mousedown",this._onDragStart,this),this._path.options.className=this._path.options.className?this._path.options.className+" "+L.Handler.PathDrag.DRAGGING_CLS:L.Handler.PathDrag.DRAGGING_CLS,this._path._path&&L.DomUtil.addClass(this._path._path,L.Handler.PathDrag.DRAGGING_CLS)},removeHooks:function(){this._path.off("mousedown",this._onDragStart,this),this._path.options.className=this._path.options.className.replace(new RegExp("\\s+"+L.Handler.PathDrag.DRAGGING_CLS),""),this._path._path&&L.DomUtil.removeClass(this._path._path,L.Handler.PathDrag.DRAGGING_CLS)},moved:function(){return this._path._dragMoved},_onDragStart:function(t){var a=t.originalEvent._simulated?"touchstart":t.originalEvent.type;this._mapDraggingWasEnabled=!1,this._startPoint=t.containerPoint.clone(),this._dragStartPoint=t.containerPoint.clone(),this._matrix=[1,0,0,1,0,0],L.DomEvent.stop(t.originalEvent),L.DomUtil.addClass(this._path._renderer._container,"leaflet-interactive"),L.DomEvent.on(document,L.Draggable.MOVE[a],this._onDrag,this).on(document,L.Draggable.END[a],this._onDragEnd,this),this._path._map.dragging.enabled()&&(this._path._map.dragging.disable(),this._mapDraggingWasEnabled=!0),this._path._dragMoved=!1,this._path._popup&&this._path._popup._content&&this._path._popup._close(),this._replaceCoordGetters(t)},_onDrag:function(t){L.DomEvent.stop(t);var a=t.touches&&t.touches.length>=1?t.touches[0]:t,i=this._path._map.mouseEventToContainerPoint(a);if("touchmove"===t.type&&!this._path._dragMoved&&this._dragStartPoint.distanceTo(i)<=this._path._map.options.tapTolerance)return;var n=i.x,s=i.y,h=n-this._startPoint.x,e=s-this._startPoint.y;(h||e)&&(this._path._dragMoved||(this._path._dragMoved=!0,this._path.fire("dragstart",t),this._path.bringToFront()),this._matrix[4]+=h,this._matrix[5]+=e,this._startPoint.x=n,this._startPoint.y=s,this._path.fire("predrag",t),this._path._transform(this._matrix),this._path.fire("drag",t))},_onDragEnd:function(t){var a=this._path._map.mouseEventToContainerPoint(t),i=this.moved();if(i&&(this._transformPoints(this._matrix),this._path._updatePath(),this._path._project(),this._path._transform(null),L.DomEvent.stop(t)),L.DomEvent.off(document,"mousemove touchmove",this._onDrag,this).off(document,"mouseup touchend",this._onDragEnd,this),this._restoreCoordGetters(),i){this._path.fire("dragend",{distance:Math.sqrt(L.LineUtil._sqDist(this._dragStartPoint,a))});var n=this._path._containsPoint;this._path._containsPoint=L.Util.falseFn,L.Util.requestAnimFrame(function(){L.DomEvent._skipped({type:"click"}),this._path._containsPoint=n},this)}this._matrix=null,this._startPoint=null,this._dragStartPoint=null,this._path._dragMoved=!1,this._mapDraggingWasEnabled&&(i&&L.DomEvent._fakeStop({type:"click"}),this._path._map.dragging.enable())},_transformPoints:function(t,a){var i,n,s,h=this._path,e=L.point(t[4],t[5]),o=h._map.options.crs,r=o.transformation,_=o.scale(h._map.getZoom()),g=o.projection,p=r.untransform(e,_).subtract(r.untransform(L.point(0,0),_)),d=!a;if(h._bounds=new L.LatLngBounds,h._point)a=g.unproject(g.project(h._latlng)._add(p)),d&&(h._latlng=a,h._point._add(e));else if(h._rings||h._parts){var l=h._rings||h._parts,m=h._latlngs;for(a=a||m,L.Util.isArray(m[0])||(m=[m],a=[a]),i=0,n=l.length;i<n;i++){a[i]=a[i]||[];for(var c=0,u=l[i].length;c<u;c++)s=m[i][c],a[i][c]=g.unproject(g.project(s)._add(p)),d&&(h._bounds.extend(m[i][c]),l[i][c]._add(e))}}return a},_replaceCoordGetters:function(){this._path.getLatLng?(this._path.getLatLng_=this._path.getLatLng,this._path.getLatLng=L.Util.bind(function(){return this.dragging._transformPoints(this.dragging._matrix,{})},this._path)):this._path.getLatLngs&&(this._path.getLatLngs_=this._path.getLatLngs,this._path.getLatLngs=L.Util.bind(function(){return this.dragging._transformPoints(this.dragging._matrix,[])},this._path))},_restoreCoordGetters:function(){this._path.getLatLng_?(this._path.getLatLng=this._path.getLatLng_,delete this._path.getLatLng_):this._path.getLatLngs_&&(this._path.getLatLngs=this._path.getLatLngs_,delete this._path.getLatLngs_)}}),L.Handler.PathDrag.makeDraggable=function(t){return t.dragging=new L.Handler.PathDrag(t),t},L.Path.prototype.makeDraggable=function(){return L.Handler.PathDrag.makeDraggable(this)},L.Path.addInitHook(function(){this.dragging=new L.Handler.PathDrag(this),this.options.draggable&&(this.options.interactive=!0,this.once("add",function(){this.dragging.enable()}))});
//# sourceMappingURL=Path.Drag.js.map
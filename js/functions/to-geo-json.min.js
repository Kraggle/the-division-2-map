import{jQuery as $}from"../jQuery/jquery3.4.1.js";import{K}from"../K.js";import{switchLayerGroups,timed}from"./misc.js";import pageLoad from"./page-load.js";const timer=timed();export function createGeoJSON(e=!1){!e&&$("#settings-menu").remove(),K.backup=K.user.name,K.checkLogin(()=>{if(K.backup!=K.user.name)return void alert("I'm sorry but your account information is incorrect, you cannot save your changes! Please log in and try again!");let t;!e&&K.msg.show({msg:"SAVING...",dots:!0}),!e&&switchLayerGroups(!0);const a={features:{},settings:{},deleted:K.save.deleted};if(K.each(K.layer,function(e,t){const s=a.settings;t.changed&&(!s[e]&&(s[e]={}),!K.empty(t.o)&&(s[e].o=t.o),!K.empty(t.p)&&(s[e].p=t.p))}),K.save.unsaved.eachLayer(function(e){const s=e.options,o=s.id,n={},r={},i=s.type;if(K.each(s.mode,function(e,t){K.in("o",t)&&K.empty(t.o)&&delete t.o,K.in("p",t)&&K.empty(t.p)&&delete t.p}),e.removeClass(K.classRemoval),t={c:s.creator},i&&(t.t=i),"circle"==s.shape?t.g={t:"circle",c:K.valuesToString(K.Util.formatLatLngs(e._latlng)),r:K.Util.formatLatLngs(e._mRadius).toString()}:"marker"==s.shape?(t.g={t:"marker",c:K.valuesToString(K.Util.formatLatLngs(e._latlng))},s.iconUrl&&delete s.html,s.className=K.stripClasses(s.className)):t.g={t:s.shape,c:K.valuesToString(K.Util.formatLatLngs(e._latlngs))},K.each(s,function(e,t){if(K.has(e,K.map.property[s.shape])){const a=i&&K.layer[i]?K.layer[i].o[e]:"false",s=K.settings.main;"false"!=a&&K.equals(a,t)||(n[e]=e in s&&"number"==K.type(s[e])?t.toString():t)}}),!K.empty(n)&&(t.o=n),e.popup&&(e.popup.content||e.popup.list&&!K.empty(e.popup.list))){const t=e.popup,a=K.layer[i]?K.layer[i].p:{};t.className!=a.className&&(r.className=t.className),t.list&&t.list.title?!K.equals(a.list,t.list)&&(r.list=t.list):a.content!=t.content&&(r.content=t.content),K.each(K.popupContent,function(e,t){r.content==t&&(r.content=e)})}!K.empty(r)&&(t.p=r),a.features[o]=t}),e)return K.save.data=a,timer.run(()=>{console.log("There are %i unsaved features... %o",K.length(a.features)+K.length(a.deleted),a)},100),a;console.log("Saving features... %o",a),$.ajax({type:"POST",url:"php/write.php",data:{data:JSON.stringify(a)}}).done(function(e){e=e.bMatch(/^(\{|\[])".*(\}|\])$/)?$.parseJSON(e):e,"object"==K.type(e)&&e.message?alert(e.message):(K.save.clear(),K.msg.hide(),pageLoad())})})}
//# sourceMappingURL=to-geo-json.min.js.map
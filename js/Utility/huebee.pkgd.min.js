function EvEmitter(){}var proto=EvEmitter.prototype;function noop(){}function Unipointer(){}proto.on=function(t,e){if(t&&e){var o=this._events=this._events||{},n=o[t]=o[t]||[];return-1==n.indexOf(e)&&n.push(e),this}},proto.once=function(t,e){if(t&&e){this.on(t,e);var o=this._onceEvents=this._onceEvents||{};return(o[t]=o[t]||{})[e]=!0,this}},proto.off=function(t,e){var o=this._events&&this._events[t];if(o&&o.length){var n=o.indexOf(e);return-1!=n&&o.splice(n,1),this}},proto.emitEvent=function(t,e){var o=this._events&&this._events[t];if(o&&o.length){var n=0,i=o[n];e=e||[];for(var s=this._onceEvents&&this._onceEvents[t];i;){var r=s&&s[i];r&&(this.off(t,i),delete s[i]),i.apply(this,e),i=o[n+=r?0:1]}return this}},(proto=Unipointer.prototype=Object.create(EvEmitter.prototype)).bindStartEvent=function(t){this._bindStartEvent(t,!0)},proto.unbindStartEvent=function(t){this._bindStartEvent(t,!1)},proto._bindStartEvent=function(t,e){var o=(e=void 0===e||!!e)?"addEventListener":"removeEventListener";window.navigator.pointerEnabled?t[o]("pointerdown",this):window.navigator.msPointerEnabled?t[o]("MSPointerDown",this):(t[o]("mousedown",this),t[o]("touchstart",this))},proto.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},proto.getTouch=function(t){for(var e=0;e<t.length;e++){var o=t[e];if(o.identifier==this.pointerIdentifier)return o}},proto.onmousedown=function(t){var e=t.button;e&&0!==e&&1!==e||this._pointerDown(t,t)},proto.ontouchstart=function(t){this._pointerDown(t,t.changedTouches[0])},proto.onMSPointerDown=proto.onpointerdown=function(t){this._pointerDown(t,t)},proto._pointerDown=function(t,e){this.isPointerDown||(this.isPointerDown=!0,this.pointerIdentifier=void 0!==e.pointerId?e.pointerId:e.identifier,this.pointerDown(t,e))},proto.pointerDown=function(t,e){this._bindPostStartEvents(t),this.emitEvent("pointerDown",[t,e])};var postStartEvents={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"],MSPointerDown:["MSPointerMove","MSPointerUp","MSPointerCancel"]};function Huebee(t,e){if(!(t=getQueryElement(t)))throw"Bad element for Huebee: "+t;this.anchor=t,this.options={},this.option(Huebee.defaults),this.option(e),this.create()}proto._bindPostStartEvents=function(t){if(t){var e=postStartEvents[t.type];e.forEach(function(t){window.addEventListener(t,this)},this),this._boundPointerEvents=e}},proto._unbindPostStartEvents=function(){this._boundPointerEvents&&(this._boundPointerEvents.forEach(function(t){window.removeEventListener(t,this)},this),delete this._boundPointerEvents)},proto.onmousemove=function(t){this._pointerMove(t,t)},proto.onMSPointerMove=proto.onpointermove=function(t){t.pointerId==this.pointerIdentifier&&this._pointerMove(t,t)},proto.ontouchmove=function(t){var e=this.getTouch(t.changedTouches);e&&this._pointerMove(t,e)},proto._pointerMove=function(t,e){this.pointerMove(t,e)},proto.pointerMove=function(t,e){this.emitEvent("pointerMove",[t,e])},proto.onmouseup=function(t){this._pointerUp(t,t)},proto.onMSPointerUp=proto.onpointerup=function(t){t.pointerId==this.pointerIdentifier&&this._pointerUp(t,t)},proto.ontouchend=function(t){var e=this.getTouch(t.changedTouches);e&&this._pointerUp(t,e)},proto._pointerUp=function(t,e){this._pointerDone(),this.pointerUp(t,e)},proto.pointerUp=function(t,e){this.emitEvent("pointerUp",[t,e])},proto._pointerDone=function(){this.isPointerDown=!1,delete this.pointerIdentifier,this._unbindPostStartEvents(),this.pointerDone()},proto.pointerDone=noop,proto.onMSPointerCancel=proto.onpointercancel=function(t){t.pointerId==this.pointerIdentifier&&this._pointerCancel(t,t)},proto.ontouchcancel=function(t){var e=this.getTouch(t.changedTouches);e&&this._pointerCancel(t,e)},proto._pointerCancel=function(t,e){this._pointerDone(),this.pointerCancel(t,e)},proto.pointerCancel=function(t,e){this.emitEvent("pointerCancel",[t,e])},Unipointer.getPointerPoint=function(t){return{x:t.pageX,y:t.pageY}},Huebee.defaults={hues:12,hue0:0,shades:5,saturations:3,notation:"shortHex",setText:!0,setBGColor:!0},(proto=Huebee.prototype=Object.create(EvEmitter.prototype)).option=function(t){this.options=extend(this.options,t)};var GUID=0,instances={};proto.create=function(){var t=this.guid=++GUID;this.anchor.huebeeGUID=t,instances[t]=this,this.setBGElems=this.getSetElems(this.options.setBGColor),this.setTextElems=this.getSetElems(this.options.setText),this.outsideCloseIt=this.outsideClose.bind(this),this.onDocKeydown=this.docKeydown.bind(this),this.closeIt=this.close.bind(this),this.openIt=this.open.bind(this),this.onElemTransitionend=this.elemTransitionend.bind(this),this.isInputAnchor="INPUT"==this.anchor.nodeName,this.options.staticOpen||(this.anchor.addEventListener("click",this.openIt),this.anchor.addEventListener("focus",this.openIt)),this.isInputAnchor&&this.anchor.addEventListener("input",this.inputInput.bind(this));var e=this.element=document.createElement("div");e.className="huebee ",e.className+=this.options.staticOpen?"is-static-open ":"is-hidden ",e.className+=this.options.className||"";var o=this.container=document.createElement("div");function n(t){t.target==o&&t.preventDefault()}if(o.className="huebee__container",o.addEventListener("mousedown",n),o.addEventListener("touchstart",n),this.createCanvas(),this.cursor=document.createElement("div"),this.cursor.className="huebee__cursor is-hidden",o.appendChild(this.cursor),this.createCloseButton(),e.appendChild(o),!this.options.staticOpen){var i=getComputedStyle(this.anchor.parentNode);"relative"!=i.position&&"absolute"!=i.position&&(this.anchor.parentNode.style.position="relative")}var s=this.options.hues,r=this.options.customColors,a=r&&r.length;this.satY=a?Math.ceil(a/s)+1:0,this.updateColors(),this.setAnchorColor(),this.options.staticOpen&&this.open()},proto.getSetElems=function(t){return!0===t?[this.anchor]:"string"==typeof t?document.querySelectorAll(t):void 0},proto.createCanvas=function(){var t=this.canvas=document.createElement("canvas");t.className="huebee__canvas",this.ctx=t.getContext("2d");var e=this.canvasPointer=new Unipointer;e._bindStartEvent(t),e.on("pointerDown",this.canvasPointerDown.bind(this)),e.on("pointerMove",this.canvasPointerMove.bind(this)),this.container.appendChild(t)};var svgURI="http://www.w3.org/2000/svg";proto.createCloseButton=function(){if(!this.options.staticOpen){var t=document.createElementNS(svgURI,"svg");t.setAttribute("class","huebee__close-button"),t.setAttribute("viewBox","0 0 24 24");var e=document.createElementNS(svgURI,"path");e.setAttribute("d","M 7,7 L 17,17 M 17,7 L 7,17"),e.setAttribute("class","huebee__close-button__x"),t.appendChild(e),t.addEventListener("click",this.closeIt),this.container.appendChild(t)}},proto.updateColors=function(){this.swatches={},this.colorGrid={},this.updateColorModer();var t=this.options.shades,e=this.options.saturations,o=this.options.hues,n=this.options.customColors;if(n&&n.length){var i=0;n.forEach(function(t){var e=i%o,n=Math.floor(i/o),s=getSwatch(t);s&&(this.addSwatch(s,e,n),i++)}.bind(this))}for(var s=0;s<e;s++){var r=1-s/e,a=t*s+this.satY;this.updateSaturationGrid(s,r,a)}for(s=0;s<t+2;s++){var h=1-s/(t+1),c={color:this.colorModer(0,0,h),hue:0,sat:0,lum:h};this.addSwatch(c,o+1,s)}},proto.updateSaturationGrid=function(t,e,o){for(var n=this.options.shades,i=this.options.hues,s=this.options.hue0,r=0;r<n;r++)for(var a=0;a<i;a++){var h={hue:Math.round(360*a/i+s)%360,sat:e,lum:1-(r+1)/(n+1)};h.color=this.colorModer(h.hue,e,h.lum);var c=r+o;this.addSwatch(h,a,c)}},proto.addSwatch=function(t,e,o){this.swatches[e+","+o]=t,this.colorGrid[t.color.toUpperCase()]={x:e,y:o}};var colorModers={hsl:function(t,e,o){return"hsl("+t+", "+(e=Math.round(100*e))+"%, "+(o=Math.round(100*o))+"%)"},hex:hsl2hex,shortHex:function(t,e,o){return roundHex(hsl2hex(t,e,o))}};proto.updateColorModer=function(){this.colorModer=colorModers[this.options.notation]||colorModers.shortHex},proto.renderColors=function(){var t=2*this.gridSize;for(var e in this.swatches){var o=this.swatches[e],n=e.split(","),i=n[0],s=n[1];this.ctx.fillStyle=o.color,this.ctx.fillRect(i*t,s*t,t,t)}},proto.setAnchorColor=function(){this.isInputAnchor&&this.setColor(this.anchor.value)};var docElem=document.documentElement;proto.open=function(){if(!this.isOpen){var t=this.anchor,e=this.element;this.options.staticOpen||(e.style.left=t.offsetLeft+"px",e.style.top=t.offsetTop+t.offsetHeight+"px"),this.bindOpenEvents(!0),e.removeEventListener("transitionend",this.onElemTransitionend),t.parentNode.insertBefore(e,t.nextSibling);var o=getComputedStyle(e).transitionDuration;this.hasTransition=o&&"none"!=o&&parseFloat(o),this.isOpen=!0,this.updateSizes(),this.renderColors(),this.setAnchorColor();e.offsetHeight;e.classList.remove("is-hidden")}},proto.bindOpenEvents=function(t){if(!this.options.staticOpen){var e=(t?"add":"remove")+"EventListener";docElem[e]("mousedown",this.outsideCloseIt),docElem[e]("touchstart",this.outsideCloseIt),document[e]("focusin",this.outsideCloseIt),document[e]("keydown",this.onDocKeydown),this.anchor[e]("blur",this.closeIt)}},proto.updateSizes=function(){var t=this.options.hues,e=this.options.shades,o=this.options.saturations;this.cursorBorder=parseInt(getComputedStyle(this.cursor).borderTopWidth,10),this.gridSize=Math.round(this.cursor.offsetWidth-2*this.cursorBorder),this.canvasOffset={x:this.canvas.offsetLeft,y:this.canvas.offsetTop};var n=Math.max(e*o+this.satY,e+2),i=this.gridSize*(t+2);this.canvas.width=2*i,this.canvas.style.width=i+"px",this.canvas.height=this.gridSize*n*2},proto.outsideClose=function(t){var e=this.anchor.contains(t.target),o=this.element.contains(t.target);e||o||this.close()};var closeKeydowns={13:!0,27:!0};proto.docKeydown=function(t){closeKeydowns[t.keyCode]&&this.close()};var supportsTransitions="string"==typeof docElem.style.transform;proto.close=function(){this.isOpen&&(supportsTransitions&&this.hasTransition?this.element.addEventListener("transitionend",this.onElemTransitionend):this.remove(),this.element.classList.add("is-hidden"),this.bindOpenEvents(!1),this.isOpen=!1)},proto.remove=function(){var t=this.element.parentNode;t.contains(this.element)&&t.removeChild(this.element)},proto.elemTransitionend=function(t){t.target==this.element&&(this.element.removeEventListener("transitionend",this.onElemTransitionend),this.remove())},proto.inputInput=function(){this.setColor(this.anchor.value)},proto.canvasPointerDown=function(t,e){t.preventDefault(),this.updateOffset(),this.canvasPointerChange(e)},proto.updateOffset=function(){var t=this.canvas.getBoundingClientRect();this.offset={x:t.left+window.pageXOffset,y:t.top+window.pageYOffset}},proto.canvasPointerMove=function(t,e){this.canvasPointerChange(e)},proto.canvasPointerChange=function(t){var e=Math.round(t.pageX-this.offset.x),o=Math.round(t.pageY-this.offset.y),n=this.gridSize,i=Math.floor(e/n),s=Math.floor(o/n),r=this.swatches[i+","+s];this.setSwatch(r)},proto.setColor=function(t){var e=getSwatch(t);this.setSwatch(e)},proto.setSwatch=function(t){var e=t&&t.color;if(t){var o=e==this.color;this.color=e,this.hue=t.hue,this.sat=t.sat,this.lum=t.lum;var n=this.lum-.1*Math.cos((this.hue+60)/180*Math.PI);this.isLight=n>.5;var i=this.colorGrid[e.toUpperCase()];this.updateCursor(i),this.setTexts(),this.setBackgrounds(),o||this.emitEvent("change",[e,t.hue,t.sat,t.lum])}},proto.setTexts=function(){if(this.setTextElems)for(var t=0;t<this.setTextElems.length;t++){var e=this.setTextElems[t];e["INPUT"==e.nodeName?"value":"textContent"]=this.color}},proto.setBackgrounds=function(){if(this.setBGElems)for(var t=this.isLight?"#222":"white",e=0;e<this.setBGElems.length;e++){var o=this.setBGElems[e];o.style.backgroundColor=this.color,o.style.color=t}},proto.updateCursor=function(t){if(this.isOpen){var e=t?"remove":"add";if(this.cursor.classList[e]("is-hidden"),t){var o=this.gridSize,n=this.canvasOffset,i=this.cursorBorder;this.cursor.style.left=t.x*o+n.x-i+"px",this.cursor.style.top=t.y*o+n.y-i+"px"}}};var console=window.console;function htmlInit(){for(var t=document.querySelectorAll("[data-huebee]"),e=0;e<t.length;e++){var o,n=t[e],i=n.getAttribute("data-huebee");try{o=i&&JSON.parse(i)}catch(t){console&&console.error("Error parsing data-huebee on "+n.className+": "+t);continue}new Huebee(n,o)}}var readyState=document.readyState;"complete"==readyState||"interactive"==readyState?htmlInit():document.addEventListener("DOMContentLoaded",htmlInit),Huebee.data=function(t){var e=(t=getQueryElement(t))&&t.huebeeGUID;return e&&instances[e]};var proxyCanvas=document.createElement("canvas");proxyCanvas.width=proxyCanvas.height=1;var proxyCtx=proxyCanvas.getContext("2d");function getSwatch(t){proxyCtx.clearRect(0,0,1,1),proxyCtx.fillStyle="#010203",proxyCtx.fillStyle=t,proxyCtx.fillRect(0,0,1,1);var e=proxyCtx.getImageData(0,0,1,1).data;if("1,2,3,255"!=e.join(",")){var o=rgb2hsl.apply(this,e);return{color:t.trim(),hue:o[0],sat:o[1],lum:o[2]}}}function extend(t,e){for(var o in e)t[o]=e[o];return t}function getQueryElement(t){return"string"==typeof t&&(t=document.querySelector(t)),t}function hsl2hex(t,e,o){return rgb2hex(hsl2rgb(t,e,o))}function hsl2rgb(t,e,o){var n,i,s=(1-Math.abs(2*o-1))*e,r=t/60,a=s*(1-Math.abs(r%2-1));switch(Math.floor(r)){case 0:n=[s,a,0];break;case 1:n=[a,s,0];break;case 2:n=[0,s,a];break;case 3:n=[0,a,s];break;case 4:n=[a,0,s];break;case 5:n=[s,0,a];break;default:n=[0,0,0]}return i=o-s/2,n=n.map(function(t){return t+i})}function rgb2hsl(t,e,o){t/=255,e/=255,o/=255;var n,i=Math.max(t,e,o),s=Math.min(t,e,o),r=i-s,a=.5*(i+s),h=0===r?0:r/(1-Math.abs(2*a-1));return 0===r?n=0:i===t?n=(e-o)/r%6:i===e?n=(o-t)/r+2:i===o&&(n=(t-e)/r+4),[60*n,parseFloat(h),parseFloat(a)]}function rgb2hex(t){return"#"+t.map(function(t){var e=(t=Math.round(255*t)).toString(16).toUpperCase();return e=e.length<2?"0"+e:e}).join("")}function roundHex(t){return"#"+t[1]+t[3]+t[5]}export{Huebee};
//# sourceMappingURL=huebee.pkgd.js.map
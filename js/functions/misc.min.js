import{jQuery as $}from"../jQuery/jquery3.4.1.js";import{L}from"../Leaflet/leaflet1.0.3.js";import{K}from"../K.js";export function randomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e}export function empty(e){"boolean"!=K.type(e)&&(e.remove(),e=!1)}export function removeEmpty(e){let t="array"==K.type(e);return K.each(e,function(r,o){K.has(K.type(o),["object","array"])&&(e[r]=removeEmpty(o));let n=K.type(o);("string"==n&&!o||"object"==n&&!K.length(o)||"array"==n&&!o.length||"function"==n)&&(t?e.splice(r,1):delete e[r])}),e}export function sortObjByKeys(e){let t=Object.keys(e),r={};return t.sort(naturalCompare),K.each(t,function(t,o){r[o]=e[o]}),r}export function polyHoverAnimation(e){let t=$('path.leaflet-interactive:not(.poly-hover):not([fill="none"])');t.off("mouseover mouseout"),e||t.on("mouseover",function(){let e=$(this),t=e.attr("class").split(" ");K.each(t,function(t,r){r.contains("phg")&&(e=$("path."+r))}),e.addClass("hover")}).on("mouseout",function(){let e=$(this),t=e.attr("class").split(" ");K.each(t,function(t,r){r.contains("phg")&&(e=$("path."+r))}),e.removeClass("hover")})}export function editIconMessage(){let e,t=$(".leaflet-editing-icon"),r=$("#message");r.children(".message").length||r.append('<div class="message"></div>'),e=r.children(".message"),t.length>1e3&&e.text("There are "+t.length+" editing icons, \t\tyou may want to switch groups to speed things up!"),e.text(""),K.check.editing&&setTimeout(editIconMessage,2e3)}export function setGridRotate(e){let t=$(".leaflet-overlay-pane").children().last();if("images/grid.svg"!=t.attr("src"))return;let r=t.css("transform").split(",");K.grid.x=!K.grid.x||e?r[4]:K.grid.x,K.grid.y=!K.grid.y||e?r[5].replace(")",""):K.grid.y,K.grid.r=K.local("grid-rotate")||0;let o=K.local("grid-x-pos")||0,n=K.local("grid-y-pos")||0;Number(K.grid.x),Number(K.grid.y),Number(K.grid.r),Number(o),Number(n);let a=`translate3d(${K.grid.x*(o/1e5+1)}px, \n        ${K.grid.y*(n/1e5+1)}px, 0px) rotate(${K.grid.r}deg)`;t.css({transformOrigin:"center",transform:a})}export function toggleHideIcons(){$("#side-bar .side-bar-button:not(.inactive)").length?$("#side-bar .hide-all").removeClass("hidden"):$("#side-bar .hide-all").addClass("hidden"),$("#side-bar .filters .side-content").children("").each(function(){if($(this).hasClass("sub")){let e=$(this).nextUntil(".sub, div"),t=0;e.each(function(){$(this).hasClass("inactive")&&t++}),$(".hide-some",this).removeClass("hidden"),t==e.length&&$(".hide-some",this).addClass("hidden")}})}export function showHideAllLayers(e){K.each(K.map.type[K.mode],function(t,r){K.each(r,function(r){let o=$(`[set="${t}"][label="${r}"]`);o.removeClass("inactive"),e&&o.addClass("inactive"),K.filters=K.local("filters")||{},K.filters[r]=e,K.local("filters",K.filters),showHideLayers(t,r,e)})})}export function showHideCategory(e,t){K.each(K.map.type[K.mode][e],function(r){let o=$(`[set="${e}"][label="${r}"]`);o.removeClass("inactive"),t&&o.addClass("inactive"),K.filters=K.local("filters")||{},K.filters[r]=t,K.local("filters",K.filters),showHideLayers(e,r,t)})}export function showHideLayers(e,t,r){let o,n,a,i;switchLayerGroups(!0),K.each(K.map.group,function(l,s){K.has(t,s)&&(o=K.group.mode[l],n=r?K.group.mode.groupHidden:o,a=r?o:K.group.mode.groupHidden,i=r?"groupHidden":l,n&&a&&a.eachLayer(function(r){let o=r._leaflet_id;r.options.type==t&&r.options.category==e&&(n.addLayer(a.getLayer(o)),a.removeLayer(o),r.currentGroup=i)}))}),switchLayerGroups(),polyHoverAnimation()}export function toCorrectType(e,t){if(!K.settings.main[e])return t;const r=K.settings.main[e].type;return"number"==r?Number(t):"boolean"==r?"true"==t||"false"!=t&&!!t:("mode"==e&&K.each(t,function(e,r){K.empty(r)&&"array"==K.type(r)&&(t[e]={})}),t)}export function offset(e,t,r){return t&&(e.lat+=t),r&&(e.lng+=r),e}export function textColor(e){e=e.substring(1);let t=parseInt(e,16);return.2126*(t>>16&255)+.7152*(t>>8&255)+.0722*(t>>0&255)<40?"#ffffff":"#000000"}export function switchLayerGroup(e,t){const r=e.options.group;K.group.removeLayer(e),K.group.addLayer(e),$(e._icon).removeClass(t).addClass(r)}export function createPoint(e,t){return $.isArray(e)?L.point(e[0],e[1]):L.point(e,t)}export function switchLayerGroups(e){K.group.draw.eachLayer(function(e){K.group.addLayer(e),K.group.draw.removeLayer(e._leaflet_id)}),!e&&K.each(K.group.mode,function(e,t){t.eachLayer(function(e){(K.map.active[e.options.type]&&(e.options.creator==K.user.name||K.user.type>3)||e.editing.edit)&&(e.editing.currentGroup="drawLayer",K.group.draw.addLayer(e),K.group.removeLayer(e._leaflet_id))})}),K.myMap.removeLayer(K.group.draw).addLayer(K.group.draw).addLayer(K.group.mode.groupAll),K.myMap.panBy([0,0])}export function toggleFullScreen(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOWKEYBOARD_INPUT)}export function fixNum(e){return Number(e)?Number(e):e}export function polyType(e){return 1==e.length&&4==e[0].length&&e[0][0].lat==e[0][3].lat&&e[0][0].lng==e[0][1].lng?"rectangle":e[0].lat?"polyline":"polygon"}export function getType(e,t,r){if(!K.has(r,["marker","polyline","polygon"]))return"";let o="";return e=e.replace("images/",""),K.each(K.map.type,function(t,n){K.each(n[r],function(t,r){K.has(e,r)&&(o=t)})}),o}export function getMode(e){let t="all";return K.each(K.map.mode,function(r,o){K.has(e,o)&&(t=r)}),t}export function setAllLayerClick(){K.group.feature[K.mode].everyLayer.eachLayer(function(e){e.off("click"),K.check.grabbing?e.on("click",function(){return this.options.id}):K.user.type&&(K.user.type>=4||e.options.creator.toLowerCase()==K.user.name.toLowerCase())&&e.on("click",K.tool.layer.show)})}export function onZoomEnd(){setGridRotate(!0);const e=K.myMap.getZoom();let t="";for(let e=7;e<12;e++)t+=` z${e}`;$("#mapid").removeClass(t),$("#mapid").addClass(`z${Math.floor(e)}`),K.each(K.group.mode,function(t){let r=t.replace("group","");"number"==typeof(r=r.contains("_")?r.split("_"):r.bMatch(/\d+/)?Number(r):!K.has(r,["Hidden","Complete","everyLayer"])&&0)&&e>=r-1||"object"==typeof r&&e>=r[0]-1&&e<=r[1]+1?K.myMap.addLayer(K.group.mode[t]):K.myMap.removeLayer(K.group.mode[t])})}export function urlExists(e,t){$.ajax({type:"HEAD",url:e,success:function(){t(!0)},error:function(){t(!1)}})}export function setSelectionRange(e,t,r){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t,r);else if(e.createTextRange){let o=e.createTextRange();o.collapse(!0),o.moveEnd("character",r),o.moveStart("character",t),o.select()}}export function setCaretToPos(e,t,r){setSelectionRange(e,t,r||t)}export let ID=function(){return"_"+Math.random().toString(36).substr(2,9)};export function arraysEqual(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!=t.length)return!1;e.sort(),t.sort();for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}let tagsToReplace={"&":"&amp;","<":"&lt;",">":"&gt;"};export function replaceTag(e){return tagsToReplace[e]||e}export function safeTags(e){return e.replace(/[&<>]/g,replaceTag)}export function hideAlert(){$("#alert").hide()}export function naturalCompare(e,t){let r=[],o=[];for(e.replace(/(\d+)|(\D+)/g,function(e,t,o){r.push([t||1/0,o||""])}),t.replace(/(\d+)|(\D+)/g,function(e,t,r){o.push([t||1/0,r||""])});r.length&&o.length;){let e=r.shift(),t=o.shift(),n=e[0]-t[0]||e[1].localeCompare(t[1]);if(n)return n}return r.length-o.length}class Timed{run(e,t){this.time=t,this.callback=e,this._action()}_action(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(this.callback,this.time)}}export function timed(){return new Timed}
//# sourceMappingURL=misc.js.map
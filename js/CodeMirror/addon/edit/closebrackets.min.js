import{CodeMirror}from"../../lib/codemirror.js";var defaults={pairs:"()[]{}''\"\"",closeBefore:")]}'\":;>",triples:"",explode:"[]{}"},Pos=CodeMirror.Pos;function getOption(e,r){return"pairs"==r&&"string"==typeof e?e:"object"==typeof e&&null!=e[r]?e[r]:defaults[r]}CodeMirror.defineOption("autoCloseBrackets",!1,function(e,r,t){t&&t!=CodeMirror.Init&&(e.removeKeyMap(keyMap),e.state.closeBrackets=null),r&&(ensureBound(getOption(r,"pairs")),e.state.closeBrackets=r,e.addKeyMap(keyMap))});var keyMap={Backspace:handleBackspace,Enter:handleEnter};function ensureBound(e){for(var r=0;r<e.length;r++){var t=e.charAt(r),n="'"+t+"'";keyMap[n]||(keyMap[n]=handler(t))}}function handler(e){return function(r){return handleChar(r,e)}}function getConfig(e){var r=e.state.closeBrackets;return!r||r.override?r:e.getModeAt(e.getCursor()).closeBrackets||r}function handleBackspace(e){var r=getConfig(e);if(!r||e.getOption("disableInput"))return CodeMirror.Pass;for(var t=getOption(r,"pairs"),n=e.listSelections(),o=0;o<n.length;o++){if(!n[o].empty())return CodeMirror.Pass;var i=charsAround(e,n[o].head);if(!i||t.indexOf(i)%2!=0)return CodeMirror.Pass}for(o=n.length-1;o>=0;o--){var a=n[o].head;e.replaceRange("",Pos(a.line,a.ch-1),Pos(a.line,a.ch+1),"+delete")}}function handleEnter(e){var r=getConfig(e),t=r&&getOption(r,"explode");if(!t||e.getOption("disableInput"))return CodeMirror.Pass;for(var n=e.listSelections(),o=0;o<n.length;o++){if(!n[o].empty())return CodeMirror.Pass;var i=charsAround(e,n[o].head);if(!i||t.indexOf(i)%2!=0)return CodeMirror.Pass}e.operation(function(){var r=e.lineSeparator()||"\n";e.replaceSelection(r+r,null),e.execCommand("goCharLeft"),n=e.listSelections();for(var t=0;t<n.length;t++){var o=n[t].head.line;e.indentLine(o,null,!0),e.indentLine(o+1,null,!0)}})}function contractSelection(e){var r=CodeMirror.cmpPos(e.anchor,e.head)>0;return{anchor:new Pos(e.anchor.line,e.anchor.ch+(r?-1:1)),head:new Pos(e.head.line,e.head.ch+(r?1:-1))}}function handleChar(e,r){var t=getConfig(e);if(!t||e.getOption("disableInput"))return CodeMirror.Pass;var n=getOption(t,"pairs"),o=n.indexOf(r);if(-1==o)return CodeMirror.Pass;for(var i,a=getOption(t,"closeBefore"),s=getOption(t,"triples"),l=n.charAt(o+1)==r,c=e.listSelections(),d=o%2==0,h=0;h<c.length;h++){var f,u=c[h],g=u.head,p=e.getRange(g,Pos(g.line,g.ch+1));if(d&&!u.empty())f="surround";else if(!l&&d||p!=r)if(l&&g.ch>1&&s.indexOf(r)>=0&&e.getRange(Pos(g.line,g.ch-2),g)==r+r){if(g.ch>2&&/\bstring/.test(e.getTokenTypeAt(Pos(g.line,g.ch-2))))return CodeMirror.Pass;f="addFour"}else if(l){var C=0==g.ch?" ":e.getRange(Pos(g.line,g.ch-1),g);if(CodeMirror.isWordChar(p)||C==r||CodeMirror.isWordChar(C))return CodeMirror.Pass;f="both"}else{if(!d||!(0===p.length||/\s/.test(p)||a.indexOf(p)>-1))return CodeMirror.Pass;f="both"}else f=l&&stringStartsAfter(e,g)?"both":s.indexOf(r)>=0&&e.getRange(g,Pos(g.line,g.ch+3))==r+r+r?"skipThree":"skip";if(i){if(i!=f)return CodeMirror.Pass}else i=f}var v=o%2?n.charAt(o-1):r,M=o%2?r:n.charAt(o+1);e.operation(function(){if("skip"==i)e.execCommand("goCharRight");else if("skipThree"==i)for(var r=0;r<3;r++)e.execCommand("goCharRight");else if("surround"==i){var t=e.getSelections();for(r=0;r<t.length;r++)t[r]=v+t[r]+M;e.replaceSelections(t,"around"),t=e.listSelections().slice();for(r=0;r<t.length;r++)t[r]=contractSelection(t[r]);e.setSelections(t)}else"both"==i?(e.replaceSelection(v+M,null),e.triggerElectric(v+M),e.execCommand("goCharLeft")):"addFour"==i&&(e.replaceSelection(v+v+v+v,"before"),e.execCommand("goCharRight"))})}function charsAround(e,r){var t=e.getRange(Pos(r.line,r.ch-1),Pos(r.line,r.ch+1));return 2==t.length?t:null}function stringStartsAfter(e,r){var t=e.getTokenAt(Pos(r.line,r.ch+1));return/\bstring/.test(t.type)&&t.start==r.ch&&(0==r.ch||!/\bstring/.test(e.getTokenTypeAt(r)))}ensureBound(defaults.pairs+"`");
//# sourceMappingURL=closebrackets.js.map
import{CodeMirror}from"../../lib/codemirror.js";var noOptions={},nonWS=/[^\s\u00a0]/,Pos=CodeMirror.Pos;function firstNonWS(e){var n=e.search(nonWS);return-1==n?0:n}function probablyInsideString(e,n,t){return/\bstring\b/.test(e.getTokenTypeAt(Pos(n.line,0)))&&!/^[\'\"\`]/.test(t)}function getMode(e,n){var t=e.getMode();return!1!==t.useInnerComments&&t.innerMode?e.getModeAt(n):t}CodeMirror.commands.toggleComment=function(e){e.toggleComment()},CodeMirror.defineExtension("toggleComment",function(e){e||(e=noOptions);for(var n=1/0,t=this.listSelections(),o=null,i=t.length-1;i>=0;i--){var l=t[i].from(),r=t[i].to();l.line>=n||(r.line>=n&&(r=Pos(n,0)),n=l.line,null==o?this.uncomment(l,r,e)?o="un":(this.lineComment(l,r,e),o="line"):"un"==o?this.uncomment(l,r,e):this.lineComment(l,r,e))}}),CodeMirror.defineExtension("lineComment",function(e,n,t){t||(t=noOptions);var o=this,i=getMode(o,e),l=o.getLine(e.line);if(null!=l&&!probablyInsideString(o,e,l)){var r=t.lineComment||i.lineComment;if(r){var a=Math.min(0!=n.ch||n.line==e.line?n.line+1:n.line,o.lastLine()+1),s=null==t.padding?" ":t.padding,m=t.commentBlankLines||e.line==n.line;o.operation(function(){if(t.indent){for(var n=null,i=e.line;i<a;++i){var l=(c=o.getLine(i)).slice(0,firstNonWS(c));(null==n||n.length>l.length)&&(n=l)}for(i=e.line;i<a;++i){var c=o.getLine(i),g=n.length;(m||nonWS.test(c))&&(c.slice(0,g)!=n&&(g=firstNonWS(c)),o.replaceRange(n+r+s,Pos(i,0),Pos(i,g)))}}else for(i=e.line;i<a;++i)(m||nonWS.test(o.getLine(i)))&&o.replaceRange(r+s,Pos(i,0))})}else(t.blockCommentStart||i.blockCommentStart)&&(t.fullLines=!0,o.blockComment(e,n,t))}}),CodeMirror.defineExtension("blockComment",function(e,n,t){t||(t=noOptions);var o=this,i=getMode(o,e),l=t.blockCommentStart||i.blockCommentStart,r=t.blockCommentEnd||i.blockCommentEnd;if(l&&r){if(!/\bcomment\b/.test(o.getTokenTypeAt(Pos(e.line,0)))){var a=Math.min(n.line,o.lastLine());a!=e.line&&0==n.ch&&nonWS.test(o.getLine(a))&&--a;var s=null==t.padding?" ":t.padding;e.line>a||o.operation(function(){if(0!=t.fullLines){var m=nonWS.test(o.getLine(a));o.replaceRange(s+r,Pos(a)),o.replaceRange(l+s,Pos(e.line,0));var c=t.blockCommentLead||i.blockCommentLead;if(null!=c)for(var g=e.line+1;g<=a;++g)(g!=a||m)&&o.replaceRange(c+s,Pos(g,0))}else o.replaceRange(r,n),o.replaceRange(l,e)})}}else(t.lineComment||i.lineComment)&&0!=t.fullLines&&o.lineComment(e,n,t)}),CodeMirror.defineExtension("uncomment",function(e,n,t){t||(t=noOptions);var o,i=this,l=getMode(i,e),r=Math.min(0!=n.ch||n.line==e.line?n.line:n.line-1,i.lastLine()),a=Math.min(e.line,r),s=t.lineComment||l.lineComment,m=[],c=null==t.padding?" ":t.padding;e:if(s){for(var g=a;g<=r;++g){var f=i.getLine(g),d=f.indexOf(s);if(d>-1&&!/comment/.test(i.getTokenTypeAt(Pos(g,d+1)))&&(d=-1),-1==d&&nonWS.test(f))break e;if(d>-1&&nonWS.test(f.slice(0,d)))break e;m.push(f)}if(i.operation(function(){for(var e=a;e<=r;++e){var n=m[e-a],t=n.indexOf(s),l=t+s.length;t<0||(n.slice(l,l+c.length)==c&&(l+=c.length),o=!0,i.replaceRange("",Pos(e,t),Pos(e,l)))}}),o)return!0}var h=t.blockCommentStart||l.blockCommentStart,u=t.blockCommentEnd||l.blockCommentEnd;if(!h||!u)return!1;var C=t.blockCommentLead||l.blockCommentLead,p=i.getLine(a),v=p.indexOf(h);if(-1==v)return!1;var b=r==a?p:i.getLine(r),k=b.indexOf(u,r==a?v+h.length:0),P=Pos(a,v+1),L=Pos(r,k+1);if(-1==k||!/comment/.test(i.getTokenTypeAt(P))||!/comment/.test(i.getTokenTypeAt(L))||i.getRange(P,L,"\n").indexOf(u)>-1)return!1;var S=p.lastIndexOf(h,e.ch),M=-1==S?-1:p.slice(0,e.ch).indexOf(u,S+h.length);if(-1!=S&&-1!=M&&M+u.length!=e.ch)return!1;M=b.indexOf(u,n.ch);var O=b.slice(n.ch).lastIndexOf(h,M-n.ch);return S=-1==M||-1==O?-1:n.ch+O,(-1==M||-1==S||S==n.ch)&&(i.operation(function(){i.replaceRange("",Pos(r,k-(c&&b.slice(k-c.length,k)==c?c.length:0)),Pos(r,k+u.length));var e=v+h.length;if(c&&p.slice(e,e+c.length)==c&&(e+=c.length),i.replaceRange("",Pos(a,v),Pos(a,e)),C)for(var n=a+1;n<=r;++n){var t=i.getLine(n),o=t.indexOf(C);if(-1!=o&&!nonWS.test(t.slice(0,o))){var l=o+C.length;c&&t.slice(l,l+c.length)==c&&(l+=c.length),i.replaceRange("",Pos(n,o),Pos(n,l))}}}),!0)});
//# sourceMappingURL=comment.js.map
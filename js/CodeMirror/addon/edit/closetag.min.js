import{CodeMirror}from"../../lib/codemirror.js";CodeMirror.defineOption("autoCloseTags",!1,function(e,t,n){if(n!=CodeMirror.Init&&n&&e.removeKeyMap("autoCloseTags"),t){var o={name:"autoCloseTags"};("object"!=typeof t||t.whenClosing)&&(o["'/'"]=function(e){return autoCloseSlash(e)}),("object"!=typeof t||t.whenOpening)&&(o["'>'"]=function(e){return autoCloseGT(e)}),e.addKeyMap(o)}});var htmlDontClose=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],htmlIndent=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"];function autoCloseGT(e){if(e.getOption("disableInput"))return CodeMirror.Pass;for(var t=e.listSelections(),n=[],o=e.getOption("autoCloseTags"),r=0;r<t.length;r++){if(!t[r].empty())return CodeMirror.Pass;var i=t[r].head,a=e.getTokenAt(i),s=CodeMirror.innerMode(e.getMode(),a.state),l=s.state;if("xml"!=s.mode.name||!l.tagName)return CodeMirror.Pass;var d="html"==s.mode.configuration,g="object"==typeof o&&o.dontCloseTags||d&&htmlDontClose,c="object"==typeof o&&o.indentTags||d&&htmlIndent,u=l.tagName;a.end>i.ch&&(u=u.slice(0,u.length-a.end+i.ch));var f=u.toLowerCase();if(!u||"string"==a.type&&(a.end!=i.ch||!/[\"\']/.test(a.string.charAt(a.string.length-1))||1==a.string.length)||"tag"==a.type&&"closeTag"==l.type||a.string.indexOf("/")==a.string.length-1||g&&indexOf(g,f)>-1||closingTagExists(e,u,i,l,!0))return CodeMirror.Pass;var h="object"==typeof o&&o.emptyTags;if(h&&indexOf(h,u)>-1)n[r]={text:"/>",newPos:CodeMirror.Pos(i.line,i.ch+2)};else{var m=c&&indexOf(c,f)>-1;n[r]={indent:m,text:">"+(m?"\n\n":"")+"</"+u+">",newPos:m?CodeMirror.Pos(i.line+1,0):CodeMirror.Pos(i.line,i.ch+1)}}}var C="object"==typeof o&&o.dontIndentOnAutoClose;for(r=t.length-1;r>=0;r--){var p=n[r];e.replaceRange(p.text,t[r].head,t[r].anchor,"+insert");var M=e.listSelections().slice(0);M[r]={head:p.newPos,anchor:p.newPos},e.setSelections(M),!C&&p.indent&&(e.indentLine(p.newPos.line,null,!0),e.indentLine(p.newPos.line+1,null,!0))}}function autoCloseCurrent(e,t){for(var n=e.listSelections(),o=[],r=t?"/":"</",i=e.getOption("autoCloseTags"),a="object"==typeof i&&i.dontIndentOnSlash,s=0;s<n.length;s++){if(!n[s].empty())return CodeMirror.Pass;var l,d=n[s].head,g=e.getTokenAt(d),c=CodeMirror.innerMode(e.getMode(),g.state),u=c.state;if(t&&("string"==g.type||"<"!=g.string.charAt(0)||g.start!=d.ch-1))return CodeMirror.Pass;if("xml"!=c.mode.name)if("htmlmixed"==e.getMode().name&&"javascript"==c.mode.name)l=r+"script";else{if("htmlmixed"!=e.getMode().name||"css"!=c.mode.name)return CodeMirror.Pass;l=r+"style"}else{if(!u.context||!u.context.tagName||closingTagExists(e,u.context.tagName,d,u))return CodeMirror.Pass;l=r+u.context.tagName}">"!=e.getLine(d.line).charAt(g.end)&&(l+=">"),o[s]=l}if(e.replaceSelections(o),n=e.listSelections(),!a)for(s=0;s<n.length;s++)(s==n.length-1||n[s].head.line<n[s+1].head.line)&&e.indentLine(n[s].head.line)}function autoCloseSlash(e){return e.getOption("disableInput")?CodeMirror.Pass:autoCloseCurrent(e,!0)}function indexOf(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;n<o;++n)if(e[n]==t)return n;return-1}function closingTagExists(e,t,n,o,r){if(!CodeMirror.scanForClosingTag)return!1;var i=Math.min(e.lastLine()+1,n.line+500),a=CodeMirror.scanForClosingTag(e,n,null,i);if(!a||a.tag!=t)return!1;for(var s=o.context,l=r?1:0;s&&s.tagName==t;s=s.prev)++l;n=a.to;for(var d=1;d<l;d++){var g=CodeMirror.scanForClosingTag(e,n,null,i);if(!g||g.tag!=t)return!1;n=g.to}return!0}CodeMirror.commands.closeTag=function(e){return autoCloseCurrent(e)};
//# sourceMappingURL=closetag.js.map